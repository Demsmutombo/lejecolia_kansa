import{a as m,c as te,w as z,f as ie,o as N,g as V,h as t,I as ne,C as f,p as u,B as Y,t as b,v as re,O as ue,q as de,l as k,u as me,m as q,F as ce,D as pe,n as ve}from"./vendor-5ChSB122.js";import{M as W}from"./bootstrap-DXdCWnwj.js";import{_ as le,u as se,p as Z,f as oe,a as g,b as fe,d as S,c as ge,e as be}from"./index-C7KYosbF.js";import{G as he,D as xe}from"./GenericModal-D2OVyllk.js";import{A as X}from"./ArgonSelect-BIJzuYL2.js";import"./charts-D32nV7-X.js";const ye={class:"modal-body-scrollable"},Ue={class:"row mb-4"},Se={class:"col-12"},$e={class:"upload-photo-section"},Ce={class:"text-center"},Re={class:"mb-3"},we=["src"],Ne={class:"row"},Ee={class:"col-md-4 mb-3"},Ae={class:"col-md-4 mb-3"},Ie={class:"col-md-4 mb-3"},ke={class:"row"},Ve={class:"col-md-6 mb-3"},_e={class:"col-md-6 mb-3"},Te={class:"row"},Me={class:"col-md-6 mb-3"},Pe={class:"col-md-6 mb-3"},Le={class:"row"},qe={class:"col-md-6 mb-3"},Be={class:"col-md-6 mb-3"},De={class:"row"},Ge={class:"col-md-6 mb-3"},ze={class:"col-md-6 mb-3"},Fe={class:"row"},Oe={class:"col-md-4 mb-3"},je={class:"col-md-4 mb-3"},Ke={class:"col-md-4 mb-3"},Je={class:"row"},He={class:"col-md-4 mb-3"},Qe={class:"col-md-4 mb-3"},We={class:"col-md-4 mb-3"},Xe={class:"row"},Ye={class:"col-12 mb-3"},Ze={__name:"UtilisateurModal",props:{utilisateur:{type:Object,default:null},modalId:{type:String,default:"utilisateurModal"}},emits:["save","close"],setup(F,{expose:O,emit:j}){const _=se(),M=F,$=j,T=m(null),E=m(null),C=m(!1),R=m(""),c=m([]),p=m([]),d=m(!1),h=m(!1),w=te(()=>M.utilisateur!==null),P=[{value:"Masculin",label:"Masculin"},{value:"FÃ©minin",label:"FÃ©minin"},{value:"Autre",label:"Autre"}],o=m({idUtilisateur:0,nomUtilisateur:"",postNomUtilisateur:"",prenomUtilisateur:"",sexe:"",dateNaissance:"",numeroTelephone:"",email:"",login:"",motDePasse:"",photo:"",idSite:0,idRole:0,province:"",ville:"",commune:"",quartier:"",avenue:"",numero:"",statut:!0,isConnected:!1}),K=async()=>{if(!_.societeId){c.value=[];return}d.value=!0;try{const a=await S.getSitesBySociete(_.societeId),e=Array.isArray(a)?a:[];c.value=e.map(i=>({value:parseInt(i.idSite,10),label:i.nomSite||i.nom||`Site #${i.idSite}`})),console.log(`âœ… ${c.value.length} site(s) chargÃ©s pour la sociÃ©tÃ© #${_.societeId}`),!o.value.idSite&&c.value.length&&(o.value.idSite=c.value[0].value)}catch(a){console.error("âŒ Erreur chargement sites:",a),c.value=[]}finally{d.value=!1}},L=async()=>{h.value=!0;try{const a=await S.getRoles(),e=["gestionnaire","caissier","gerant"],U=(Array.isArray(a)?a:[]).filter(v=>{const x=(v.nom||v.name||"").toLowerCase();return e.some(A=>x.includes(A))});if(p.value=U.map(v=>({value:parseInt(v.idRole,10),label:v.nom||v.name||`RÃ´le ${v.idRole}`})),console.log("âœ… RÃ´les filtrÃ©s (Gestionnaire/Caissier/Gerant):",p.value.length),console.log("ðŸ“‹ RÃ´les disponibles:",p.value),!o.value.idRole&&p.value.length>0){const v=p.value.find(x=>x.label.toLowerCase().includes("gestionnaire"));v?(o.value.idRole=v.value,console.log("âœ… RÃ´le GESTIONNAIRE prÃ©-sÃ©lectionnÃ©:",v.label)):(o.value.idRole=p.value[0].value,console.log("âœ… Premier rÃ´le prÃ©-sÃ©lectionnÃ©:",p.value[0].label))}}catch(a){console.error("âŒ Erreur chargement rÃ´les:",a),p.value=[]}finally{h.value=!1}},B=a=>{const e=a.target.files[0];if(!e)return;const i=2*1024*1024;if(e.size>i){alert("Le fichier est trop volumineux. Taille maximum : 2 MB"),a.target.value="";return}const U=new FileReader;U.onload=v=>{const x=new Image;x.onload=()=>{const A=document.createElement("canvas"),H=A.getContext("2d"),I=150;let y=x.width,l=x.height;y>l?y>I&&(l=l*(I/y),y=I):l>I&&(y=y*(I/l),l=I),A.width=y,A.height=l,H.drawImage(x,0,0,y,l);const s=A.toDataURL("image/jpeg",.5);R.value=s,o.value.photo=s,console.log("âœ… Photo compressÃ©e:",{original:`${(e.size/1024).toFixed(2)} KB`,compressed:`${(s.length/1024).toFixed(2)} KB`,dimensions:`${y}x${l}`})},x.src=v.target.result},U.readAsDataURL(e)};z(()=>M.utilisateur,a=>{a?(o.value={idUtilisateur:a.idUtilisateur||0,nomUtilisateur:a.nomUtilisateur||"",postNomUtilisateur:a.postNomUtilisateur||"",prenomUtilisateur:a.prenomUtilisateur||"",sexe:a.sexe||"",dateNaissance:a.dateNaissance?a.dateNaissance.split("T")[0]:"",numeroTelephone:a.numeroTelephone||"",email:a.email||"",login:a.login||"",motDePasse:"",photo:a.photo||"",idSite:a.idSite?parseInt(a.idSite,10):"",idRole:a.idRole?parseInt(a.idRole,10):"",province:a.province||"",ville:a.ville||"",commune:a.commune||"",quartier:a.quartier||"",avenue:a.avenue||"",numero:a.numero||"",statut:a.statut!==void 0?a.statut:!0,isConnected:a.isConnected||!1},R.value=a.photo||""):D()},{immediate:!1});const D=()=>{o.value={idUtilisateur:0,nomUtilisateur:"",postNomUtilisateur:"",prenomUtilisateur:"",sexe:"",dateNaissance:"",numeroTelephone:"",email:"",login:"",motDePasse:"",photo:"",idSite:c.value.length?c.value[0].value:0,idRole:p.value.length?p.value[0].value:0,province:"",ville:"",commune:"",quartier:"",avenue:"",numero:"",statut:!0,isConnected:!1},R.value=""},J=()=>o.value.nomUtilisateur?o.value.prenomUtilisateur?o.value.email?o.value.numeroTelephone?o.value.login?!w.value&&!o.value.motDePasse?{valid:!1,message:"Le mot de passe est obligatoire"}:!o.value.idSite||parseInt(o.value.idSite,10)===0?{valid:!1,message:"Le site est obligatoire"}:!o.value.idRole||parseInt(o.value.idRole,10)===0?{valid:!1,message:"Le rÃ´le est obligatoire"}:{valid:!0}:{valid:!1,message:"Le login est obligatoire"}:{valid:!1,message:"Le tÃ©lÃ©phone est obligatoire"}:{valid:!1,message:"L'email est obligatoire"}:{valid:!1,message:"Le prÃ©nom est obligatoire"}:{valid:!1,message:"Le nom est obligatoire"},G=async()=>{const a=J();if(!a.valid){alert(a.message);return}C.value=!0;try{const e={...o.value};w.value&&!e.motDePasse&&delete e.motDePasse,$("save",{...e,idSite:parseInt(e.idSite,10),idRole:parseInt(e.idRole,10)})}catch(e){console.error("Erreur lors de la sauvegarde:",e)}finally{C.value=!1}};return z(()=>_.societeId,()=>{K()},{immediate:!0}),z(()=>_.role,()=>{L()},{immediate:!0}),O({resetForm:D,show:()=>{var a;return(a=T.value)==null?void 0:a.show()},hide:()=>{var a;return(a=T.value)==null?void 0:a.hide()},close:()=>{var a;return(a=T.value)==null?void 0:a.hide()}}),(a,e)=>(N(),ie(he,{"modal-id":F.modalId,title:`${w.value?"Modifier":"Nouvel"} Utilisateur`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":C.value,"loading-text":"Enregistrement...",onConfirm:G,ref_key:"modalRef",ref:T},{body:V(()=>[t("div",ye,[t("form",{onSubmit:ne(G,["prevent"])},[t("div",Ue,[t("div",Se,[t("div",$e,[e[22]||(e[22]=t("label",{class:"form-label d-block text-center mb-3"},[t("i",{class:"fas fa-user-circle me-2"}),f("Photo ")],-1)),t("div",Ce,[t("div",Re,[t("img",{src:R.value||Y(Z),alt:"Photo",class:"img-fluid rounded-circle photo-preview",style:{width:"80px",height:"80px","object-fit":"cover",border:"2px solid #e9ecef",cursor:"pointer"},onClick:e[0]||(e[0]=i=>E.value.click()),title:"Cliquez pour changer la photo"},null,8,we)]),t("input",{type:"file",ref_key:"photoInput",ref:E,onChange:B,accept:"image/*",class:"d-none"},null,544),u(oe,{type:"button",color:"info",size:"sm",onClick:e[1]||(e[1]=i=>E.value.click())},{default:V(()=>[e[20]||(e[20]=t("i",{class:"fas fa-upload me-2"},null,-1)),f(" "+b(R.value?"Changer Photo":"Choisir Photo"),1)]),_:1}),e[21]||(e[21]=t("p",{class:"text-xs text-secondary mt-2 mb-0"},[f(" JPG, PNG, GIF (max. 2MB)"),t("br"),t("small",{class:"text-muted"},"RedimensionnÃ© 150x150 pour performance")],-1))])])])]),e[41]||(e[41]=t("h6",{class:"text-sm mt-3 mb-2"},"IdentitÃ©",-1)),t("div",Ne,[t("div",Ee,[e[23]||(e[23]=t("label",{class:"form-label"},"Nom *",-1)),u(g,{modelValue:o.value.nomUtilisateur,"onUpdate:modelValue":e[2]||(e[2]=i=>o.value.nomUtilisateur=i),placeholder:"Ex: DUPONT","is-required":!0,id:"nom",name:"nom"},null,8,["modelValue"])]),t("div",Ae,[e[24]||(e[24]=t("label",{class:"form-label"},"Post-nom",-1)),u(g,{modelValue:o.value.postNomUtilisateur,"onUpdate:modelValue":e[3]||(e[3]=i=>o.value.postNomUtilisateur=i),placeholder:"Ex: MARIE",id:"postnom",name:"postnom"},null,8,["modelValue"])]),t("div",Ie,[e[25]||(e[25]=t("label",{class:"form-label"},"PrÃ©nom *",-1)),u(g,{modelValue:o.value.prenomUtilisateur,"onUpdate:modelValue":e[4]||(e[4]=i=>o.value.prenomUtilisateur=i),placeholder:"Ex: Jean","is-required":!0,id:"prenom",name:"prenom"},null,8,["modelValue"])])]),t("div",ke,[t("div",Ve,[e[26]||(e[26]=t("label",{class:"form-label"},"Sexe",-1)),u(X,{modelValue:o.value.sexe,"onUpdate:modelValue":e[5]||(e[5]=i=>o.value.sexe=i),options:P,placeholder:"SÃ©lectionner",id:"sexe",name:"sexe"},null,8,["modelValue"])]),t("div",_e,[e[27]||(e[27]=t("label",{class:"form-label"},"Date de Naissance",-1)),re(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.value.dateNaissance=i),type:"date",class:"form-control",id:"dateNaissance",name:"dateNaissance"},null,512),[[ue,o.value.dateNaissance]])])]),e[42]||(e[42]=t("h6",{class:"text-sm mt-3 mb-2"},"Contact",-1)),t("div",Te,[t("div",Me,[e[28]||(e[28]=t("label",{class:"form-label"},"Email *",-1)),u(g,{modelValue:o.value.email,"onUpdate:modelValue":e[7]||(e[7]=i=>o.value.email=i),type:"email",placeholder:"email@example.com","is-required":!0,id:"email",name:"email"},null,8,["modelValue"])]),t("div",Pe,[e[29]||(e[29]=t("label",{class:"form-label"},"TÃ©lÃ©phone *",-1)),u(g,{modelValue:o.value.numeroTelephone,"onUpdate:modelValue":e[8]||(e[8]=i=>o.value.numeroTelephone=i),placeholder:"+243 123 456 789","is-required":!0,id:"telephone",name:"telephone"},null,8,["modelValue"])])]),e[43]||(e[43]=t("h6",{class:"text-sm mt-3 mb-2"},"Connexion",-1)),t("div",Le,[t("div",qe,[e[30]||(e[30]=t("label",{class:"form-label"},"Login *",-1)),u(g,{modelValue:o.value.login,"onUpdate:modelValue":e[9]||(e[9]=i=>o.value.login=i),placeholder:"login","is-required":!0,id:"login",name:"login"},null,8,["modelValue"])]),t("div",Be,[e[31]||(e[31]=t("label",{class:"form-label"},"Mot de passe *",-1)),u(g,{modelValue:o.value.motDePasse,"onUpdate:modelValue":e[10]||(e[10]=i=>o.value.motDePasse=i),type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢","is-required":!w.value,id:"password",name:"password"},null,8,["modelValue","is-required"])])]),t("div",De,[t("div",Ge,[e[32]||(e[32]=t("label",{class:"form-label"},"Site *",-1)),u(X,{modelValue:o.value.idSite,"onUpdate:modelValue":e[11]||(e[11]=i=>o.value.idSite=i),options:c.value,placeholder:"SÃ©lectionner un site",disabled:d.value,id:"idSite",name:"idSite","value-key":"value","label-key":"label"},null,8,["modelValue","options","disabled"])]),t("div",ze,[e[33]||(e[33]=t("label",{class:"form-label"},"RÃ´le *",-1)),u(X,{modelValue:o.value.idRole,"onUpdate:modelValue":e[12]||(e[12]=i=>o.value.idRole=i),options:p.value,placeholder:"SÃ©lectionner un rÃ´le",disabled:h.value,id:"idRole",name:"idRole","value-key":"value","label-key":"label"},null,8,["modelValue","options","disabled"])])]),e[44]||(e[44]=t("h6",{class:"text-sm mt-3 mb-2"},"Adresse",-1)),t("div",Fe,[t("div",Oe,[e[34]||(e[34]=t("label",{class:"form-label"},"Province",-1)),u(g,{modelValue:o.value.province,"onUpdate:modelValue":e[13]||(e[13]=i=>o.value.province=i),placeholder:"Ex: Kinshasa",id:"province",name:"province"},null,8,["modelValue"])]),t("div",je,[e[35]||(e[35]=t("label",{class:"form-label"},"Ville",-1)),u(g,{modelValue:o.value.ville,"onUpdate:modelValue":e[14]||(e[14]=i=>o.value.ville=i),placeholder:"Ex: Kinshasa",id:"ville",name:"ville"},null,8,["modelValue"])]),t("div",Ke,[e[36]||(e[36]=t("label",{class:"form-label"},"Commune",-1)),u(g,{modelValue:o.value.commune,"onUpdate:modelValue":e[15]||(e[15]=i=>o.value.commune=i),placeholder:"Ex: Gombe",id:"commune",name:"commune"},null,8,["modelValue"])])]),t("div",Je,[t("div",He,[e[37]||(e[37]=t("label",{class:"form-label"},"Quartier",-1)),u(g,{modelValue:o.value.quartier,"onUpdate:modelValue":e[16]||(e[16]=i=>o.value.quartier=i),placeholder:"Ex: Centre-ville",id:"quartier",name:"quartier"},null,8,["modelValue"])]),t("div",Qe,[e[38]||(e[38]=t("label",{class:"form-label"},"Avenue",-1)),u(g,{modelValue:o.value.avenue,"onUpdate:modelValue":e[17]||(e[17]=i=>o.value.avenue=i),placeholder:"Ex: Avenue de la Paix",id:"avenue",name:"avenue"},null,8,["modelValue"])]),t("div",We,[e[39]||(e[39]=t("label",{class:"form-label"},"NumÃ©ro",-1)),u(g,{modelValue:o.value.numero,"onUpdate:modelValue":e[18]||(e[18]=i=>o.value.numero=i),placeholder:"Ex: 123",id:"numero",name:"numero"},null,8,["modelValue"])])]),t("div",Xe,[t("div",Ye,[u(fe,{modelValue:o.value.statut,"onUpdate:modelValue":e[19]||(e[19]=i=>o.value.statut=i),id:"utilisateurStatut",name:"statut"},{default:V(()=>[...e[40]||(e[40]=[f(" Utilisateur actif ",-1)])]),_:1},8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},et=le(Ze,[["__scopeId","data-v-d190f019"]]),tt={class:"container-fluid py-4"},lt={class:"row"},st={class:"col-12"},ot={key:0,class:"badge bg-gradient-info me-2"},at={class:"d-flex align-items-center"},it=["src","alt"],nt={class:"mb-0 text-sm"},rt={class:"text-xs text-secondary mb-0"},ut=["href"],dt=["href"],mt={class:"row mt-4"},ct={class:"col-12"},pt={class:"card"},vt={class:"card-header pb-0 d-flex justify-content-between align-items-center"},ft={class:"text-sm text-muted mb-0"},gt={key:0,class:"spinner-border text-primary spinner-border-sm",role:"status"},bt={class:"card-body px-0 pt-0 pb-2"},ht={class:"table-responsive p-0"},xt={class:"table align-items-center mb-0"},yt={key:0},Ut={class:"ps-4"},St={class:"mb-0 text-sm"},$t={key:0,class:"text-xs text-muted mb-0"},Ct={class:"mb-0 text-sm"},Rt={class:"mb-0 text-sm"},wt={key:0,class:"text-xs text-muted mb-0"},Nt={__name:"Utilisateurs",setup(F){const O=me(),j=se(),{requireAuth:_,isSuperAdmin:M,societeId:$}=ge(),{showConfirm:T,showSuccess:E,showError:C,showLoading:R,close:c}=be();_();const p=m(!1),d=m([]);m([]);const h=m([]),w=m(!1),P=m(null),o=m(null),K=te(()=>{const l=h.value.length;return l?`${l} site${l>1?"s":""} associÃ©${l>1?"s":""} Ã  votre sociÃ©tÃ©`:"Aucun site associÃ©"}),L=()=>{if(!d.value.length)return;const l={};h.value.forEach(s=>{const n=Number(s.idSite);l[n]={name:s.nomSite||`Site #${s.idSite}`,code:s.codeSite||s.code||""}}),d.value=d.value.map(s=>{const n=l[Number(s.idSite)]||null;return{...s,siteName:s.nomSite||(n==null?void 0:n.name)||`Site #${s.idSite}`,siteCode:s.codeSite||(n==null?void 0:n.code)||""}})},B=async()=>{if(!$.value){h.value=[],L();return}w.value=!0,console.log(`ðŸ¬ Chargement sites pour sociÃ©tÃ© #${$.value}`);try{const l=await S.getSitesBySociete($.value);h.value=Array.isArray(l)?l:[],console.log(`âœ… ${h.value.length} site(s) associÃ©(s) chargÃ©(s)`),L()}catch(l){console.error("âŒ Erreur chargement sites:",l),h.value=[]}finally{w.value=!1}},D=(l={})=>{const s=[];return l.numero&&s.push(`NÂ° ${l.numero}`),l.avenue&&s.push(`Avenue ${l.avenue}`),l.quartier&&s.push(l.quartier),l.commune&&s.push(l.commune),l.ville&&s.push(l.ville),s.join(", ")||"Adresse non renseignÃ©e"},J=(l={})=>l.contact||l.telephone||l.numeroTelephone||"Non renseignÃ©",G=[{key:"idUtilisateur",label:"NÂ°",type:"index",align:"center"},{key:"nomComplet",label:"Gestionnaire",render:(l,s)=>`${s.nomUtilisateur} ${s.postNomUtilisateur||""} ${s.prenomUtilisateur}`.trim()},{key:"email",label:"Email"},{key:"numeroTelephone",label:"TÃ©lÃ©phone"},{key:"siteName",label:"Site",render:(l,s)=>s.siteName||`Site #${s.idSite}`},{key:"roleName",label:"RÃ´le",render:(l,s)=>`<span class="badge badge-sm bg-gradient-secondary">${s.roleName||`RÃ´le #${s.idRole}`}</span>`},{key:"isConnected",label:"Connexion",align:"center",render:l=>l?'<span class="badge badge-sm bg-gradient-success"><i class="fas fa-circle me-1"></i>En ligne</span>':'<span class="badge badge-sm bg-gradient-secondary">Hors ligne</span>'},{key:"statut",label:"Statut",type:"badge",align:"center",badgeColor:l=>l?"success":"secondary",render:l=>l?"Actif":"Inactif"}],a=[{name:"view",label:"Voir",icon:"fas fa-eye",class:"text-dark",onClick:l=>O.push(`/utilisateurs/${l.idUtilisateur}`)},{name:"toggle",label:l=>l.statut?"DÃ©sactiver":"Activer",icon:l=>l.statut?"fas fa-toggle-on":"fas fa-toggle-off",class:l=>l.statut?"text-success":"text-secondary",onClick:l=>I(l)},{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:l=>A(l)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:l=>y(l)}],e=l=>l.photo&&l.photo.length<5e4?l.photo:Z,i=l=>{l.target.src=Z},U=async()=>{var l;p.value=!0,console.log("âš¡ Chargement utilisateurs optimisÃ© (API V_Utilisateur)...");try{let s;!M.value&&$.value?(console.log(`âš¡ Chargement utilisateurs pour sociÃ©tÃ© #${$.value}`),s=await S.getUtilisateursVueBySociete($.value)):(console.log("ðŸ‘‘ SuperAdmin : chargement de tous les utilisateurs"),s=await S.getUtilisateursVue());const n=Array.isArray(s)?s:[];console.log(`âœ… ${n.length} utilisateur(s) chargÃ©(s)`),d.value=n.map(r=>({...r,photo:r.photo&&r.photo.length>1e5?null:r.photo})),await v(),L()}catch(s){console.error("âŒ Erreur chargement:",s),((l=s.response)==null?void 0:l.status)===431?await C("Photos trop volumineuses","Les photos utilisateurs sont trop grandes. Utilisez des images plus petites (max 150x150)."):await C("Erreur","Impossible de charger les utilisateurs"),d.value=[]}finally{p.value=!1}},v=async()=>{try{const l=await S.getRoles(),s={};(Array.isArray(l)?l:[]).forEach(r=>{s[r.idRole]=r.nom||r.name});let n=d.value.map(r=>({...r,nomComplet:r.nomComplet||`${r.nomUtilisateur} ${r.postNomUtilisateur||""} ${r.prenomUtilisateur}`.trim(),siteName:r.nomSite||"",roleName:s[r.idRole]||r.role||""}));d.value=n,console.log("âœ… Utilisateurs chargÃ©s:",d.value.length),console.log("ðŸ“‹ RÃ´les prÃ©sents:",[...new Set(d.value.map(r=>r.roleName))])}catch(l){console.warn("âš ï¸ Erreur noms:",l)}},x=()=>{P.value=null,new W(document.getElementById("utilisateurModal")).show()},A=l=>{P.value={...l},new W(document.getElementById("utilisateurModal")).show()},H=async l=>{var s,n;R("Enregistrement...");try{const r=`${l.prenomUtilisateur||""} ${l.nomUtilisateur||""}`.trim()||"l'utilisateur";l.idUtilisateur&&l.idUtilisateur>0?(await S.updateUser(l.idUtilisateur,l),await E("Gestionnaire modifiÃ© !",`${r} a Ã©tÃ© modifiÃ© avec succÃ¨s`)):(await S.createUser(l),await E("Gestionnaire crÃ©Ã© !",`${r} a Ã©tÃ© crÃ©Ã© avec succÃ¨s`));const Q=W.getInstance(document.getElementById("utilisateurModal"));Q&&Q.hide(),await U()}catch(r){c(),console.error("âŒ Erreur:",r),await C("Erreur",((n=(s=r.response)==null?void 0:s.data)==null?void 0:n.message)||"Erreur de sauvegarde")}},I=async l=>{const s=!l.statut,n=s?"activer":"dÃ©sactiver",r=l.nomComplet||`${l.nomUtilisateur||""} ${l.postNomUtilisateur||""} ${l.prenomUtilisateur||""}`.trim()||"cet utilisateur";if((await T(`${n.charAt(0).toUpperCase()+n.slice(1)} ?`,`Voulez-vous ${n} ${r} ?`,{confirmButtonText:`Oui, ${n}`,confirmButtonColor:s?"#2dce89":"#f5365c"})).isConfirmed){R(`${n.charAt(0).toUpperCase()+n.slice(1)}...`);try{console.log(`ðŸ”„ Toggle statut utilisateur #${l.idUtilisateur} vers ${s}`),await S.toggleUserStatus(l.idUtilisateur,s),c(),await E("Statut modifiÃ© !",`${r} a Ã©tÃ© ${s?"activÃ©":"dÃ©sactivÃ©"} avec succÃ¨s`),await new Promise(ae=>setTimeout(ae,500)),await U()}catch(ee){c(),console.error("âŒ Erreur changement statut:",ee),await C("Erreur","Impossible de modifier le statut")}}},y=async l=>{const s=l.nomComplet||`${l.nomUtilisateur||""} ${l.postNomUtilisateur||""} ${l.prenomUtilisateur||""}`.trim()||"cet utilisateur";if((await T("Supprimer le gestionnaire ?",`Voulez-vous vraiment supprimer ${s} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){R("Suppression...");try{await S.deleteUser(l.idUtilisateur),c(),await E("Gestionnaire supprimÃ© !",`${s} a Ã©tÃ© supprimÃ© avec succÃ¨s`),await U()}catch{c(),await C("Erreur","Impossible de supprimer")}}};return de(()=>{U(),B()}),z($,(l,s)=>{l&&l!==s&&(U(),B())}),(l,s)=>(N(),k("div",tt,[t("div",lt,[t("div",st,[u(xe,{title:"Gestion des Utilisateurs",subtitle:`${d.value.length} utilisateur${d.value.length>1?"s":""} de votre sociÃ©tÃ©`,data:d.value,columns:G,actions:a,"show-search":!0,"search-fields":["nomUtilisateur","prenomUtilisateur","email","login"],loading:p.value,"items-per-page":10,"loading-text":"Chargement des utilisateurs...","empty-text":"Aucun utilisateur trouvÃ©"},{actions:V(()=>[Y(M)?q("",!0):(N(),k("span",ot,[s[0]||(s[0]=t("i",{class:"fas fa-building me-1"},null,-1)),f(" SociÃ©tÃ©: "+b(Y(j).societeName),1)])),u(oe,{color:"success",size:"sm",onClick:x},{default:V(()=>[...s[1]||(s[1]=[t("i",{class:"fas fa-user-plus me-2"},null,-1),f(" Nouvel Utilisateur ",-1)])]),_:1})]),"cell-nomComplet":V(({value:n,row:r})=>[t("div",at,[t("img",{src:e(r),alt:n,class:"rounded-circle me-3",style:{width:"40px",height:"40px","object-fit":"cover",border:"1px solid #e9ecef"},onError:i},null,40,it),t("div",null,[t("h6",nt,b(n),1),t("p",rt,[s[2]||(s[2]=t("i",{class:"fas fa-user me-1"},null,-1)),f(b(r.login),1)])])])]),"cell-email":V(({value:n})=>[t("a",{href:`mailto:${n}`,class:"text-dark text-decoration-none"},[s[3]||(s[3]=t("i",{class:"fas fa-envelope me-1 text-secondary"},null,-1)),f(" "+b(n),1)],8,ut)]),"cell-numeroTelephone":V(({value:n})=>[t("a",{href:`tel:${n}`,class:"text-dark text-decoration-none"},[s[4]||(s[4]=t("i",{class:"fas fa-phone me-1 text-secondary"},null,-1)),f(" "+b(n),1)],8,dt)]),_:1},8,["subtitle","data","loading"])])]),u(et,{utilisateur:P.value,"modal-id":"utilisateurModal",onSave:H,ref_key:"utilisateurModalRef",ref:o},null,8,["utilisateur"]),t("div",mt,[t("div",ct,[t("div",pt,[t("div",vt,[t("div",null,[s[5]||(s[5]=t("h6",{class:"mb-0"},"Sites de la sociÃ©tÃ©",-1)),t("p",ft,b(K.value),1)]),w.value?(N(),k("div",gt,[...s[6]||(s[6]=[t("span",{class:"visually-hidden"},"Chargement...",-1)])])):q("",!0)]),t("div",bt,[t("div",ht,[t("table",xt,[s[13]||(s[13]=t("thead",null,[t("tr",null,[t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-4"},"Site"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Adresse"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Contact"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Statut")])],-1)),t("tbody",null,[!w.value&&!h.value.length?(N(),k("tr",yt,[...s[7]||(s[7]=[t("td",{colspan:"4",class:"text-center py-4 text-muted"}," Aucun site associÃ© nâ€™a Ã©tÃ© trouvÃ© pour votre sociÃ©tÃ©. ",-1)])])):q("",!0),(N(!0),k(ce,null,pe(h.value,n=>(N(),k("tr",{key:n.idSite},[t("td",Ut,[t("h6",St,[s[8]||(s[8]=t("i",{class:"fas fa-store me-2 text-primary"},null,-1)),f(" "+b(n.nomSite||`Site #${n.idSite}`),1)]),n.siteCode?(N(),k("p",$t,[s[9]||(s[9]=t("i",{class:"fas fa-hashtag me-1"},null,-1)),f(b(n.siteCode),1)])):q("",!0)]),t("td",null,[t("p",Ct,[s[10]||(s[10]=t("i",{class:"fas fa-map-marker-alt me-1 text-secondary"},null,-1)),f(" "+b(D(n)),1)])]),t("td",null,[t("p",Rt,[s[11]||(s[11]=t("i",{class:"fas fa-phone-alt me-1 text-secondary"},null,-1)),f(" "+b(J(n)),1)]),n.email?(N(),k("p",wt,[s[12]||(s[12]=t("i",{class:"fas fa-envelope me-1"},null,-1)),f(b(n.email),1)])):q("",!0)]),t("td",null,[t("span",{class:ve(["badge badge-sm",n.statut?"bg-gradient-success":"bg-gradient-secondary"])},b(n.statut?"Actif":"Inactif"),3)])]))),128))])])])])])])])]))}},Tt=le(Nt,[["__scopeId","data-v-2770b4c5"]]);export{Tt as default};
