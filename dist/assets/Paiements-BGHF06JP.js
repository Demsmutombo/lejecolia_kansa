import{M as D}from"./bootstrap-DXdCWnwj.js";import{_ as q,u as F,a as k,d as P,c as G,e as j,f as z}from"./index-CwjmzDsC.js";import{G as K,D as Q}from"./GenericModal-DhdU3Gn5.js";import{a as m,c as Y,w as H,q as O,f as J,o as I,g as L,h as s,K as W,l as B,m as U,p as d,v as Z,Q as ee,D as N,E as X,C as ae}from"./vendor-Bjq3GXyS.js";import{A as w}from"./ArgonSelect-Do4WPwre.js";import"./charts-D32nV7-X.js";const c=r=>(N("data-v-d3f0f5c1"),r=r(),X(),r),te={class:"modal-body-scrollable"},ne={class:"row"},se={class:"col-12 mb-3"},oe=c(()=>s("label",{class:"form-label"},"Type de Transaction *",-1)),le={key:0,class:"row"},ie={class:"col-12 mb-3"},re=c(()=>s("label",{class:"form-label"},"Commande *",-1)),de={key:1,class:"row"},me={class:"col-12 mb-3"},ce=c(()=>s("label",{class:"form-label"},"RÃ©servation *",-1)),ue=c(()=>s("h6",{class:"text-sm mt-3 mb-2"},"DÃ©tails du Paiement",-1)),ve={class:"row"},pe={class:"col-md-6 mb-3"},be=c(()=>s("label",{class:"form-label"},"Date Paiement *",-1)),ge={class:"col-md-6 mb-3"},fe=c(()=>s("label",{class:"form-label"},"Montant *",-1)),ye={class:"row"},he={class:"col-md-6 mb-3"},Pe=c(()=>s("label",{class:"form-label"},"Mode de Paiement *",-1)),_e={class:"col-md-6 mb-3"},Ce=c(()=>s("label",{class:"form-label"},"Statut *",-1)),Se={class:"row"},Re={class:"col-12 mb-3"},we=c(()=>s("label",{class:"form-label"},"RÃ©fÃ©rence Paiement",-1)),Me=c(()=>s("small",{class:"text-muted"},"GÃ©nÃ©rÃ©e automatiquement si vide",-1)),Ee={class:"row"},Ie={class:"col-12 mb-3"},Te=c(()=>s("label",{class:"form-label"},"LibellÃ©",-1)),$e={__name:"PaiementModal",props:{paiement:{type:Object,default:null},modalId:{type:String,default:"paiementModal"}},emits:["save","close"],setup(r,{expose:T,emit:M}){const _=F(),h=r,C=M,b=m(null),g=m(!1),v=m([]),i=m([]),f=m(!1),S=m(!1),E=Y(()=>h.paiement!==null),$=[{value:"commande",label:"Paiement de Commande"},{value:"reservation",label:"Paiement de RÃ©servation"}],R=[{value:"PayÃ©",label:"PayÃ©"},{value:"En attente",label:"En attente"},{value:"RemboursÃ©",label:"RemboursÃ©"},{value:"AnnulÃ©",label:"AnnulÃ©"}],V=[{value:"EspÃ¨ces",label:"EspÃ¨ces"},{value:"Carte bancaire",label:"Carte bancaire"},{value:"Virement",label:"Virement"},{value:"Mobile Money",label:"Mobile Money"},{value:"ChÃ¨que",label:"ChÃ¨que"}],e=m({idPaiement:0,typeTransaction:"commande",idCommande:null,idReservation:null,datePaiement:"",modePaiement:"",montant:0,referencePaiemenet:"",statut:"PayÃ©",libelle:""}),x=()=>{const n=new Date().getTime(),o=Math.floor(Math.random()*1e4);return`PAY-${n}-${o}`},A=async()=>{f.value=!0;try{const a=_.societeId||3,n=await P.getCommandesBySociete(a);v.value=(Array.isArray(n)?n:[]).map(o=>({value:parseInt(o.idCommande,10),label:`Commande #${o.idCommande} - ${o.dateCommande?new Date(o.dateCommande).toLocaleDateString("fr-FR"):""}`})),console.log("âœ… Commandes chargÃ©es:",v.value.length)}catch(a){console.error("âŒ Erreur chargement commandes:",a),v.value=[]}finally{f.value=!1}},t=async()=>{S.value=!0;try{const a=_.societeId||3,n=await P.getReservationsBySociete(a);i.value=(Array.isArray(n)?n:[]).map(o=>({value:parseInt(o.idReservation,10),label:`RÃ©servation #${o.idReservation} - ${o.nomClient}`})),console.log("âœ… RÃ©servations chargÃ©es:",i.value.length)}catch(a){console.error("âŒ Erreur chargement rÃ©servations:",a),i.value=[]}finally{S.value=!1}},l=a=>{a==="commande"?e.value.idReservation=null:a==="reservation"&&(e.value.idCommande=null)};H(()=>h.paiement,a=>{a?e.value={idPaiement:a.idPaiement||0,typeTransaction:a.idCommande?"commande":"reservation",idCommande:a.idCommande?parseInt(a.idCommande,10):null,idReservation:a.idReservation?parseInt(a.idReservation,10):null,datePaiement:a.datePaiement?new Date(a.datePaiement).toISOString().slice(0,16):"",modePaiement:a.modePaiement||"",montant:a.montant||0,referencePaiemenet:a.referencePaiemenet||"",statut:a.statut||"PayÃ©",libelle:a.libelle||""}:p()},{immediate:!1});const p=()=>{const a=new Date().toISOString().slice(0,16);e.value={idPaiement:0,typeTransaction:"commande",idCommande:null,idReservation:null,datePaiement:a,modePaiement:"",montant:0,referencePaiemenet:"",statut:"PayÃ©",libelle:""}},u=()=>e.value.typeTransaction?e.value.typeTransaction==="commande"&&!e.value.idCommande?{valid:!1,message:"La commande est obligatoire"}:e.value.typeTransaction==="reservation"&&!e.value.idReservation?{valid:!1,message:"La rÃ©servation est obligatoire"}:e.value.datePaiement?!e.value.montant||e.value.montant<=0?{valid:!1,message:"Le montant doit Ãªtre supÃ©rieur Ã  0"}:e.value.modePaiement?{valid:!0}:{valid:!1,message:"Le mode de paiement est obligatoire"}:{valid:!1,message:"La date de paiement est obligatoire"}:{valid:!1,message:"Le type de transaction est obligatoire"},y=async()=>{const a=u();if(!a.valid){alert(a.message);return}e.value.referencePaiemenet||(e.value.referencePaiemenet=x()),e.value.libelle||(e.value.libelle=`Paiement ${e.value.modePaiement} - ${e.value.referencePaiemenet}`),g.value=!0;try{const n={...e.value,idCommande:e.value.typeTransaction==="commande"?e.value.idCommande:null,idReservation:e.value.typeTransaction==="reservation"?e.value.idReservation:null,idSociete:_.societeId||3};delete n.typeTransaction,C("save",n)}catch(n){console.error("Erreur lors de la sauvegarde:",n)}finally{g.value=!1}};return O(()=>{A(),t()}),T({resetForm:p,show:()=>{var a;return(a=b.value)==null?void 0:a.show()},hide:()=>{var a;return(a=b.value)==null?void 0:a.hide()},close:()=>{var a;return(a=b.value)==null?void 0:a.hide()}}),(a,n)=>(I(),J(K,{"modal-id":r.modalId,title:`${E.value?"Modifier":"Nouveau"} Paiement`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":g.value,"loading-text":"Enregistrement...",onConfirm:y,ref_key:"modalRef",ref:b},{body:L(()=>[s("div",te,[s("form",{onSubmit:W(y,["prevent"])},[s("div",ne,[s("div",se,[oe,d(w,{modelValue:e.value.typeTransaction,"onUpdate:modelValue":[n[0]||(n[0]=o=>e.value.typeTransaction=o),l],options:$,placeholder:"SÃ©lectionner",disabled:E.value,id:"typeTransaction",name:"typeTransaction"},null,8,["modelValue","disabled"])])]),e.value.typeTransaction==="commande"?(I(),B("div",le,[s("div",ie,[re,d(w,{modelValue:e.value.idCommande,"onUpdate:modelValue":n[1]||(n[1]=o=>e.value.idCommande=o),options:v.value,placeholder:"SÃ©lectionner une commande",disabled:f.value,id:"idCommande",name:"idCommande"},null,8,["modelValue","options","disabled"])])])):U("",!0),e.value.typeTransaction==="reservation"?(I(),B("div",de,[s("div",me,[ce,d(w,{modelValue:e.value.idReservation,"onUpdate:modelValue":n[2]||(n[2]=o=>e.value.idReservation=o),options:i.value,placeholder:"SÃ©lectionner une rÃ©servation",disabled:S.value,id:"idReservation",name:"idReservation"},null,8,["modelValue","options","disabled"])])])):U("",!0),ue,s("div",ve,[s("div",pe,[be,Z(s("input",{"onUpdate:modelValue":n[3]||(n[3]=o=>e.value.datePaiement=o),type:"datetime-local",class:"form-control",required:"",id:"datePaiement",name:"datePaiement"},null,512),[[ee,e.value.datePaiement]])]),s("div",ge,[fe,d(k,{modelValue:e.value.montant,"onUpdate:modelValue":n[4]||(n[4]=o=>e.value.montant=o),type:"number",step:"0.01",placeholder:"0.00","is-required":!0,id:"montant",name:"montant"},null,8,["modelValue"])])]),s("div",ye,[s("div",he,[Pe,d(w,{modelValue:e.value.modePaiement,"onUpdate:modelValue":n[5]||(n[5]=o=>e.value.modePaiement=o),options:V,placeholder:"SÃ©lectionner",id:"modePaiement",name:"modePaiement"},null,8,["modelValue"])]),s("div",_e,[Ce,d(w,{modelValue:e.value.statut,"onUpdate:modelValue":n[6]||(n[6]=o=>e.value.statut=o),options:R,placeholder:"SÃ©lectionner",id:"statut",name:"statut"},null,8,["modelValue"])])]),s("div",Se,[s("div",Re,[we,d(k,{modelValue:e.value.referencePaiemenet,"onUpdate:modelValue":n[7]||(n[7]=o=>e.value.referencePaiemenet=o),placeholder:"REF-XXXXX",id:"referencePaiemenet",name:"referencePaiemenet"},null,8,["modelValue"]),Me])]),s("div",Ee,[s("div",Ie,[Te,d(k,{modelValue:e.value.libelle,"onUpdate:modelValue":n[8]||(n[8]=o=>e.value.libelle=o),placeholder:"Description du paiement",id:"libelle",name:"libelle"},null,8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},Ve=q($e,[["__scopeId","data-v-d3f0f5c1"]]),xe=r=>(N("data-v-70494b1d"),r=r(),X(),r),Ae={class:"container-fluid py-4"},De={class:"row"},ke={class:"col-12"},Le=xe(()=>s("i",{class:"fas fa-plus me-2"},null,-1)),Be={__name:"Paiements",setup(r){const{requireAuth:T}=G(),M=F(),{showConfirm:_,showSuccess:h,showError:C,showLoading:b,close:g}=j();T();const v=m(!1),i=m([]),f=m(null),S=m(null),E=[{key:"idPaiement",label:"NÂ°",type:"index",align:"center"},{key:"referencePaiemenet",label:"RÃ©fÃ©rence",render:t=>`<span class="badge badge-sm bg-gradient-secondary">${t||"-"}</span>`},{key:"datePaiement",label:"Date",render:t=>t?new Date(t).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"},{key:"type",label:"Type",render:(t,l)=>l.idCommande?`<span class="badge badge-sm bg-gradient-info">Commande #${l.idCommande}</span>`:l.idReservation?`<span class="badge badge-sm bg-gradient-warning">RÃ©servation #${l.idReservation}</span>`:"-"},{key:"montant",label:"Montant",align:"end",render:t=>`<strong class="text-success">${(parseFloat(t)||0).toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}</strong>`},{key:"modePaiement",label:"Mode",render:t=>({EspÃ¨ces:'<span class="badge badge-sm bg-gradient-success">ğŸ’µ EspÃ¨ces</span>',"Carte bancaire":'<span class="badge badge-sm bg-gradient-primary">ğŸ’³ Carte</span>',Virement:'<span class="badge badge-sm bg-gradient-info">ğŸ¦ Virement</span>',"Mobile Money":'<span class="badge badge-sm bg-gradient-warning">ğŸ“± Mobile</span>',ChÃ¨que:'<span class="badge badge-sm bg-gradient-secondary">ğŸ“„ ChÃ¨que</span>'})[t]||`<span class="badge badge-sm bg-gradient-secondary">${t}</span>`},{key:"statut",label:"Statut",align:"center",render:t=>({PayÃ©:'<span class="badge badge-sm bg-gradient-success">PayÃ©</span>',"En attente":'<span class="badge badge-sm bg-gradient-warning">En attente</span>',RemboursÃ©:'<span class="badge badge-sm bg-gradient-info">RemboursÃ©</span>',AnnulÃ©:'<span class="badge badge-sm bg-gradient-danger">AnnulÃ©</span>'})[t]||`<span class="badge badge-sm bg-gradient-secondary">${t}</span>`}],$=[{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:t=>e(t)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:t=>A(t)}],R=async()=>{v.value=!0,console.log("ğŸ“¡ Chargement paiements...");try{const t=M.societeId||3,l=await P.getPaiementsBySociete(t);Array.isArray(l)?i.value=l:l!=null&&l.data?i.value=l.data:i.value=[],console.log("âœ… Paiements chargÃ©s:",i.value.length);const p=i.value.reduce((u,y)=>u+(parseFloat(y.montant)||0),0);console.log(`ğŸ’° Total encaissÃ©: ${p.toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}`)}catch(t){console.error("âŒ Erreur chargement paiements:",t),await C("Erreur","Impossible de charger les paiements"),i.value=[]}finally{v.value=!1}},V=()=>{f.value=null,new D(document.getElementById("paiementModal")).show()},e=t=>{f.value={...t},new D(document.getElementById("paiementModal")).show()},x=async t=>{var l,p;b("Enregistrement...");try{const u={...t,idSociete:M.societeId||3};t.idPaiement&&t.idPaiement>0?(await P.updatePaiement(t.idPaiement,u),await h("ModifiÃ© !","Paiement modifiÃ©")):(await P.createPaiement(u),await h("CrÃ©Ã© !","Paiement crÃ©Ã©"));const y=D.getInstance(document.getElementById("paiementModal"));y&&y.hide(),await R()}catch(u){g(),console.error("âŒ Erreur:",u),await C("Erreur",((p=(l=u.response)==null?void 0:l.data)==null?void 0:p.message)||"Erreur de sauvegarde")}},A=async t=>{if((await _("Supprimer ?",`Supprimer le paiement ${t.referencePaiemenet} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){b("Suppression...");try{await P.deletePaiement(t.idPaiement),g(),await h("SupprimÃ© !"),await R()}catch{g(),await C("Erreur","Impossible de supprimer")}}};return O(()=>{R()}),(t,l)=>(I(),B("div",Ae,[s("div",De,[s("div",ke,[d(Q,{title:"Gestion des Paiements",subtitle:"Paiements Lejecolia",data:i.value,columns:E,actions:$,"show-search":!0,"search-fields":["referencePaiemenet","modePaiement","statut","libelle"],loading:v.value,"items-per-page":10,"loading-text":"Chargement des paiements...","empty-text":"Aucun paiement trouvÃ©"},{actions:L(()=>[d(z,{color:"success",size:"sm",onClick:V},{default:L(()=>[Le,ae(" Nouveau Paiement ")]),_:1})]),_:1},8,["data","loading"])])]),d(Ve,{paiement:f.value,"modal-id":"paiementModal",onSave:x,ref_key:"paiementModalRef",ref:S},null,8,["paiement"])]))}},Ge=q(Be,[["__scopeId","data-v-70494b1d"]]);export{Ge as default};
