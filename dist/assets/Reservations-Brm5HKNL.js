import{M as B}from"./bootstrap-DXdCWnwj.js";import{_ as X,u as j,a as S,d as v,c as Y,e as Z,f as ee}from"./index-CwjmzDsC.js";import{G as te,D as ae}from"./GenericModal-DhdU3Gn5.js";import{a as g,c as oe,w as N,q as K,f as se,o as M,g as H,h as t,K as le,p,v as U,Q as E,l as z,t as Q,D as W,E as J,C as G}from"./vendor-Bjq3GXyS.js";import{A as O}from"./ArgonSelect-Do4WPwre.js";import"./charts-D32nV7-X.js";const i=d=>(W("data-v-c1415d67"),d=d(),J(),d),ne={class:"modal-body-scrollable"},ie=i(()=>t("h6",{class:"text-sm mt-0 mb-2"},"Client",-1)),re={class:"row"},ce={class:"col-md-6 mb-3"},de=i(()=>t("label",{class:"form-label"},"Nom *",-1)),ue={class:"col-md-6 mb-3"},me=i(()=>t("label",{class:"form-label"},"T√©l√©phone *",-1)),pe={class:"row"},ve={class:"col-12 mb-3"},ge=i(()=>t("label",{class:"form-label"},"Adresse",-1)),fe=i(()=>t("h6",{class:"text-sm mt-3 mb-2"},"D√©tails R√©servation",-1)),be={class:"row"},he={class:"col-md-6 mb-3"},_e=i(()=>t("label",{class:"form-label"},"Article *",-1)),xe={class:"col-md-6 mb-3"},Ae=i(()=>t("label",{class:"form-label"},"Quantit√© *",-1)),ye={class:"row"},Ce={class:"col-md-6 mb-3"},Se=i(()=>t("label",{class:"form-label"},"Date D√©but *",-1)),Re={class:"col-md-6 mb-3"},we=i(()=>t("label",{class:"form-label"},"Date Fin *",-1)),Fe=i(()=>t("h6",{class:"text-sm mt-3 mb-2"},"üí∞ Montants (en Franc Congolais)",-1)),De={class:"row"},Ie={class:"col-md-6 mb-3"},Ue=i(()=>t("label",{class:"form-label"},"Prix Unitaire (FC) *",-1)),Ee={key:0,class:"p-3 bg-gradient-info text-white rounded-3 text-center"},Me={class:"mb-0 text-white"},ke=i(()=>t("small",{class:"opacity-8"},"üîÑ R√©cup√©r√© automatiquement",-1)),Ve={key:1,class:"p-3 bg-light text-secondary rounded-3 text-center"},Te=i(()=>t("h6",{class:"mb-0 text-secondary"},[t("i",{class:"fas fa-arrow-up me-2"}),G(" S√©lectionnez un article ")],-1)),Pe=i(()=>t("small",{class:"text-xs"},"Le prix sera charg√© automatiquement",-1)),qe=[Te,Pe],$e=i(()=>t("small",{class:"text-muted d-block mt-2"},[t("i",{class:"fas fa-info-circle me-1"}),G(" Le prix est automatiquement charg√© depuis l'article s√©lectionn√© ")],-1)),Le={class:"col-md-6 mb-3"},Be=i(()=>t("label",{class:"form-label"},"Montant Total",-1)),Ne={class:"p-3 bg-gradient-success text-white rounded-3 text-center"},Oe={class:"mb-0 text-white"},He=i(()=>t("small",{class:"opacity-8"},"Prix √ó Quantit√©",-1)),ze={class:"row"},Ge={class:"col-md-6 mb-3"},Qe=i(()=>t("label",{class:"form-label"},"Montant Avanc√© (FC)",-1)),Xe=i(()=>t("small",{class:"text-muted"},"Acompte vers√© par le client",-1)),je={class:"col-md-6 mb-3"},Ke=i(()=>t("label",{class:"form-label"},"Mode Paiement",-1)),We={class:"row"},Je={class:"col-md-6 mb-3"},Ye=i(()=>t("label",{class:"form-label"},"Statut",-1)),Ze={class:"col-md-6 mb-3"},et=i(()=>t("label",{class:"form-label"},"Date R√©servation",-1)),tt={class:"row"},at={class:"col-12 mb-3"},ot=i(()=>t("label",{class:"form-label"},"Commentaire",-1)),st={__name:"ReservationModal",props:{reservation:{type:Object,default:null},modalId:{type:String,default:"reservationModal"}},emits:["save","close"],setup(d,{expose:k,emit:R}){const w=j(),A=d,C=R,h=g(null),_=g(!1),f=g([]),r=g([]),x=g(!1),V=oe(()=>A.reservation!==null),T=[{value:"En attente",label:"En attente"},{value:"Confirm√©e",label:"Confirm√©e"},{value:"En cours",label:"En cours"},{value:"Termin√©e",label:"Termin√©e"},{value:"Annul√©e",label:"Annul√©e"}],P=[{value:"Esp√®ces",label:"Esp√®ces"},{value:"Carte bancaire",label:"Carte bancaire"},{value:"Virement",label:"Virement"},{value:"Mobile Money",label:"Mobile Money"}],o=g({idReservation:0,idArticle:"",nomClient:"",telephoneClient:"",adresseClient:"",dateDebut:"",dateFin:"",dateReservation:"",prixUnitaire:0,quantite:"1",montantTotal:0,montantAvance:"0",commentaire:"",modePaiement:"",statut:"En attente"}),q=async()=>{x.value=!0;try{const e=w.societeId;let s;e?s=await v.getArticlesBySociete(e):s=await v.getArticles(),r.value=Array.isArray(s)?s:[],console.log("üìã Articles complets charg√©s:",r.value.length),console.log("üîç TOUS les articles:",r.value),f.value=r.value.map(a=>(console.log("üìù Formatage article:",a),{value:parseInt(a.idArticle,10),label:a.libelle||a.nom||`Article #${a.idArticle}`,prix:a.prix||a.prixVente||a.prixUnitaire||a.prixVentHT||0})),console.log("‚úÖ Articles format√©s pour dropdown:",f.value)}catch(e){console.error("‚ùå Erreur chargement articles:",e),f.value=[],r.value=[]}finally{x.value=!1}},F=async e=>{if(!e){console.warn("‚ö†Ô∏è Aucun article s√©lectionn√©");return}try{const s=parseInt(e,10);console.log("üí∞ === R√âCUP√âRATION PRIX ARTICLE #"+s+" ===");const a=r.value.find(m=>parseInt(m.idArticle,10)===s);if(console.log("üîç Article trouv√© dans articlesData:",a),a){console.log("üîç Structure compl√®te de l'article:",a);const m=[a.prix,a.prixVente,a.prixUnitaire,a.prixVentHT,a.tarif,a.montant,a.prixBase];console.log("üîç Prix possibles dans article:",{prix:a.prix,prixVente:a.prixVente,prixUnitaire:a.prixUnitaire,prixVentHT:a.prixVentHT,tarif:a.tarif,montant:a.montant,prixBase:a.prixBase});const c=m.find(L=>L!=null&&parseFloat(L)>0);if(c){o.value.prixUnitaire=parseFloat(c),console.log("‚úÖ Prix r√©cup√©r√© depuis article:",c,"FC"),b();return}}console.log("üîç Recherche prix dans V_StockArticleSite...");const I=w.societeId,y=I?await v.getStocksVueBySociete(I):await v.getStocksVue();if(console.log("üìã Stocks charg√©s (Vue):",(y==null?void 0:y.length)||0),Array.isArray(y)){console.log("üîç Liste de tous les idArticle dans stocks:",y.map(c=>c.idArticle));const m=y.find(c=>parseInt(c.idArticle,10)===s);if(console.log("üîç Stock trouv√© pour article #"+s+":",m),m){console.log("üì¶ Structure compl√®te du stock:",m);const c=m.prixVentHT||m.prixVente||m.prix||m.prixUnitaire;if(console.log("üîç Prix dans stock:",c),c&&parseFloat(c)>0){o.value.prixUnitaire=parseFloat(c),console.log("‚úÖ Prix r√©cup√©r√© depuis stock:",c,"FC"),b();return}}else console.error("‚ùå Aucun stock trouv√© pour l'article #"+s),console.log("üí° L'article existe mais n'a pas de stock dans cette soci√©t√©")}console.error("‚ùå AUCUN PRIX TROUV√â pour article #"+s),console.warn("üí° V√©rifiez que l'article a un prix d√©fini dans la base de donn√©es"),o.value.prixUnitaire=0,b()}catch(s){console.error("‚ùå Erreur r√©cup√©ration prix:",s),o.value.prixUnitaire=0,b()}},$=e=>{console.log("üîÑ Article chang√©:",e);const s=typeof e=="string"?parseInt(e,10):e;if(console.log("üîÑ ID Article converti:",s),s&&s>0){o.value.idArticle=s;const a=f.value.find(I=>I.value===s);console.log("üîç Option article trouv√©e:",a),a&&a.prix&&a.prix>0?(o.value.prixUnitaire=parseFloat(a.prix),console.log("‚úÖ Prix r√©cup√©r√© depuis dropdown:",a.prix,"FC"),b()):(console.log("‚ö†Ô∏è Pas de prix dans dropdown, recherche dans les donn√©es..."),F(s))}},b=()=>{const e=parseFloat(o.value.prixUnitaire)||0,s=parseFloat(o.value.quantite)||0;o.value.montantTotal=e*s,console.log(`üí∞ Calcul: ${e} FC √ó ${s} = ${o.value.montantTotal} FC`)},D=e=>(parseFloat(e)||0).toLocaleString("fr-CD",{minimumFractionDigits:2,maximumFractionDigits:2});N(()=>A.reservation,e=>{e?o.value={idReservation:e.idReservation||0,idArticle:e.idArticle?parseInt(e.idArticle,10):"",nomClient:e.nomClient||"",telephoneClient:e.telephoneClient||"",adresseClient:e.adresseClient||"",dateDebut:e.dateDebut?new Date(e.dateDebut).toISOString().slice(0,16):"",dateFin:e.dateFin?new Date(e.dateFin).toISOString().slice(0,16):"",dateReservation:e.dateReservation?new Date(e.dateReservation).toISOString().slice(0,16):"",prixUnitaire:e.prixUnitaire||0,quantite:String(e.quantite||1),montantTotal:e.montantTotal||0,montantAvance:String(e.montantAvance||0),commentaire:e.commentaire||"",modePaiement:e.modePaiement||"",statut:e.statut||"En attente"}:l()},{immediate:!1});const l=()=>{const e=new Date().toISOString().slice(0,16);o.value={idReservation:0,idArticle:"",nomClient:"",telephoneClient:"",adresseClient:"",dateDebut:e,dateFin:"",dateReservation:e,prixUnitaire:0,quantite:"1",montantTotal:0,montantAvance:"0",commentaire:"",modePaiement:"",statut:"En attente"}},n=()=>o.value.nomClient?o.value.telephoneClient?o.value.idArticle?o.value.dateDebut?o.value.dateFin?{valid:!0}:{valid:!1,message:"La date de fin est obligatoire"}:{valid:!1,message:"La date de d√©but est obligatoire"}:{valid:!1,message:"L'article est obligatoire"}:{valid:!1,message:"Le t√©l√©phone est obligatoire"}:{valid:!1,message:"Le nom du client est obligatoire"},u=async()=>{const e=n();if(!e.valid){alert(e.message);return}_.value=!0;try{C("save",o.value)}catch(s){console.error("Erreur lors de la sauvegarde:",s)}finally{_.value=!1}};return K(()=>{q()}),N(()=>o.value.idArticle,e=>{e&&F(e)}),N([()=>o.value.quantite,()=>o.value.prixUnitaire],()=>{b()}),k({resetForm:l,show:()=>{var e;return(e=h.value)==null?void 0:e.show()},hide:()=>{var e;return(e=h.value)==null?void 0:e.hide()},close:()=>{var e;return(e=h.value)==null?void 0:e.hide()}}),(e,s)=>(M(),se(te,{"modal-id":d.modalId,title:`${V.value?"Modifier":"Nouvelle"} R√©servation`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":_.value,"loading-text":"Enregistrement...",onConfirm:u,ref_key:"modalRef",ref:h},{body:H(()=>[t("div",ne,[t("form",{onSubmit:le(u,["prevent"])},[ie,t("div",re,[t("div",ce,[de,p(S,{modelValue:o.value.nomClient,"onUpdate:modelValue":s[0]||(s[0]=a=>o.value.nomClient=a),placeholder:"Nom du client","is-required":!0,id:"nomClient",name:"nomClient"},null,8,["modelValue"])]),t("div",ue,[me,p(S,{modelValue:o.value.telephoneClient,"onUpdate:modelValue":s[1]||(s[1]=a=>o.value.telephoneClient=a),placeholder:"+243 123 456 789","is-required":!0,id:"telephoneClient",name:"telephoneClient"},null,8,["modelValue"])])]),t("div",pe,[t("div",ve,[ge,p(S,{modelValue:o.value.adresseClient,"onUpdate:modelValue":s[2]||(s[2]=a=>o.value.adresseClient=a),placeholder:"Adresse du client",id:"adresseClient",name:"adresseClient"},null,8,["modelValue"])])]),fe,t("div",be,[t("div",he,[_e,p(O,{modelValue:o.value.idArticle,"onUpdate:modelValue":[s[3]||(s[3]=a=>o.value.idArticle=a),$],options:f.value,placeholder:"S√©lectionner un article",disabled:x.value,id:"idArticle",name:"idArticle"},null,8,["modelValue","options","disabled"])]),t("div",xe,[Ae,p(S,{modelValue:o.value.quantite,"onUpdate:modelValue":s[4]||(s[4]=a=>o.value.quantite=a),type:"number",step:"1",placeholder:"1","is-required":!0,id:"quantite",name:"quantite"},null,8,["modelValue"])])]),t("div",ye,[t("div",Ce,[Se,U(t("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>o.value.dateDebut=a),type:"datetime-local",class:"form-control",required:"",id:"dateDebut",name:"dateDebut"},null,512),[[E,o.value.dateDebut]])]),t("div",Re,[we,U(t("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>o.value.dateFin=a),type:"datetime-local",class:"form-control",required:"",id:"dateFin",name:"dateFin"},null,512),[[E,o.value.dateFin]])])]),Fe,t("div",De,[t("div",Ie,[Ue,o.value.prixUnitaire>0?(M(),z("div",Ee,[t("h5",Me,Q(D(o.value.prixUnitaire))+" FC",1),ke])):(M(),z("div",Ve,qe)),$e]),t("div",Le,[Be,t("div",Ne,[t("h5",Oe,Q(D(o.value.montantTotal))+" FC",1),He])])]),t("div",ze,[t("div",Ge,[Qe,p(S,{modelValue:o.value.montantAvance,"onUpdate:modelValue":s[7]||(s[7]=a=>o.value.montantAvance=a),type:"number",step:"0.01",placeholder:"0.00",id:"montantAvance",name:"montantAvance"},null,8,["modelValue"]),Xe]),t("div",je,[Ke,p(O,{modelValue:o.value.modePaiement,"onUpdate:modelValue":s[8]||(s[8]=a=>o.value.modePaiement=a),options:P,placeholder:"S√©lectionner",id:"modePaiement",name:"modePaiement"},null,8,["modelValue"])])]),t("div",We,[t("div",Je,[Ye,p(O,{modelValue:o.value.statut,"onUpdate:modelValue":s[9]||(s[9]=a=>o.value.statut=a),options:T,placeholder:"S√©lectionner",id:"statut",name:"statut"},null,8,["modelValue"])]),t("div",Ze,[et,U(t("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>o.value.dateReservation=a),type:"datetime-local",class:"form-control",id:"dateReservation",name:"dateReservation"},null,512),[[E,o.value.dateReservation]])])]),t("div",tt,[t("div",at,[ot,U(t("textarea",{"onUpdate:modelValue":s[11]||(s[11]=a=>o.value.commentaire=a),class:"form-control",rows:"3",placeholder:"Commentaire ou notes...",id:"commentaire",name:"commentaire"},null,512),[[E,o.value.commentaire]])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},lt=X(st,[["__scopeId","data-v-c1415d67"]]),nt=d=>(W("data-v-f67fec38"),d=d(),J(),d),it={class:"container-fluid py-4"},rt={class:"row"},ct={class:"col-12"},dt=nt(()=>t("i",{class:"fas fa-calendar-plus me-2"},null,-1)),ut={__name:"Reservations",setup(d){const{requireAuth:k}=Y(),R=j(),{showConfirm:w,showSuccess:A,showError:C,showLoading:h,close:_}=Z();k();const f=g(!1),r=g([]),x=g(null),V=g(null),T=[{key:"idReservation",label:"N¬∞",type:"index",align:"center"},{key:"nomClient",label:"Client",render:(l,n)=>`<div>
        <p class="mb-0 text-sm font-weight-bold">${l}</p>
        <p class="mb-0 text-xs text-secondary">${n.telephoneClient||"-"}</p>
      </div>`},{key:"articleNom",label:"Article",render:(l,n)=>l||`Article #${n.idArticle}`},{key:"periode",label:"P√©riode",render:(l,n)=>{const u=n.dateDebut?new Date(n.dateDebut).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):"",e=n.dateFin?new Date(n.dateFin).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):"";return`${u} ‚Üí ${e}`}},{key:"montantTotal",label:"Montant",align:"end",render:l=>`<strong>${(parseFloat(l)||0).toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}</strong>`},{key:"montantAvance",label:"Avanc√©",align:"end",render:l=>{const n=parseFloat(l)||0;return n>0?n.toLocaleString("fr-CD",{style:"currency",currency:"CDF"}):"-"}},{key:"statut",label:"Statut",align:"center",render:l=>({"En attente":'<span class="badge badge-sm bg-gradient-warning">En attente</span>',Confirm√©e:'<span class="badge badge-sm bg-gradient-info">Confirm√©e</span>',"En cours":'<span class="badge badge-sm bg-gradient-primary">En cours</span>',Termin√©e:'<span class="badge badge-sm bg-gradient-success">Termin√©e</span>',Annul√©e:'<span class="badge badge-sm bg-gradient-danger">Annul√©e</span>'})[l]||`<span class="badge badge-sm bg-gradient-secondary">${l}</span>`}],P=[{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:l=>$(l)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:l=>D(l)}],o=async()=>{f.value=!0,console.log("üì° Chargement r√©servations...");try{const l=R.societeId;let n;l?n=await v.getReservationsBySociete(l):n=await v.getReservations(),Array.isArray(n)?r.value=n:n!=null&&n.data?r.value=n.data:r.value=[],console.log("‚úÖ R√©servations charg√©es:",r.value.length),await q()}catch(l){console.error("‚ùå Erreur chargement r√©servations:",l),await C("Erreur","Impossible de charger les r√©servations"),r.value=[]}finally{f.value=!1}},q=async()=>{try{const l=R.societeId,n=l?await v.getArticlesBySociete(l):await v.getArticles(),u={};(Array.isArray(n)?n:[]).forEach(e=>{u[e.idArticle]=e.libelle}),r.value=r.value.map(e=>({...e,articleNom:u[e.idArticle]||""}))}catch(l){console.warn("‚ö†Ô∏è Impossible de charger les articles:",l)}},F=()=>{x.value=null,new B(document.getElementById("reservationModal")).show()},$=l=>{x.value={...l},new B(document.getElementById("reservationModal")).show()},b=async l=>{var n,u;h("Enregistrement...");try{l.idReservation&&l.idReservation>0?(await v.updateReservation(l.idReservation,l),await A("Modifi√© !","R√©servation modifi√©e")):(await v.createReservation(l),await A("Cr√©√© !","R√©servation cr√©√©e"));const e=B.getInstance(document.getElementById("reservationModal"));e&&e.hide(),await o()}catch(e){_(),console.error("‚ùå Erreur:",e),await C("Erreur",((u=(n=e.response)==null?void 0:n.data)==null?void 0:u.message)||"Erreur de sauvegarde")}},D=async l=>{if((await w("Supprimer ?",`Supprimer la r√©servation de ${l.nomClient} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){h("Suppression...");try{await v.deleteReservation(l.idReservation),_(),await A("Supprim√© !"),await o()}catch{_(),await C("Erreur","Impossible de supprimer")}}};return K(()=>{o()}),(l,n)=>(M(),z("div",it,[t("div",rt,[t("div",ct,[p(ae,{title:"Gestion des R√©servations",subtitle:"R√©servations de votre entreprise",data:r.value,columns:T,actions:P,"show-search":!0,"search-fields":["nomClient","telephoneClient","articleNom","statut"],loading:f.value,"items-per-page":10,"loading-text":"Chargement des r√©servations...","empty-text":"Aucune r√©servation trouv√©e"},{actions:H(()=>[p(ee,{color:"success",size:"sm",onClick:F},{default:H(()=>[dt,G(" Nouvelle R√©servation ")]),_:1})]),_:1},8,["data","loading"])])]),p(lt,{reservation:x.value,"modal-id":"reservationModal",onSave:b,ref_key:"reservationModalRef",ref:V},null,8,["reservation"])]))}},ht=X(ut,[["__scopeId","data-v-f67fec38"]]);export{ht as default};
