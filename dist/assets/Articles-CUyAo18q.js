import{a as f,c as L,w as P,f as G,o as M,g,h as s,K as q,p as d,C as k,D as R,E as V,q as z,l as j,u as D}from"./vendor-Bjq3GXyS.js";import{M as x}from"./bootstrap-DXdCWnwj.js";import{_ as Q,u as N,a as S,b as E,c as K,d as _,e as W,f as H}from"./index-CwjmzDsC.js";import{G as J,D as X}from"./GenericModal-DhdU3Gn5.js";import"./charts-D32nV7-X.js";const C=r=>(R("data-v-1b57be24"),r=r(),V(),r),Y={class:"modal-body-scrollable"},Z={class:"row"},ee={class:"col-12 mb-3"},te=C(()=>s("label",{class:"form-label"},"LibellÃ© *",-1)),ae={class:"row"},le={class:"col-md-6 mb-3"},se=C(()=>s("label",{class:"form-label"},"TVA (%)",-1)),oe={class:"col-md-6 mb-3"},ie=C(()=>s("label",{class:"form-label"},"Remise (%)",-1)),re={class:"row"},ce={class:"col-12 mb-3"},de=C(()=>s("label",{class:"form-label"},"Code Barre / QR",-1)),ne={class:"row"},ue={class:"col-md-4 mb-3"},me={class:"col-md-4 mb-3"},fe={class:"col-md-4 mb-3"},pe={__name:"ArticleModal",props:{article:{type:Object,default:null},modalId:{type:String,default:"articleModal"}},emits:["save","close"],setup(r,{expose:B,emit:A}){const p=N(),m=r,v=A,u=f(null),n=f(!1),y=L(()=>m.article!==null),t=f({idArticle:0,libelle:"",tva:0,codeBarreQR:"",idSociete:0,perissable:!1,remise:0,withStock:!1,statut:!0});P(()=>m.article,a=>{a?t.value={idArticle:a.idArticle||0,libelle:a.libelle||"",tva:a.tva||0,codeBarreQR:a.codeBarreQR||"",idSociete:a.idSociete||p.societeId||0,perissable:a.perissable||!1,remise:a.remise||0,withStock:a.withStock||!1,statut:a.statut!==void 0?a.statut:!0}:b()},{immediate:!1});const b=()=>{t.value={idArticle:0,libelle:"",tva:0,codeBarreQR:"",idSociete:p.societeId||0,perissable:!1,remise:0,withStock:!1,statut:!0}},I=()=>t.value.libelle?{valid:!0}:{valid:!1,message:"Le libellÃ© est obligatoire"},w=async()=>{const a=I();if(!a.valid){alert(a.message);return}n.value=!0;try{t.value.idSociete||(t.value.idSociete=p.societeId),v("save",t.value)}catch(l){console.error("Erreur lors de la sauvegarde:",l)}finally{n.value=!1}};return B({resetForm:b,show:()=>{var a;return(a=u.value)==null?void 0:a.show()},hide:()=>{var a;return(a=u.value)==null?void 0:a.hide()},close:()=>{var a;return(a=u.value)==null?void 0:a.hide()}}),(a,l)=>(M(),G(J,{"modal-id":r.modalId,title:`${y.value?"Modifier":"Nouvel"} Article`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":n.value,"loading-text":"Enregistrement...",onConfirm:w,ref_key:"modalRef",ref:u},{body:g(()=>[s("div",Y,[s("form",{onSubmit:q(w,["prevent"])},[s("div",Z,[s("div",ee,[te,d(S,{modelValue:t.value.libelle,"onUpdate:modelValue":l[0]||(l[0]=i=>t.value.libelle=i),placeholder:"Ex: CONCEPTION LOGO","is-required":!0,id:"libelle",name:"libelle"},null,8,["modelValue"])])]),s("div",ae,[s("div",le,[se,d(S,{modelValue:t.value.tva,"onUpdate:modelValue":l[1]||(l[1]=i=>t.value.tva=i),type:"number",step:"0.01",placeholder:"0.00",id:"tva",name:"tva"},null,8,["modelValue"])]),s("div",oe,[ie,d(S,{modelValue:t.value.remise,"onUpdate:modelValue":l[2]||(l[2]=i=>t.value.remise=i),type:"number",step:"0.01",placeholder:"0.00",id:"remise",name:"remise"},null,8,["modelValue"])])]),s("div",re,[s("div",ce,[de,d(S,{modelValue:t.value.codeBarreQR,"onUpdate:modelValue":l[3]||(l[3]=i=>t.value.codeBarreQR=i),placeholder:"Code barre ou QR (optionnel)",id:"codeBarreQR",name:"codeBarreQR"},null,8,["modelValue"])])]),s("div",ne,[s("div",ue,[d(E,{modelValue:t.value.perissable,"onUpdate:modelValue":l[4]||(l[4]=i=>t.value.perissable=i),id:"articlePerissable",name:"perissable"},{default:g(()=>[k(" PÃ©rissable ")]),_:1},8,["modelValue"])]),s("div",me,[d(E,{modelValue:t.value.withStock,"onUpdate:modelValue":l[5]||(l[5]=i=>t.value.withStock=i),id:"articleWithStock",name:"withStock"},{default:g(()=>[k(" Avec Stock ")]),_:1},8,["modelValue"])]),s("div",fe,[d(E,{modelValue:t.value.statut,"onUpdate:modelValue":l[6]||(l[6]=i=>t.value.statut=i),id:"articleStatut",name:"statut"},{default:g(()=>[k(" Actif ")]),_:1},8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},ve=Q(pe,[["__scopeId","data-v-1b57be24"]]),be=r=>(R("data-v-8f8d6465"),r=r(),V(),r),he={class:"container-fluid py-4"},_e={class:"row"},ge={class:"col-12"},ye=be(()=>s("i",{class:"fas fa-plus me-2"},null,-1)),Ae={__name:"Articles",setup(r){D();const{requireAuth:B}=K(),A=N(),{showConfirm:p,showSuccess:m,showError:v,showLoading:u,close:n}=W();B();const y=f(!1),t=f([]),b=f(null),I=f(null),w=[{key:"idArticle",label:"NÂ°",type:"index",align:"center"},{key:"libelle",label:"Article",render:e=>`<strong>${e}</strong>`},{key:"tva",label:"TVA",align:"center",render:e=>`${parseFloat(e||0).toFixed(2)}%`},{key:"remise",label:"Remise",align:"center",render:e=>`${parseFloat(e||0).toFixed(2)}%`},{key:"codeBarreQR",label:"Code Barre",render:e=>e||"-"},{key:"perissable",label:"PÃ©rissable",type:"badge",align:"center",badgeColor:e=>e?"warning":"secondary",render:e=>e?"Oui":"Non"},{key:"withStock",label:"Stock",type:"badge",align:"center",badgeColor:e=>e?"info":"secondary",render:e=>e?"Oui":"Non"},{key:"statut",label:"Statut",type:"badge",align:"center",badgeColor:e=>e?"success":"secondary",render:e=>e?"Actif":"Inactif"}],a=[{name:"toggle",label:e=>e.statut?"DÃ©sactiver":"Activer",icon:e=>e.statut?"fas fa-toggle-on":"fas fa-toggle-off",class:e=>e.statut?"text-success":"text-secondary",onClick:e=>T(e)},{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:e=>O(e)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:e=>F(e)}],l=async()=>{y.value=!0,console.log("ðŸ“¡ Chargement articles pour sociÃ©tÃ©:",A.societeId);try{const e=A.societeId;if(e){const o=await _.getArticlesBySociete(e);Array.isArray(o)?t.value=o:o!=null&&o.data?t.value=o.data:t.value=[],console.log("âœ… Articles chargÃ©s:",t.value.length)}else{console.warn("âš ï¸ Pas de societeId - Chargement de tous les articles");const o=await _.getArticles();t.value=Array.isArray(o)?o:[]}}catch(e){console.error("âŒ Erreur chargement articles:",e),await v("Erreur","Impossible de charger les articles"),t.value=[]}finally{y.value=!1}},i=()=>{b.value=null,new x(document.getElementById("articleModal")).show()},O=e=>{b.value={...e},new x(document.getElementById("articleModal")).show()},U=async e=>{var o,c;u("Enregistrement...");try{e.idArticle&&e.idArticle>0?(await _.updateArticle(e.idArticle,e),await m("ModifiÃ© !",`${e.libelle} modifiÃ©`)):(await _.createArticle(e),await m("CrÃ©Ã© !",`${e.libelle} crÃ©Ã©`));const h=x.getInstance(document.getElementById("articleModal"));h&&h.hide(),await l()}catch(h){n(),console.error("âŒ Erreur:",h),await v("Erreur",((c=(o=h.response)==null?void 0:o.data)==null?void 0:c.message)||"Erreur de sauvegarde")}},T=async e=>{const o=!e.statut,c=o?"activer":"dÃ©sactiver";if((await p(`${c.charAt(0).toUpperCase()+c.slice(1)} ?`,`Voulez-vous ${c} "${e.libelle}" ?`,{confirmButtonText:`Oui, ${c}`,confirmButtonColor:o?"#2dce89":"#f5365c"})).isConfirmed){u(`${c.charAt(0).toUpperCase()+c.slice(1)}...`);try{const $={...e,statut:o};await _.updateArticle(e.idArticle,$),n(),await m("Statut modifiÃ© !"),await l()}catch{n(),await v("Erreur","Impossible de modifier le statut")}}},F=async e=>{if((await p("Supprimer ?",`Supprimer "${e.libelle}" ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){u("Suppression...");try{await _.deleteArticle(e.idArticle),n(),await m("SupprimÃ© !"),await l()}catch{n(),await v("Erreur","Impossible de supprimer")}}};return z(()=>{l()}),(e,o)=>(M(),j("div",he,[s("div",_e,[s("div",ge,[d(X,{title:"Gestion des Articles",subtitle:"Articles et produits de votre sociÃ©tÃ©",data:t.value,columns:w,actions:a,"show-search":!0,"search-fields":["libelle","codeBarreQR"],loading:y.value,"items-per-page":10,"loading-text":"Chargement des articles...","empty-text":"Aucun article trouvÃ©"},{actions:g(()=>[d(H,{color:"success",size:"sm",onClick:i},{default:g(()=>[ye,k(" Nouvel Article ")]),_:1})]),_:1},8,["data","loading"])])]),d(ve,{article:b.value,"modal-id":"articleModal",onSave:U,ref_key:"articleModalRef",ref:I},null,8,["article"])]))}},Ie=Q(Ae,[["__scopeId","data-v-8f8d6465"]]);export{Ie as default};
