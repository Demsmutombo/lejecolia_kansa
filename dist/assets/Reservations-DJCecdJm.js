import{M as L}from"./bootstrap-DXdCWnwj.js";import{_ as Q,u as X,a as h,d as m,c as W,e as J,f as K}from"./index-C7KYosbF.js";import{G as Y,D as Z}from"./GenericModal-D2OVyllk.js";import{a as p,c as ee,w as B,q as j,f as te,o as I,g as O,h as a,I as ae,p as u,v as U,O as E,l as H,t as G,C as z}from"./vendor-5ChSB122.js";import{A as N}from"./ArgonSelect-BIJzuYL2.js";import"./charts-D32nV7-X.js";const oe={class:"modal-body-scrollable"},le={class:"row"},se={class:"col-md-6 mb-3"},ne={class:"col-md-6 mb-3"},ie={class:"row"},re={class:"col-12 mb-3"},de={class:"row"},ce={class:"col-md-6 mb-3"},ue={class:"col-md-6 mb-3"},me={class:"row"},pe={class:"col-md-6 mb-3"},ve={class:"col-md-6 mb-3"},ge={class:"row"},fe={class:"col-md-6 mb-3"},be={key:0,class:"p-3 bg-gradient-info text-white rounded-3 text-center"},xe={class:"mb-0 text-white"},Ae={key:1,class:"p-3 bg-light text-secondary rounded-3 text-center"},ye={class:"col-md-6 mb-3"},Ce={class:"p-3 bg-gradient-success text-white rounded-3 text-center"},he={class:"mb-0 text-white"},Se={class:"row"},Re={class:"col-md-6 mb-3"},we={class:"col-md-6 mb-3"},Fe={class:"row"},De={class:"col-md-6 mb-3"},Ue={class:"col-md-6 mb-3"},Ee={class:"row"},Ie={class:"col-12 mb-3"},Me={__name:"ReservationModal",props:{reservation:{type:Object,default:null},modalId:{type:String,default:"reservationModal"}},emits:["save","close"],setup(M,{expose:k,emit:S}){const R=X(),A=M,C=S,f=p(null),b=p(!1),v=p([]),i=p([]),x=p(!1),V=ee(()=>A.reservation!==null),T=[{value:"En attente",label:"En attente"},{value:"Confirm√©e",label:"Confirm√©e"},{value:"En cours",label:"En cours"},{value:"Termin√©e",label:"Termin√©e"},{value:"Annul√©e",label:"Annul√©e"}],P=[{value:"Esp√®ces",label:"Esp√®ces"},{value:"Carte bancaire",label:"Carte bancaire"},{value:"Virement",label:"Virement"},{value:"Mobile Money",label:"Mobile Money"}],l=p({idReservation:0,idArticle:"",nomClient:"",telephoneClient:"",adresseClient:"",dateDebut:"",dateFin:"",dateReservation:"",prixUnitaire:0,quantite:"1",montantTotal:0,montantAvance:"0",commentaire:"",modePaiement:"",statut:"En attente"}),q=async()=>{x.value=!0;try{const t=R.societeId;let e;t?e=await m.getArticlesBySociete(t):e=await m.getArticles(),i.value=Array.isArray(e)?e:[],console.log("üìã Articles complets charg√©s:",i.value.length),console.log("üîç TOUS les articles:",i.value),v.value=i.value.map(o=>(console.log("üìù Formatage article:",o),{value:parseInt(o.idArticle,10),label:o.libelle||o.nom||`Article #${o.idArticle}`,prix:o.prix||o.prixVente||o.prixUnitaire||o.prixVentHT||0})),console.log("‚úÖ Articles format√©s pour dropdown:",v.value)}catch(t){console.error("‚ùå Erreur chargement articles:",t),v.value=[],i.value=[]}finally{x.value=!1}},w=async t=>{if(!t){console.warn("‚ö†Ô∏è Aucun article s√©lectionn√©");return}try{const e=parseInt(t,10);console.log("üí∞ === R√âCUP√âRATION PRIX ARTICLE #"+e+" ===");const o=i.value.find(c=>parseInt(c.idArticle,10)===e);if(console.log("üîç Article trouv√© dans articlesData:",o),o){console.log("üîç Structure compl√®te de l'article:",o);const c=[o.prix,o.prixVente,o.prixUnitaire,o.prixVentHT,o.tarif,o.montant,o.prixBase];console.log("üîç Prix possibles dans article:",{prix:o.prix,prixVente:o.prixVente,prixUnitaire:o.prixUnitaire,prixVentHT:o.prixVentHT,tarif:o.tarif,montant:o.montant,prixBase:o.prixBase});const r=c.find($=>$!=null&&parseFloat($)>0);if(r){l.value.prixUnitaire=parseFloat(r),console.log("‚úÖ Prix r√©cup√©r√© depuis article:",r,"FC"),g();return}}console.log("üîç Recherche prix dans V_StockArticleSite...");const D=R.societeId,y=D?await m.getStocksVueBySociete(D):await m.getStocksVue();if(console.log("üìã Stocks charg√©s (Vue):",(y==null?void 0:y.length)||0),Array.isArray(y)){console.log("üîç Liste de tous les idArticle dans stocks:",y.map(r=>r.idArticle));const c=y.find(r=>parseInt(r.idArticle,10)===e);if(console.log("üîç Stock trouv√© pour article #"+e+":",c),c){console.log("üì¶ Structure compl√®te du stock:",c);const r=c.prixVentHT||c.prixVente||c.prix||c.prixUnitaire;if(console.log("üîç Prix dans stock:",r),r&&parseFloat(r)>0){l.value.prixUnitaire=parseFloat(r),console.log("‚úÖ Prix r√©cup√©r√© depuis stock:",r,"FC"),g();return}}else console.error("‚ùå Aucun stock trouv√© pour l'article #"+e),console.log("üí° L'article existe mais n'a pas de stock dans cette soci√©t√©")}console.error("‚ùå AUCUN PRIX TROUV√â pour article #"+e),console.warn("üí° V√©rifiez que l'article a un prix d√©fini dans la base de donn√©es"),l.value.prixUnitaire=0,g()}catch(e){console.error("‚ùå Erreur r√©cup√©ration prix:",e),l.value.prixUnitaire=0,g()}},_=t=>{console.log("üîÑ Article chang√©:",t);const e=typeof t=="string"?parseInt(t,10):t;if(console.log("üîÑ ID Article converti:",e),e&&e>0){l.value.idArticle=e;const o=v.value.find(D=>D.value===e);console.log("üîç Option article trouv√©e:",o),o&&o.prix&&o.prix>0?(l.value.prixUnitaire=parseFloat(o.prix),console.log("‚úÖ Prix r√©cup√©r√© depuis dropdown:",o.prix,"FC"),g()):(console.log("‚ö†Ô∏è Pas de prix dans dropdown, recherche dans les donn√©es..."),w(e))}},g=()=>{const t=parseFloat(l.value.prixUnitaire)||0,e=parseFloat(l.value.quantite)||0;l.value.montantTotal=t*e,console.log(`üí∞ Calcul: ${t} FC √ó ${e} = ${l.value.montantTotal} FC`)},F=t=>(parseFloat(t)||0).toLocaleString("fr-CD",{minimumFractionDigits:2,maximumFractionDigits:2});B(()=>A.reservation,t=>{t?l.value={idReservation:t.idReservation||0,idArticle:t.idArticle?parseInt(t.idArticle,10):"",nomClient:t.nomClient||"",telephoneClient:t.telephoneClient||"",adresseClient:t.adresseClient||"",dateDebut:t.dateDebut?new Date(t.dateDebut).toISOString().slice(0,16):"",dateFin:t.dateFin?new Date(t.dateFin).toISOString().slice(0,16):"",dateReservation:t.dateReservation?new Date(t.dateReservation).toISOString().slice(0,16):"",prixUnitaire:t.prixUnitaire||0,quantite:String(t.quantite||1),montantTotal:t.montantTotal||0,montantAvance:String(t.montantAvance||0),commentaire:t.commentaire||"",modePaiement:t.modePaiement||"",statut:t.statut||"En attente"}:s()},{immediate:!1});const s=()=>{const t=new Date().toISOString().slice(0,16);l.value={idReservation:0,idArticle:"",nomClient:"",telephoneClient:"",adresseClient:"",dateDebut:t,dateFin:"",dateReservation:t,prixUnitaire:0,quantite:"1",montantTotal:0,montantAvance:"0",commentaire:"",modePaiement:"",statut:"En attente"}},n=()=>l.value.nomClient?l.value.telephoneClient?l.value.idArticle?l.value.dateDebut?l.value.dateFin?{valid:!0}:{valid:!1,message:"La date de fin est obligatoire"}:{valid:!1,message:"La date de d√©but est obligatoire"}:{valid:!1,message:"L'article est obligatoire"}:{valid:!1,message:"Le t√©l√©phone est obligatoire"}:{valid:!1,message:"Le nom du client est obligatoire"},d=async()=>{const t=n();if(!t.valid){alert(t.message);return}b.value=!0;try{C("save",l.value)}catch(e){console.error("Erreur lors de la sauvegarde:",e)}finally{b.value=!1}};return j(()=>{q()}),B(()=>l.value.idArticle,t=>{t&&w(t)}),B([()=>l.value.quantite,()=>l.value.prixUnitaire],()=>{g()}),k({resetForm:s,show:()=>{var t;return(t=f.value)==null?void 0:t.show()},hide:()=>{var t;return(t=f.value)==null?void 0:t.hide()},close:()=>{var t;return(t=f.value)==null?void 0:t.hide()}}),(t,e)=>(I(),te(Y,{"modal-id":M.modalId,title:`${V.value?"Modifier":"Nouvelle"} R√©servation`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":b.value,"loading-text":"Enregistrement...",onConfirm:d,ref_key:"modalRef",ref:f},{body:O(()=>[a("div",oe,[a("form",{onSubmit:ae(d,["prevent"])},[e[31]||(e[31]=a("h6",{class:"text-sm mt-0 mb-2"},"Client",-1)),a("div",le,[a("div",se,[e[12]||(e[12]=a("label",{class:"form-label"},"Nom *",-1)),u(h,{modelValue:l.value.nomClient,"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.nomClient=o),placeholder:"Nom du client","is-required":!0,id:"nomClient",name:"nomClient"},null,8,["modelValue"])]),a("div",ne,[e[13]||(e[13]=a("label",{class:"form-label"},"T√©l√©phone *",-1)),u(h,{modelValue:l.value.telephoneClient,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.telephoneClient=o),placeholder:"+243 123 456 789","is-required":!0,id:"telephoneClient",name:"telephoneClient"},null,8,["modelValue"])])]),a("div",ie,[a("div",re,[e[14]||(e[14]=a("label",{class:"form-label"},"Adresse",-1)),u(h,{modelValue:l.value.adresseClient,"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.adresseClient=o),placeholder:"Adresse du client",id:"adresseClient",name:"adresseClient"},null,8,["modelValue"])])]),e[32]||(e[32]=a("h6",{class:"text-sm mt-3 mb-2"},"D√©tails R√©servation",-1)),a("div",de,[a("div",ce,[e[15]||(e[15]=a("label",{class:"form-label"},"Article *",-1)),u(N,{modelValue:l.value.idArticle,"onUpdate:modelValue":[e[3]||(e[3]=o=>l.value.idArticle=o),_],options:v.value,placeholder:"S√©lectionner un article",disabled:x.value,id:"idArticle",name:"idArticle"},null,8,["modelValue","options","disabled"])]),a("div",ue,[e[16]||(e[16]=a("label",{class:"form-label"},"Quantit√© *",-1)),u(h,{modelValue:l.value.quantite,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.quantite=o),type:"number",step:"1",placeholder:"1","is-required":!0,id:"quantite",name:"quantite"},null,8,["modelValue"])])]),a("div",me,[a("div",pe,[e[17]||(e[17]=a("label",{class:"form-label"},"Date D√©but *",-1)),U(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.dateDebut=o),type:"datetime-local",class:"form-control",required:"",id:"dateDebut",name:"dateDebut"},null,512),[[E,l.value.dateDebut]])]),a("div",ve,[e[18]||(e[18]=a("label",{class:"form-label"},"Date Fin *",-1)),U(a("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>l.value.dateFin=o),type:"datetime-local",class:"form-control",required:"",id:"dateFin",name:"dateFin"},null,512),[[E,l.value.dateFin]])])]),e[33]||(e[33]=a("h6",{class:"text-sm mt-3 mb-2"},"üí∞ Montants (en Franc Congolais)",-1)),a("div",ge,[a("div",fe,[e[21]||(e[21]=a("label",{class:"form-label"},"Prix Unitaire (FC) *",-1)),l.value.prixUnitaire>0?(I(),H("div",be,[a("h5",xe,G(F(l.value.prixUnitaire))+" FC",1),e[19]||(e[19]=a("small",{class:"opacity-8"},"üîÑ R√©cup√©r√© automatiquement",-1))])):(I(),H("div",Ae,[...e[20]||(e[20]=[a("h6",{class:"mb-0 text-secondary"},[a("i",{class:"fas fa-arrow-up me-2"}),z(" S√©lectionnez un article ")],-1),a("small",{class:"text-xs"},"Le prix sera charg√© automatiquement",-1)])])),e[22]||(e[22]=a("small",{class:"text-muted d-block mt-2"},[a("i",{class:"fas fa-info-circle me-1"}),z(" Le prix est automatiquement charg√© depuis l'article s√©lectionn√© ")],-1))]),a("div",ye,[e[24]||(e[24]=a("label",{class:"form-label"},"Montant Total",-1)),a("div",Ce,[a("h5",he,G(F(l.value.montantTotal))+" FC",1),e[23]||(e[23]=a("small",{class:"opacity-8"},"Prix √ó Quantit√©",-1))])])]),a("div",Se,[a("div",Re,[e[25]||(e[25]=a("label",{class:"form-label"},"Montant Avanc√© (FC)",-1)),u(h,{modelValue:l.value.montantAvance,"onUpdate:modelValue":e[7]||(e[7]=o=>l.value.montantAvance=o),type:"number",step:"0.01",placeholder:"0.00",id:"montantAvance",name:"montantAvance"},null,8,["modelValue"]),e[26]||(e[26]=a("small",{class:"text-muted"},"Acompte vers√© par le client",-1))]),a("div",we,[e[27]||(e[27]=a("label",{class:"form-label"},"Mode Paiement",-1)),u(N,{modelValue:l.value.modePaiement,"onUpdate:modelValue":e[8]||(e[8]=o=>l.value.modePaiement=o),options:P,placeholder:"S√©lectionner",id:"modePaiement",name:"modePaiement"},null,8,["modelValue"])])]),a("div",Fe,[a("div",De,[e[28]||(e[28]=a("label",{class:"form-label"},"Statut",-1)),u(N,{modelValue:l.value.statut,"onUpdate:modelValue":e[9]||(e[9]=o=>l.value.statut=o),options:T,placeholder:"S√©lectionner",id:"statut",name:"statut"},null,8,["modelValue"])]),a("div",Ue,[e[29]||(e[29]=a("label",{class:"form-label"},"Date R√©servation",-1)),U(a("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>l.value.dateReservation=o),type:"datetime-local",class:"form-control",id:"dateReservation",name:"dateReservation"},null,512),[[E,l.value.dateReservation]])])]),a("div",Ee,[a("div",Ie,[e[30]||(e[30]=a("label",{class:"form-label"},"Commentaire",-1)),U(a("textarea",{"onUpdate:modelValue":e[11]||(e[11]=o=>l.value.commentaire=o),class:"form-control",rows:"3",placeholder:"Commentaire ou notes...",id:"commentaire",name:"commentaire"},null,512),[[E,l.value.commentaire]])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},ke=Q(Me,[["__scopeId","data-v-c1415d67"]]),Ve={class:"container-fluid py-4"},Te={class:"row"},Pe={class:"col-12"},qe={__name:"Reservations",setup(M){const{requireAuth:k}=W(),S=X(),{showConfirm:R,showSuccess:A,showError:C,showLoading:f,close:b}=J();k();const v=p(!1),i=p([]),x=p(null),V=p(null),T=[{key:"idReservation",label:"N¬∞",type:"index",align:"center"},{key:"nomClient",label:"Client",render:(s,n)=>`<div>
        <p class="mb-0 text-sm font-weight-bold">${s}</p>
        <p class="mb-0 text-xs text-secondary">${n.telephoneClient||"-"}</p>
      </div>`},{key:"articleNom",label:"Article",render:(s,n)=>s||`Article #${n.idArticle}`},{key:"periode",label:"P√©riode",render:(s,n)=>{const d=n.dateDebut?new Date(n.dateDebut).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):"",t=n.dateFin?new Date(n.dateFin).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}):"";return`${d} ‚Üí ${t}`}},{key:"montantTotal",label:"Montant",align:"end",render:s=>`<strong>${(parseFloat(s)||0).toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}</strong>`},{key:"montantAvance",label:"Avanc√©",align:"end",render:s=>{const n=parseFloat(s)||0;return n>0?n.toLocaleString("fr-CD",{style:"currency",currency:"CDF"}):"-"}},{key:"statut",label:"Statut",align:"center",render:s=>({"En attente":'<span class="badge badge-sm bg-gradient-warning">En attente</span>',Confirm√©e:'<span class="badge badge-sm bg-gradient-info">Confirm√©e</span>',"En cours":'<span class="badge badge-sm bg-gradient-primary">En cours</span>',Termin√©e:'<span class="badge badge-sm bg-gradient-success">Termin√©e</span>',Annul√©e:'<span class="badge badge-sm bg-gradient-danger">Annul√©e</span>'})[s]||`<span class="badge badge-sm bg-gradient-secondary">${s}</span>`}],P=[{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:s=>_(s)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:s=>F(s)}],l=async()=>{v.value=!0,console.log("üì° Chargement r√©servations...");try{const s=S.societeId;let n;s?n=await m.getReservationsBySociete(s):n=await m.getReservations(),Array.isArray(n)?i.value=n:n!=null&&n.data?i.value=n.data:i.value=[],console.log("‚úÖ R√©servations charg√©es:",i.value.length),await q()}catch(s){console.error("‚ùå Erreur chargement r√©servations:",s),await C("Erreur","Impossible de charger les r√©servations"),i.value=[]}finally{v.value=!1}},q=async()=>{try{const s=S.societeId,n=s?await m.getArticlesBySociete(s):await m.getArticles(),d={};(Array.isArray(n)?n:[]).forEach(t=>{d[t.idArticle]=t.libelle}),i.value=i.value.map(t=>({...t,articleNom:d[t.idArticle]||""}))}catch(s){console.warn("‚ö†Ô∏è Impossible de charger les articles:",s)}},w=()=>{x.value=null,new L(document.getElementById("reservationModal")).show()},_=s=>{x.value={...s},new L(document.getElementById("reservationModal")).show()},g=async s=>{var n,d;f("Enregistrement...");try{s.idReservation&&s.idReservation>0?(await m.updateReservation(s.idReservation,s),await A("Modifi√© !","R√©servation modifi√©e")):(await m.createReservation(s),await A("Cr√©√© !","R√©servation cr√©√©e"));const t=L.getInstance(document.getElementById("reservationModal"));t&&t.hide(),await l()}catch(t){b(),console.error("‚ùå Erreur:",t),await C("Erreur",((d=(n=t.response)==null?void 0:n.data)==null?void 0:d.message)||"Erreur de sauvegarde")}},F=async s=>{if((await R("Supprimer ?",`Supprimer la r√©servation de ${s.nomClient} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){f("Suppression...");try{await m.deleteReservation(s.idReservation),b(),await A("Supprim√© !"),await l()}catch{b(),await C("Erreur","Impossible de supprimer")}}};return j(()=>{l()}),(s,n)=>(I(),H("div",Ve,[a("div",Te,[a("div",Pe,[u(Z,{title:"Gestion des R√©servations",subtitle:"R√©servations de votre entreprise",data:i.value,columns:T,actions:P,"show-search":!0,"search-fields":["nomClient","telephoneClient","articleNom","statut"],loading:v.value,"items-per-page":10,"loading-text":"Chargement des r√©servations...","empty-text":"Aucune r√©servation trouv√©e"},{actions:O(()=>[u(K,{color:"success",size:"sm",onClick:w},{default:O(()=>[...n[0]||(n[0]=[a("i",{class:"fas fa-calendar-plus me-2"},null,-1),z(" Nouvelle R√©servation ",-1)])]),_:1})]),_:1},8,["data","loading"])])]),u(ke,{reservation:x.value,"modal-id":"reservationModal",onSave:g,ref_key:"reservationModalRef",ref:V},null,8,["reservation"])]))}},He=Q(qe,[["__scopeId","data-v-f67fec38"]]);export{He as default};
