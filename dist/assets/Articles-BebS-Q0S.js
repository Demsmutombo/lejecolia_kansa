import{a as m,c as U,w as T,f as F,o as M,g as y,h as o,I as L,p as d,C as _,q as P,l as G,u as q}from"./vendor-5ChSB122.js";import{M as x}from"./bootstrap-DXdCWnwj.js";import{_ as R,u as $,a as S,b as I,c as z,d as g,e as j,f as W}from"./index-C7KYosbF.js";import{G as D,D as H}from"./GenericModal-D2OVyllk.js";import"./charts-D32nV7-X.js";const J={class:"modal-body-scrollable"},K={class:"row"},X={class:"col-12 mb-3"},Y={class:"row"},Z={class:"col-md-6 mb-3"},ee={class:"col-md-6 mb-3"},te={class:"row"},le={class:"col-12 mb-3"},ae={class:"row"},se={class:"col-md-4 mb-3"},oe={class:"col-md-4 mb-3"},re={class:"col-md-4 mb-3"},ie={__name:"ArticleModal",props:{article:{type:Object,default:null},modalId:{type:String,default:"articleModal"}},emits:["save","close"],setup(k,{expose:C,emit:w}){const f=$(),u=k,v=w,n=m(null),c=m(!1),A=U(()=>u.article!==null),l=m({idArticle:0,libelle:"",tva:0,codeBarreQR:"",idSociete:0,perissable:!1,remise:0,withStock:!1,statut:!0});T(()=>u.article,a=>{a?l.value={idArticle:a.idArticle||0,libelle:a.libelle||"",tva:a.tva||0,codeBarreQR:a.codeBarreQR||"",idSociete:a.idSociete||f.societeId||0,perissable:a.perissable||!1,remise:a.remise||0,withStock:a.withStock||!1,statut:a.statut!==void 0?a.statut:!0}:p()},{immediate:!1});const p=()=>{l.value={idArticle:0,libelle:"",tva:0,codeBarreQR:"",idSociete:f.societeId||0,perissable:!1,remise:0,withStock:!1,statut:!0}},B=()=>l.value.libelle?{valid:!0}:{valid:!1,message:"Le libellÃ© est obligatoire"},h=async()=>{const a=B();if(!a.valid){alert(a.message);return}c.value=!0;try{l.value.idSociete||(l.value.idSociete=f.societeId),v("save",l.value)}catch(t){console.error("Erreur lors de la sauvegarde:",t)}finally{c.value=!1}};return C({resetForm:p,show:()=>{var a;return(a=n.value)==null?void 0:a.show()},hide:()=>{var a;return(a=n.value)==null?void 0:a.hide()},close:()=>{var a;return(a=n.value)==null?void 0:a.hide()}}),(a,t)=>(M(),F(D,{"modal-id":k.modalId,title:`${A.value?"Modifier":"Nouvel"} Article`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":c.value,"loading-text":"Enregistrement...",onConfirm:h,ref_key:"modalRef",ref:n},{body:y(()=>[o("div",J,[o("form",{onSubmit:L(h,["prevent"])},[o("div",K,[o("div",X,[t[7]||(t[7]=o("label",{class:"form-label"},"LibellÃ© *",-1)),d(S,{modelValue:l.value.libelle,"onUpdate:modelValue":t[0]||(t[0]=r=>l.value.libelle=r),placeholder:"Ex: CONCEPTION LOGO","is-required":!0,id:"libelle",name:"libelle"},null,8,["modelValue"])])]),o("div",Y,[o("div",Z,[t[8]||(t[8]=o("label",{class:"form-label"},"TVA (%)",-1)),d(S,{modelValue:l.value.tva,"onUpdate:modelValue":t[1]||(t[1]=r=>l.value.tva=r),type:"number",step:"0.01",placeholder:"0.00",id:"tva",name:"tva"},null,8,["modelValue"])]),o("div",ee,[t[9]||(t[9]=o("label",{class:"form-label"},"Remise (%)",-1)),d(S,{modelValue:l.value.remise,"onUpdate:modelValue":t[2]||(t[2]=r=>l.value.remise=r),type:"number",step:"0.01",placeholder:"0.00",id:"remise",name:"remise"},null,8,["modelValue"])])]),o("div",te,[o("div",le,[t[10]||(t[10]=o("label",{class:"form-label"},"Code Barre / QR",-1)),d(S,{modelValue:l.value.codeBarreQR,"onUpdate:modelValue":t[3]||(t[3]=r=>l.value.codeBarreQR=r),placeholder:"Code barre ou QR (optionnel)",id:"codeBarreQR",name:"codeBarreQR"},null,8,["modelValue"])])]),o("div",ae,[o("div",se,[d(I,{modelValue:l.value.perissable,"onUpdate:modelValue":t[4]||(t[4]=r=>l.value.perissable=r),id:"articlePerissable",name:"perissable"},{default:y(()=>[...t[11]||(t[11]=[_(" PÃ©rissable ",-1)])]),_:1},8,["modelValue"])]),o("div",oe,[d(I,{modelValue:l.value.withStock,"onUpdate:modelValue":t[5]||(t[5]=r=>l.value.withStock=r),id:"articleWithStock",name:"withStock"},{default:y(()=>[...t[12]||(t[12]=[_(" Avec Stock ",-1)])]),_:1},8,["modelValue"])]),o("div",re,[d(I,{modelValue:l.value.statut,"onUpdate:modelValue":t[6]||(t[6]=r=>l.value.statut=r),id:"articleStatut",name:"statut"},{default:y(()=>[...t[13]||(t[13]=[_(" Actif ",-1)])]),_:1},8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},de=R(ie,[["__scopeId","data-v-1b57be24"]]),ce={class:"container-fluid py-4"},ne={class:"row"},ue={class:"col-12"},me={__name:"Articles",setup(k){q();const{requireAuth:C}=z(),w=$(),{showConfirm:f,showSuccess:u,showError:v,showLoading:n,close:c}=j();C();const A=m(!1),l=m([]),p=m(null),B=m(null),h=[{key:"idArticle",label:"NÂ°",type:"index",align:"center"},{key:"libelle",label:"Article",render:e=>`<strong>${e}</strong>`},{key:"tva",label:"TVA",align:"center",render:e=>`${parseFloat(e||0).toFixed(2)}%`},{key:"remise",label:"Remise",align:"center",render:e=>`${parseFloat(e||0).toFixed(2)}%`},{key:"codeBarreQR",label:"Code Barre",render:e=>e||"-"},{key:"perissable",label:"PÃ©rissable",type:"badge",align:"center",badgeColor:e=>e?"warning":"secondary",render:e=>e?"Oui":"Non"},{key:"withStock",label:"Stock",type:"badge",align:"center",badgeColor:e=>e?"info":"secondary",render:e=>e?"Oui":"Non"},{key:"statut",label:"Statut",type:"badge",align:"center",badgeColor:e=>e?"success":"secondary",render:e=>e?"Actif":"Inactif"}],a=[{name:"toggle",label:e=>e.statut?"DÃ©sactiver":"Activer",icon:e=>e.statut?"fas fa-toggle-on":"fas fa-toggle-off",class:e=>e.statut?"text-success":"text-secondary",onClick:e=>N(e)},{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:e=>V(e)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:e=>O(e)}],t=async()=>{A.value=!0,console.log("ðŸ“¡ Chargement articles pour sociÃ©tÃ©:",w.societeId);try{const e=w.societeId;if(e){const s=await g.getArticlesBySociete(e);Array.isArray(s)?l.value=s:s!=null&&s.data?l.value=s.data:l.value=[],console.log("âœ… Articles chargÃ©s:",l.value.length)}else{console.warn("âš ï¸ Pas de societeId - Chargement de tous les articles");const s=await g.getArticles();l.value=Array.isArray(s)?s:[]}}catch(e){console.error("âŒ Erreur chargement articles:",e),await v("Erreur","Impossible de charger les articles"),l.value=[]}finally{A.value=!1}},r=()=>{p.value=null,new x(document.getElementById("articleModal")).show()},V=e=>{p.value={...e},new x(document.getElementById("articleModal")).show()},Q=async e=>{var s,i;n("Enregistrement...");try{e.idArticle&&e.idArticle>0?(await g.updateArticle(e.idArticle,e),await u("ModifiÃ© !",`${e.libelle} modifiÃ©`)):(await g.createArticle(e),await u("CrÃ©Ã© !",`${e.libelle} crÃ©Ã©`));const b=x.getInstance(document.getElementById("articleModal"));b&&b.hide(),await t()}catch(b){c(),console.error("âŒ Erreur:",b),await v("Erreur",((i=(s=b.response)==null?void 0:s.data)==null?void 0:i.message)||"Erreur de sauvegarde")}},N=async e=>{const s=!e.statut,i=s?"activer":"dÃ©sactiver";if((await f(`${i.charAt(0).toUpperCase()+i.slice(1)} ?`,`Voulez-vous ${i} "${e.libelle}" ?`,{confirmButtonText:`Oui, ${i}`,confirmButtonColor:s?"#2dce89":"#f5365c"})).isConfirmed){n(`${i.charAt(0).toUpperCase()+i.slice(1)}...`);try{const E={...e,statut:s};await g.updateArticle(e.idArticle,E),c(),await u("Statut modifiÃ© !"),await t()}catch{c(),await v("Erreur","Impossible de modifier le statut")}}},O=async e=>{if((await f("Supprimer ?",`Supprimer "${e.libelle}" ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){n("Suppression...");try{await g.deleteArticle(e.idArticle),c(),await u("SupprimÃ© !"),await t()}catch{c(),await v("Erreur","Impossible de supprimer")}}};return P(()=>{t()}),(e,s)=>(M(),G("div",ce,[o("div",ne,[o("div",ue,[d(H,{title:"Gestion des Articles",subtitle:"Articles et produits de votre sociÃ©tÃ©",data:l.value,columns:h,actions:a,"show-search":!0,"search-fields":["libelle","codeBarreQR"],loading:A.value,"items-per-page":10,"loading-text":"Chargement des articles...","empty-text":"Aucun article trouvÃ©"},{actions:y(()=>[d(W,{color:"success",size:"sm",onClick:r},{default:y(()=>[...s[0]||(s[0]=[o("i",{class:"fas fa-plus me-2"},null,-1),_(" Nouvel Article ",-1)])]),_:1})]),_:1},8,["data","loading"])])]),d(de,{article:p.value,"modal-id":"articleModal",onSave:Q,ref_key:"articleModalRef",ref:B},null,8,["article"])]))}},ye=R(me,[["__scopeId","data-v-8f8d6465"]]);export{ye as default};
