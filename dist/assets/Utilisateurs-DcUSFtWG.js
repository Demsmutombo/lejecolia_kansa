import{a as m,c as le,w as j,f as de,o as I,g as M,h as e,K as ce,p as d,B as ee,C as f,t as b,v as me,Q as pe,D as oe,E as ae,q as ve,l as T,u as he,m as G,F as fe,G as ge,n as _e}from"./vendor-Bjq3GXyS.js";import{M as Y}from"./bootstrap-DXdCWnwj.js";import{_ as ie,u as ne,p as te,f as re,a as _,b as be,d as C,c as xe,e as ye}from"./index-CwjmzDsC.js";import{G as $e,D as Ue}from"./GenericModal-DhdU3Gn5.js";import{A as Z}from"./ArgonSelect-Do4WPwre.js";import"./charts-D32nV7-X.js";const u=y=>(oe("data-v-d190f019"),y=y(),ae(),y),Se={class:"modal-body-scrollable"},Ce={class:"row mb-4"},we={class:"col-12"},Re={class:"upload-photo-section"},Ne=u(()=>e("label",{class:"form-label d-block text-center mb-3"},[e("i",{class:"fas fa-user-circle me-2"}),f("Photo ")],-1)),Ee={class:"text-center"},Ie={class:"mb-3"},Ae=["src"],ke=u(()=>e("i",{class:"fas fa-upload me-2"},null,-1)),Ve=u(()=>e("p",{class:"text-xs text-secondary mt-2 mb-0"},[f(" JPG, PNG, GIF (max. 2MB)"),e("br"),e("small",{class:"text-muted"},"RedimensionnÃ© 150x150 pour performance")],-1)),Te=u(()=>e("h6",{class:"text-sm mt-3 mb-2"},"IdentitÃ©",-1)),Me={class:"row"},Pe={class:"col-md-4 mb-3"},Le=u(()=>e("label",{class:"form-label"},"Nom *",-1)),qe={class:"col-md-4 mb-3"},Be=u(()=>e("label",{class:"form-label"},"Post-nom",-1)),De={class:"col-md-4 mb-3"},Ge=u(()=>e("label",{class:"form-label"},"PrÃ©nom *",-1)),ze={class:"row"},Fe={class:"col-md-6 mb-3"},Oe=u(()=>e("label",{class:"form-label"},"Sexe",-1)),je={class:"col-md-6 mb-3"},Ke=u(()=>e("label",{class:"form-label"},"Date de Naissance",-1)),Je=u(()=>e("h6",{class:"text-sm mt-3 mb-2"},"Contact",-1)),Qe={class:"row"},He={class:"col-md-6 mb-3"},We=u(()=>e("label",{class:"form-label"},"Email *",-1)),Xe={class:"col-md-6 mb-3"},Ye=u(()=>e("label",{class:"form-label"},"TÃ©lÃ©phone *",-1)),Ze=u(()=>e("h6",{class:"text-sm mt-3 mb-2"},"Connexion",-1)),et={class:"row"},tt={class:"col-md-6 mb-3"},st=u(()=>e("label",{class:"form-label"},"Login *",-1)),lt={class:"col-md-6 mb-3"},ot=u(()=>e("label",{class:"form-label"},"Mot de passe *",-1)),at={class:"row"},it={class:"col-md-6 mb-3"},nt=u(()=>e("label",{class:"form-label"},"Site *",-1)),rt={class:"col-md-6 mb-3"},ut=u(()=>e("label",{class:"form-label"},"RÃ´le *",-1)),dt=u(()=>e("h6",{class:"text-sm mt-3 mb-2"},"Adresse",-1)),ct={class:"row"},mt={class:"col-md-4 mb-3"},pt=u(()=>e("label",{class:"form-label"},"Province",-1)),vt={class:"col-md-4 mb-3"},ht=u(()=>e("label",{class:"form-label"},"Ville",-1)),ft={class:"col-md-4 mb-3"},gt=u(()=>e("label",{class:"form-label"},"Commune",-1)),_t={class:"row"},bt={class:"col-md-4 mb-3"},xt=u(()=>e("label",{class:"form-label"},"Quartier",-1)),yt={class:"col-md-4 mb-3"},$t=u(()=>e("label",{class:"form-label"},"Avenue",-1)),Ut={class:"col-md-4 mb-3"},St=u(()=>e("label",{class:"form-label"},"NumÃ©ro",-1)),Ct={class:"row"},wt={class:"col-12 mb-3"},Rt={__name:"UtilisateurModal",props:{utilisateur:{type:Object,default:null},modalId:{type:String,default:"utilisateurModal"}},emits:["save","close"],setup(y,{expose:K,emit:J}){const P=ne(),q=y,w=J,L=m(null),A=m(null),R=m(!1),N=m(""),p=m([]),v=m([]),c=m(!1),x=m(!1),E=le(()=>q.utilisateur!==null),B=[{value:"Masculin",label:"Masculin"},{value:"FÃ©minin",label:"FÃ©minin"},{value:"Autre",label:"Autre"}],o=m({idUtilisateur:0,nomUtilisateur:"",postNomUtilisateur:"",prenomUtilisateur:"",sexe:"",dateNaissance:"",numeroTelephone:"",email:"",login:"",motDePasse:"",photo:"",idSite:0,idRole:0,province:"",ville:"",commune:"",quartier:"",avenue:"",numero:"",statut:!0,isConnected:!1}),Q=async()=>{if(!P.societeId){p.value=[];return}c.value=!0;try{const a=await C.getSitesBySociete(P.societeId),s=Array.isArray(a)?a:[];p.value=s.map(i=>({value:parseInt(i.idSite,10),label:i.nomSite||i.nom||`Site #${i.idSite}`})),console.log(`âœ… ${p.value.length} site(s) chargÃ©s pour la sociÃ©tÃ© #${P.societeId}`),!o.value.idSite&&p.value.length&&(o.value.idSite=p.value[0].value)}catch(a){console.error("âŒ Erreur chargement sites:",a),p.value=[]}finally{c.value=!1}},D=async()=>{x.value=!0;try{const a=await C.getRoles(),s=["gestionnaire","caissier","gerant"],S=(Array.isArray(a)?a:[]).filter(h=>{const $=(h.nom||h.name||"").toLowerCase();return s.some(k=>$.includes(k))});if(v.value=S.map(h=>({value:parseInt(h.idRole,10),label:h.nom||h.name||`RÃ´le ${h.idRole}`})),console.log("âœ… RÃ´les filtrÃ©s (Gestionnaire/Caissier/Gerant):",v.value.length),console.log("ðŸ“‹ RÃ´les disponibles:",v.value),!o.value.idRole&&v.value.length>0){const h=v.value.find($=>$.label.toLowerCase().includes("gestionnaire"));h?(o.value.idRole=h.value,console.log("âœ… RÃ´le GESTIONNAIRE prÃ©-sÃ©lectionnÃ©:",h.label)):(o.value.idRole=v.value[0].value,console.log("âœ… Premier rÃ´le prÃ©-sÃ©lectionnÃ©:",v.value[0].label))}}catch(a){console.error("âŒ Erreur chargement rÃ´les:",a),v.value=[]}finally{x.value=!1}},z=a=>{const s=a.target.files[0];if(!s)return;const i=2*1024*1024;if(s.size>i){alert("Le fichier est trop volumineux. Taille maximum : 2 MB"),a.target.value="";return}const S=new FileReader;S.onload=h=>{const $=new Image;$.onload=()=>{const k=document.createElement("canvas"),W=k.getContext("2d"),V=150;let U=$.width,t=$.height;U>t?U>V&&(t=t*(V/U),U=V):t>V&&(U=U*(V/t),t=V),k.width=U,k.height=t,W.drawImage($,0,0,U,t);const l=k.toDataURL("image/jpeg",.5);N.value=l,o.value.photo=l,console.log("âœ… Photo compressÃ©e:",{original:`${(s.size/1024).toFixed(2)} KB`,compressed:`${(l.length/1024).toFixed(2)} KB`,dimensions:`${U}x${t}`})},$.src=h.target.result},S.readAsDataURL(s)};j(()=>q.utilisateur,a=>{a?(o.value={idUtilisateur:a.idUtilisateur||0,nomUtilisateur:a.nomUtilisateur||"",postNomUtilisateur:a.postNomUtilisateur||"",prenomUtilisateur:a.prenomUtilisateur||"",sexe:a.sexe||"",dateNaissance:a.dateNaissance?a.dateNaissance.split("T")[0]:"",numeroTelephone:a.numeroTelephone||"",email:a.email||"",login:a.login||"",motDePasse:"",photo:a.photo||"",idSite:a.idSite?parseInt(a.idSite,10):"",idRole:a.idRole?parseInt(a.idRole,10):"",province:a.province||"",ville:a.ville||"",commune:a.commune||"",quartier:a.quartier||"",avenue:a.avenue||"",numero:a.numero||"",statut:a.statut!==void 0?a.statut:!0,isConnected:a.isConnected||!1},N.value=a.photo||""):F()},{immediate:!1});const F=()=>{o.value={idUtilisateur:0,nomUtilisateur:"",postNomUtilisateur:"",prenomUtilisateur:"",sexe:"",dateNaissance:"",numeroTelephone:"",email:"",login:"",motDePasse:"",photo:"",idSite:p.value.length?p.value[0].value:0,idRole:v.value.length?v.value[0].value:0,province:"",ville:"",commune:"",quartier:"",avenue:"",numero:"",statut:!0,isConnected:!1},N.value=""},H=()=>o.value.nomUtilisateur?o.value.prenomUtilisateur?o.value.email?o.value.numeroTelephone?o.value.login?!E.value&&!o.value.motDePasse?{valid:!1,message:"Le mot de passe est obligatoire"}:!o.value.idSite||parseInt(o.value.idSite,10)===0?{valid:!1,message:"Le site est obligatoire"}:!o.value.idRole||parseInt(o.value.idRole,10)===0?{valid:!1,message:"Le rÃ´le est obligatoire"}:{valid:!0}:{valid:!1,message:"Le login est obligatoire"}:{valid:!1,message:"Le tÃ©lÃ©phone est obligatoire"}:{valid:!1,message:"L'email est obligatoire"}:{valid:!1,message:"Le prÃ©nom est obligatoire"}:{valid:!1,message:"Le nom est obligatoire"},O=async()=>{const a=H();if(!a.valid){alert(a.message);return}R.value=!0;try{const s={...o.value};E.value&&!s.motDePasse&&delete s.motDePasse,w("save",{...s,idSite:parseInt(s.idSite,10),idRole:parseInt(s.idRole,10)})}catch(s){console.error("Erreur lors de la sauvegarde:",s)}finally{R.value=!1}};return j(()=>P.societeId,()=>{Q()},{immediate:!0}),j(()=>P.role,()=>{D()},{immediate:!0}),K({resetForm:F,show:()=>{var a;return(a=L.value)==null?void 0:a.show()},hide:()=>{var a;return(a=L.value)==null?void 0:a.hide()},close:()=>{var a;return(a=L.value)==null?void 0:a.hide()}}),(a,s)=>(I(),de($e,{"modal-id":y.modalId,title:`${E.value?"Modifier":"Nouvel"} Utilisateur`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":R.value,"loading-text":"Enregistrement...",onConfirm:O,ref_key:"modalRef",ref:L},{body:M(()=>[e("div",Se,[e("form",{onSubmit:ce(O,["prevent"])},[e("div",Ce,[e("div",we,[e("div",Re,[Ne,e("div",Ee,[e("div",Ie,[e("img",{src:N.value||ee(te),alt:"Photo",class:"img-fluid rounded-circle photo-preview",style:{width:"80px",height:"80px","object-fit":"cover",border:"2px solid #e9ecef",cursor:"pointer"},onClick:s[0]||(s[0]=i=>A.value.click()),title:"Cliquez pour changer la photo"},null,8,Ae)]),e("input",{type:"file",ref_key:"photoInput",ref:A,onChange:z,accept:"image/*",class:"d-none"},null,544),d(re,{type:"button",color:"info",size:"sm",onClick:s[1]||(s[1]=i=>A.value.click())},{default:M(()=>[ke,f(" "+b(N.value?"Changer Photo":"Choisir Photo"),1)]),_:1}),Ve])])])]),Te,e("div",Me,[e("div",Pe,[Le,d(_,{modelValue:o.value.nomUtilisateur,"onUpdate:modelValue":s[2]||(s[2]=i=>o.value.nomUtilisateur=i),placeholder:"Ex: DUPONT","is-required":!0,id:"nom",name:"nom"},null,8,["modelValue"])]),e("div",qe,[Be,d(_,{modelValue:o.value.postNomUtilisateur,"onUpdate:modelValue":s[3]||(s[3]=i=>o.value.postNomUtilisateur=i),placeholder:"Ex: MARIE",id:"postnom",name:"postnom"},null,8,["modelValue"])]),e("div",De,[Ge,d(_,{modelValue:o.value.prenomUtilisateur,"onUpdate:modelValue":s[4]||(s[4]=i=>o.value.prenomUtilisateur=i),placeholder:"Ex: Jean","is-required":!0,id:"prenom",name:"prenom"},null,8,["modelValue"])])]),e("div",ze,[e("div",Fe,[Oe,d(Z,{modelValue:o.value.sexe,"onUpdate:modelValue":s[5]||(s[5]=i=>o.value.sexe=i),options:B,placeholder:"SÃ©lectionner",id:"sexe",name:"sexe"},null,8,["modelValue"])]),e("div",je,[Ke,me(e("input",{"onUpdate:modelValue":s[6]||(s[6]=i=>o.value.dateNaissance=i),type:"date",class:"form-control",id:"dateNaissance",name:"dateNaissance"},null,512),[[pe,o.value.dateNaissance]])])]),Je,e("div",Qe,[e("div",He,[We,d(_,{modelValue:o.value.email,"onUpdate:modelValue":s[7]||(s[7]=i=>o.value.email=i),type:"email",placeholder:"email@example.com","is-required":!0,id:"email",name:"email"},null,8,["modelValue"])]),e("div",Xe,[Ye,d(_,{modelValue:o.value.numeroTelephone,"onUpdate:modelValue":s[8]||(s[8]=i=>o.value.numeroTelephone=i),placeholder:"+243 123 456 789","is-required":!0,id:"telephone",name:"telephone"},null,8,["modelValue"])])]),Ze,e("div",et,[e("div",tt,[st,d(_,{modelValue:o.value.login,"onUpdate:modelValue":s[9]||(s[9]=i=>o.value.login=i),placeholder:"login","is-required":!0,id:"login",name:"login"},null,8,["modelValue"])]),e("div",lt,[ot,d(_,{modelValue:o.value.motDePasse,"onUpdate:modelValue":s[10]||(s[10]=i=>o.value.motDePasse=i),type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢","is-required":!E.value,id:"password",name:"password"},null,8,["modelValue","is-required"])])]),e("div",at,[e("div",it,[nt,d(Z,{modelValue:o.value.idSite,"onUpdate:modelValue":s[11]||(s[11]=i=>o.value.idSite=i),options:p.value,placeholder:"SÃ©lectionner un site",disabled:c.value,id:"idSite",name:"idSite","value-key":"value","label-key":"label"},null,8,["modelValue","options","disabled"])]),e("div",rt,[ut,d(Z,{modelValue:o.value.idRole,"onUpdate:modelValue":s[12]||(s[12]=i=>o.value.idRole=i),options:v.value,placeholder:"SÃ©lectionner un rÃ´le",disabled:x.value,id:"idRole",name:"idRole","value-key":"value","label-key":"label"},null,8,["modelValue","options","disabled"])])]),dt,e("div",ct,[e("div",mt,[pt,d(_,{modelValue:o.value.province,"onUpdate:modelValue":s[13]||(s[13]=i=>o.value.province=i),placeholder:"Ex: Kinshasa",id:"province",name:"province"},null,8,["modelValue"])]),e("div",vt,[ht,d(_,{modelValue:o.value.ville,"onUpdate:modelValue":s[14]||(s[14]=i=>o.value.ville=i),placeholder:"Ex: Kinshasa",id:"ville",name:"ville"},null,8,["modelValue"])]),e("div",ft,[gt,d(_,{modelValue:o.value.commune,"onUpdate:modelValue":s[15]||(s[15]=i=>o.value.commune=i),placeholder:"Ex: Gombe",id:"commune",name:"commune"},null,8,["modelValue"])])]),e("div",_t,[e("div",bt,[xt,d(_,{modelValue:o.value.quartier,"onUpdate:modelValue":s[16]||(s[16]=i=>o.value.quartier=i),placeholder:"Ex: Centre-ville",id:"quartier",name:"quartier"},null,8,["modelValue"])]),e("div",yt,[$t,d(_,{modelValue:o.value.avenue,"onUpdate:modelValue":s[17]||(s[17]=i=>o.value.avenue=i),placeholder:"Ex: Avenue de la Paix",id:"avenue",name:"avenue"},null,8,["modelValue"])]),e("div",Ut,[St,d(_,{modelValue:o.value.numero,"onUpdate:modelValue":s[18]||(s[18]=i=>o.value.numero=i),placeholder:"Ex: 123",id:"numero",name:"numero"},null,8,["modelValue"])])]),e("div",Ct,[e("div",wt,[d(be,{modelValue:o.value.statut,"onUpdate:modelValue":s[19]||(s[19]=i=>o.value.statut=i),id:"utilisateurStatut",name:"statut"},{default:M(()=>[f(" Utilisateur actif ")]),_:1},8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},Nt=ie(Rt,[["__scopeId","data-v-d190f019"]]),g=y=>(oe("data-v-2770b4c5"),y=y(),ae(),y),Et={class:"container-fluid py-4"},It={class:"row"},At={class:"col-12"},kt={key:0,class:"badge bg-gradient-info me-2"},Vt=g(()=>e("i",{class:"fas fa-building me-1"},null,-1)),Tt=g(()=>e("i",{class:"fas fa-user-plus me-2"},null,-1)),Mt={class:"d-flex align-items-center"},Pt=["src","alt"],Lt={class:"mb-0 text-sm"},qt={class:"text-xs text-secondary mb-0"},Bt=g(()=>e("i",{class:"fas fa-user me-1"},null,-1)),Dt=["href"],Gt=g(()=>e("i",{class:"fas fa-envelope me-1 text-secondary"},null,-1)),zt=["href"],Ft=g(()=>e("i",{class:"fas fa-phone me-1 text-secondary"},null,-1)),Ot={class:"row mt-4"},jt={class:"col-12"},Kt={class:"card"},Jt={class:"card-header pb-0 d-flex justify-content-between align-items-center"},Qt=g(()=>e("h6",{class:"mb-0"},"Sites de la sociÃ©tÃ©",-1)),Ht={class:"text-sm text-muted mb-0"},Wt={key:0,class:"spinner-border text-primary spinner-border-sm",role:"status"},Xt=g(()=>e("span",{class:"visually-hidden"},"Chargement...",-1)),Yt=[Xt],Zt={class:"card-body px-0 pt-0 pb-2"},es={class:"table-responsive p-0"},ts={class:"table align-items-center mb-0"},ss=g(()=>e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-4"},"Site"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Adresse"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Contact"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2"},"Statut")])],-1)),ls={key:0},os=g(()=>e("td",{colspan:"4",class:"text-center py-4 text-muted"}," Aucun site associÃ© nâ€™a Ã©tÃ© trouvÃ© pour votre sociÃ©tÃ©. ",-1)),as=[os],is={class:"ps-4"},ns={class:"mb-0 text-sm"},rs=g(()=>e("i",{class:"fas fa-store me-2 text-primary"},null,-1)),us={key:0,class:"text-xs text-muted mb-0"},ds=g(()=>e("i",{class:"fas fa-hashtag me-1"},null,-1)),cs={class:"mb-0 text-sm"},ms=g(()=>e("i",{class:"fas fa-map-marker-alt me-1 text-secondary"},null,-1)),ps={class:"mb-0 text-sm"},vs=g(()=>e("i",{class:"fas fa-phone-alt me-1 text-secondary"},null,-1)),hs={key:0,class:"text-xs text-muted mb-0"},fs=g(()=>e("i",{class:"fas fa-envelope me-1"},null,-1)),gs={__name:"Utilisateurs",setup(y){const K=he(),J=ne(),{requireAuth:P,isSuperAdmin:q,societeId:w}=xe(),{showConfirm:L,showSuccess:A,showError:R,showLoading:N,close:p}=ye();P();const v=m(!1),c=m([]);m([]);const x=m([]),E=m(!1),B=m(null),o=m(null),Q=le(()=>{const t=x.value.length;return t?`${t} site${t>1?"s":""} associÃ©${t>1?"s":""} Ã  votre sociÃ©tÃ©`:"Aucun site associÃ©"}),D=()=>{if(!c.value.length)return;const t={};x.value.forEach(l=>{const n=Number(l.idSite);t[n]={name:l.nomSite||`Site #${l.idSite}`,code:l.codeSite||l.code||""}}),c.value=c.value.map(l=>{const n=t[Number(l.idSite)]||null;return{...l,siteName:l.nomSite||(n==null?void 0:n.name)||`Site #${l.idSite}`,siteCode:l.codeSite||(n==null?void 0:n.code)||""}})},z=async()=>{if(!w.value){x.value=[],D();return}E.value=!0,console.log(`ðŸ¬ Chargement sites pour sociÃ©tÃ© #${w.value}`);try{const t=await C.getSitesBySociete(w.value);x.value=Array.isArray(t)?t:[],console.log(`âœ… ${x.value.length} site(s) associÃ©(s) chargÃ©(s)`),D()}catch(t){console.error("âŒ Erreur chargement sites:",t),x.value=[]}finally{E.value=!1}},F=(t={})=>{const l=[];return t.numero&&l.push(`NÂ° ${t.numero}`),t.avenue&&l.push(`Avenue ${t.avenue}`),t.quartier&&l.push(t.quartier),t.commune&&l.push(t.commune),t.ville&&l.push(t.ville),l.join(", ")||"Adresse non renseignÃ©e"},H=(t={})=>t.contact||t.telephone||t.numeroTelephone||"Non renseignÃ©",O=[{key:"idUtilisateur",label:"NÂ°",type:"index",align:"center"},{key:"nomComplet",label:"Gestionnaire",render:(t,l)=>`${l.nomUtilisateur} ${l.postNomUtilisateur||""} ${l.prenomUtilisateur}`.trim()},{key:"email",label:"Email"},{key:"numeroTelephone",label:"TÃ©lÃ©phone"},{key:"siteName",label:"Site",render:(t,l)=>l.siteName||`Site #${l.idSite}`},{key:"roleName",label:"RÃ´le",render:(t,l)=>`<span class="badge badge-sm bg-gradient-secondary">${l.roleName||`RÃ´le #${l.idRole}`}</span>`},{key:"isConnected",label:"Connexion",align:"center",render:t=>t?'<span class="badge badge-sm bg-gradient-success"><i class="fas fa-circle me-1"></i>En ligne</span>':'<span class="badge badge-sm bg-gradient-secondary">Hors ligne</span>'},{key:"statut",label:"Statut",type:"badge",align:"center",badgeColor:t=>t?"success":"secondary",render:t=>t?"Actif":"Inactif"}],a=[{name:"view",label:"Voir",icon:"fas fa-eye",class:"text-dark",onClick:t=>K.push(`/utilisateurs/${t.idUtilisateur}`)},{name:"toggle",label:t=>t.statut?"DÃ©sactiver":"Activer",icon:t=>t.statut?"fas fa-toggle-on":"fas fa-toggle-off",class:t=>t.statut?"text-success":"text-secondary",onClick:t=>V(t)},{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:t=>k(t)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:t=>U(t)}],s=t=>t.photo&&t.photo.length<5e4?t.photo:te,i=t=>{t.target.src=te},S=async()=>{var t;v.value=!0,console.log("âš¡ Chargement utilisateurs optimisÃ© (API V_Utilisateur)...");try{let l;!q.value&&w.value?(console.log(`âš¡ Chargement utilisateurs pour sociÃ©tÃ© #${w.value}`),l=await C.getUtilisateursVueBySociete(w.value)):(console.log("ðŸ‘‘ SuperAdmin : chargement de tous les utilisateurs"),l=await C.getUtilisateursVue());const n=Array.isArray(l)?l:[];console.log(`âœ… ${n.length} utilisateur(s) chargÃ©(s)`),c.value=n.map(r=>({...r,photo:r.photo&&r.photo.length>1e5?null:r.photo})),await h(),D()}catch(l){console.error("âŒ Erreur chargement:",l),((t=l.response)==null?void 0:t.status)===431?await R("Photos trop volumineuses","Les photos utilisateurs sont trop grandes. Utilisez des images plus petites (max 150x150)."):await R("Erreur","Impossible de charger les utilisateurs"),c.value=[]}finally{v.value=!1}},h=async()=>{try{const t=await C.getRoles(),l={};(Array.isArray(t)?t:[]).forEach(r=>{l[r.idRole]=r.nom||r.name});let n=c.value.map(r=>({...r,nomComplet:r.nomComplet||`${r.nomUtilisateur} ${r.postNomUtilisateur||""} ${r.prenomUtilisateur}`.trim(),siteName:r.nomSite||"",roleName:l[r.idRole]||r.role||""}));c.value=n,console.log("âœ… Utilisateurs chargÃ©s:",c.value.length),console.log("ðŸ“‹ RÃ´les prÃ©sents:",[...new Set(c.value.map(r=>r.roleName))])}catch(t){console.warn("âš ï¸ Erreur noms:",t)}},$=()=>{B.value=null,new Y(document.getElementById("utilisateurModal")).show()},k=t=>{B.value={...t},new Y(document.getElementById("utilisateurModal")).show()},W=async t=>{var l,n;N("Enregistrement...");try{const r=`${t.prenomUtilisateur||""} ${t.nomUtilisateur||""}`.trim()||"l'utilisateur";t.idUtilisateur&&t.idUtilisateur>0?(await C.updateUser(t.idUtilisateur,t),await A("Gestionnaire modifiÃ© !",`${r} a Ã©tÃ© modifiÃ© avec succÃ¨s`)):(await C.createUser(t),await A("Gestionnaire crÃ©Ã© !",`${r} a Ã©tÃ© crÃ©Ã© avec succÃ¨s`));const X=Y.getInstance(document.getElementById("utilisateurModal"));X&&X.hide(),await S()}catch(r){p(),console.error("âŒ Erreur:",r),await R("Erreur",((n=(l=r.response)==null?void 0:l.data)==null?void 0:n.message)||"Erreur de sauvegarde")}},V=async t=>{const l=!t.statut,n=l?"activer":"dÃ©sactiver",r=t.nomComplet||`${t.nomUtilisateur||""} ${t.postNomUtilisateur||""} ${t.prenomUtilisateur||""}`.trim()||"cet utilisateur";if((await L(`${n.charAt(0).toUpperCase()+n.slice(1)} ?`,`Voulez-vous ${n} ${r} ?`,{confirmButtonText:`Oui, ${n}`,confirmButtonColor:l?"#2dce89":"#f5365c"})).isConfirmed){N(`${n.charAt(0).toUpperCase()+n.slice(1)}...`);try{console.log(`ðŸ”„ Toggle statut utilisateur #${t.idUtilisateur} vers ${l}`),await C.toggleUserStatus(t.idUtilisateur,l),p(),await A("Statut modifiÃ© !",`${r} a Ã©tÃ© ${l?"activÃ©":"dÃ©sactivÃ©"} avec succÃ¨s`),await new Promise(ue=>setTimeout(ue,500)),await S()}catch(se){p(),console.error("âŒ Erreur changement statut:",se),await R("Erreur","Impossible de modifier le statut")}}},U=async t=>{const l=t.nomComplet||`${t.nomUtilisateur||""} ${t.postNomUtilisateur||""} ${t.prenomUtilisateur||""}`.trim()||"cet utilisateur";if((await L("Supprimer le gestionnaire ?",`Voulez-vous vraiment supprimer ${l} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){N("Suppression...");try{await C.deleteUser(t.idUtilisateur),p(),await A("Gestionnaire supprimÃ© !",`${l} a Ã©tÃ© supprimÃ© avec succÃ¨s`),await S()}catch{p(),await R("Erreur","Impossible de supprimer")}}};return ve(()=>{S(),z()}),j(w,(t,l)=>{t&&t!==l&&(S(),z())}),(t,l)=>(I(),T("div",Et,[e("div",It,[e("div",At,[d(Ue,{title:"Gestion des Utilisateurs",subtitle:`${c.value.length} utilisateur${c.value.length>1?"s":""} de votre sociÃ©tÃ©`,data:c.value,columns:O,actions:a,"show-search":!0,"search-fields":["nomUtilisateur","prenomUtilisateur","email","login"],loading:v.value,"items-per-page":10,"loading-text":"Chargement des utilisateurs...","empty-text":"Aucun utilisateur trouvÃ©"},{actions:M(()=>[ee(q)?G("",!0):(I(),T("span",kt,[Vt,f(" SociÃ©tÃ©: "+b(ee(J).societeName),1)])),d(re,{color:"success",size:"sm",onClick:$},{default:M(()=>[Tt,f(" Nouvel Utilisateur ")]),_:1})]),"cell-nomComplet":M(({value:n,row:r})=>[e("div",Mt,[e("img",{src:s(r),alt:n,class:"rounded-circle me-3",style:{width:"40px",height:"40px","object-fit":"cover",border:"1px solid #e9ecef"},onError:i},null,40,Pt),e("div",null,[e("h6",Lt,b(n),1),e("p",qt,[Bt,f(b(r.login),1)])])])]),"cell-email":M(({value:n})=>[e("a",{href:`mailto:${n}`,class:"text-dark text-decoration-none"},[Gt,f(" "+b(n),1)],8,Dt)]),"cell-numeroTelephone":M(({value:n})=>[e("a",{href:`tel:${n}`,class:"text-dark text-decoration-none"},[Ft,f(" "+b(n),1)],8,zt)]),_:1},8,["subtitle","data","loading"])])]),d(Nt,{utilisateur:B.value,"modal-id":"utilisateurModal",onSave:W,ref_key:"utilisateurModalRef",ref:o},null,8,["utilisateur"]),e("div",Ot,[e("div",jt,[e("div",Kt,[e("div",Jt,[e("div",null,[Qt,e("p",Ht,b(Q.value),1)]),E.value?(I(),T("div",Wt,Yt)):G("",!0)]),e("div",Zt,[e("div",es,[e("table",ts,[ss,e("tbody",null,[!E.value&&!x.value.length?(I(),T("tr",ls,as)):G("",!0),(I(!0),T(fe,null,ge(x.value,n=>(I(),T("tr",{key:n.idSite},[e("td",is,[e("h6",ns,[rs,f(" "+b(n.nomSite||`Site #${n.idSite}`),1)]),n.siteCode?(I(),T("p",us,[ds,f(b(n.siteCode),1)])):G("",!0)]),e("td",null,[e("p",cs,[ms,f(" "+b(F(n)),1)])]),e("td",null,[e("p",ps,[vs,f(" "+b(H(n)),1)]),n.email?(I(),T("p",hs,[fs,f(b(n.email),1)])):G("",!0)]),e("td",null,[e("span",{class:_e(["badge badge-sm",n.statut?"bg-gradient-success":"bg-gradient-secondary"])},b(n.statut?"Actif":"Inactif"),3)])]))),128))])])])])])])])]))}},Ss=ie(gs,[["__scopeId","data-v-2770b4c5"]]);export{Ss as default};
