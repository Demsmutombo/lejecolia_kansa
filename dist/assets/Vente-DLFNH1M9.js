import{a as S,w as Re,c as be,l as m,m as V,o as u,h as e,t as n,B as O,C as y,F as Y,G as Ie,D as Pe,E as Fe,q as Me,A as Le,p as w,f as Ee,g as G,u as je,v as pe,Q as xe}from"./vendor-Bjq3GXyS.js";import{_ as Ue,u as De,d as U,c as Be,f as Q,a as B,e as He}from"./index-CwjmzDsC.js";import{A as J}from"./ArgonSelect-Do4WPwre.js";import"./bootstrap-DXdCWnwj.js";import"./charts-D32nV7-X.js";const c=p=>(Pe("data-v-b0e9f1ab"),p=p(),Fe(),p),ze={key:0,class:"modal fade show d-block",tabindex:"-1",style:{"background-color":"rgba(0,0,0,0.5)"}},Oe={class:"modal-dialog modal-dialog-centered",style:{"max-width":"700px"}},Ge={class:"modal-content"},Qe={class:"modal-header bg-gradient-primary"},Je=c(()=>e("h5",{class:"modal-title text-white"},[e("i",{class:"fas fa-file-invoice me-2"}),y(" Facture ")],-1)),Ye={class:"modal-body p-3",id:"facture-content"},Ke={class:"row mb-3"},We={class:"col-7"},Xe=c(()=>e("h4",{class:"text-primary mb-2"},"FACTURE",-1)),Ze={class:"mb-1"},et={class:"mb-1 text-sm"},tt=c(()=>e("i",{class:"fas fa-store me-2 text-primary"},null,-1)),st={key:0,class:"mb-1 text-sm text-muted"},ot=c(()=>e("i",{class:"fas fa-phone me-2"},null,-1)),lt={key:1,class:"mb-0 text-sm text-muted"},at=c(()=>e("i",{class:"fas fa-envelope me-2"},null,-1)),nt={key:2,class:"mb-0 text-xs text-muted mt-2"},it=c(()=>e("i",{class:"fas fa-map-marker-alt me-2"},null,-1)),ct={class:"col-5 text-end"},dt=["src"],rt={key:1,class:"bg-light rounded p-2 mb-1",style:{height:"60px",display:"flex","align-items":"center","justify-content":"center"}},ut=c(()=>e("i",{class:"fas fa-building fa-lg text-muted"},null,-1)),mt=[ut],vt={class:"mb-0 text-xs"},ht=c(()=>e("strong",null,"Date :",-1)),_t={class:"mb-0 text-xs"},pt=c(()=>e("strong",null,"NÂ° :",-1)),xt=c(()=>e("hr",{class:"horizontal dark my-2"},null,-1)),bt={class:"row mb-2"},ft={class:"col-6"},gt=c(()=>e("h6",{class:"text-uppercase text-xxs mb-1 text-muted"},"Identifiants Fiscaux",-1)),yt={class:"text-xxs"},$t={key:0,class:"mb-1"},St=c(()=>e("strong",null,"NUMÃ‰RO D'IMPÃ”T",-1)),wt=c(()=>e("br",null,null,-1)),Vt={class:"text-muted"},Ct={key:1,class:"mb-1"},At=c(()=>e("strong",null,"RCCM",-1)),kt=c(()=>e("br",null,null,-1)),Tt={class:"text-muted"},Nt={key:2,class:"mb-0"},Et=c(()=>e("strong",null,"ID NATIONAL",-1)),It=c(()=>e("br",null,null,-1)),Pt={class:"text-muted"},Ft={key:3,class:"mb-0 mt-2"},Ut=c(()=>e("span",{class:"text-muted fst-italic"},"Non renseignÃ©s",-1)),Dt=[Ut],qt={class:"col-6"},Rt=c(()=>e("h6",{class:"text-uppercase text-xxs mb-1 text-muted"},"Adresse",-1)),Mt={class:"text-xxs"},Lt={class:"mb-0"},jt=c(()=>e("strong",null,"ADRESSE COMPLÃˆTE",-1)),Bt=c(()=>e("br",null,null,-1)),Ht={class:"text-muted"},zt=c(()=>e("hr",{class:"horizontal dark my-2"},null,-1)),Ot={class:"row mb-2"},Gt={class:"col-12"},Qt=c(()=>e("h6",{class:"text-uppercase text-xxs mb-1 text-muted"},"FacturÃ© Ã  :",-1)),Jt={class:"mb-0 text-sm"},Yt={key:0,class:"mb-0 text-xs text-muted"},Kt={key:0},Wt={key:1,class:"ms-2"},Xt={class:"table-responsive"},Zt={class:"table table-bordered table-sm"},es=c(()=>e("thead",{class:"bg-light"},[e("tr",null,[e("th",{class:"text-uppercase text-xxs font-weight-bolder"},"Article"),e("th",{class:"text-uppercase text-xxs font-weight-bolder text-center"},"QtÃ©"),e("th",{class:"text-uppercase text-xxs font-weight-bolder text-end"},"P.U."),e("th",{class:"text-uppercase text-xxs font-weight-bolder text-end"},"TVA"),e("th",{class:"text-uppercase text-xxs font-weight-bolder text-end"},"Rem."),e("th",{class:"text-uppercase text-xxs font-weight-bolder text-end"},"Total")])],-1)),ts={class:"text-xs"},ss={class:"text-xs text-center"},os={class:"text-xs text-end"},ls={class:"text-xs text-end"},as={class:"text-xs text-end"},ns={class:"text-xs text-end font-weight-bold"},is={class:"row mt-3"},cs={class:"col-md-6 offset-md-6"},ds={class:"card bg-gradient-light"},rs={class:"card-body p-2"},us={class:"d-flex justify-content-between mb-1"},ms=c(()=>e("span",{class:"text-xs"},"Sous-total HT :",-1)),vs={class:"text-xs font-weight-bold"},hs={class:"d-flex justify-content-between mb-1"},_s=c(()=>e("span",{class:"text-xs"},"Remises :",-1)),ps={class:"text-xs font-weight-bold text-danger"},xs={class:"d-flex justify-content-between mb-1"},bs=c(()=>e("span",{class:"text-xs"},"TVA :",-1)),fs={class:"text-xs font-weight-bold"},gs=c(()=>e("hr",{class:"horizontal dark my-1"},null,-1)),ys={class:"d-flex justify-content-between"},$s=c(()=>e("span",{class:"text-sm font-weight-bold"},"TOTAL TTC :",-1)),Ss={class:"text-sm font-weight-bold text-primary"},ws={class:"row mt-3"},Vs={class:"col-12"},Cs={class:"card bg-light"},As={class:"card-body p-2"},ks={class:"row"},Ts={class:"col-6"},Ns=c(()=>e("p",{class:"text-xs mb-0"},[e("i",{class:"fas fa-credit-card me-2 text-info"}),e("strong",null,"Mode de paiement :")],-1)),Es={class:"text-sm mb-0 ms-4"},Is={class:"badge bg-gradient-info"},Ps={class:"col-6"},Fs=c(()=>e("p",{class:"text-xs mb-0"},[e("i",{class:"fas fa-user-tie me-2 text-primary"}),e("strong",null,"Vendeur :")],-1)),Us={class:"text-sm mb-0 ms-4 font-weight-bold"},Ds={class:"row mt-3"},qs={class:"col-12 text-center"},Rs=c(()=>e("hr",{class:"horizontal dark my-2"},null,-1)),Ms={class:"text-xs mb-1"},Ls={key:0,class:"text-xxs text-muted mb-0"},js={key:0,class:"ms-2"},Bs=c(()=>e("p",{class:"text-xxs text-muted mt-2 mb-0"},[e("em",null,"Facture gÃ©nÃ©rÃ©e via Lejecolia")],-1)),Hs={class:"modal-footer no-print"},zs=c(()=>e("i",{class:"fas fa-times me-2"},null,-1)),Os=c(()=>e("i",{class:"fas fa-print me-2"},null,-1)),Gs=c(()=>e("i",{class:"fas fa-file-pdf me-2"},null,-1)),Qs={__name:"FactureModal",props:{show:Boolean,vente:Object,client:Object},emits:["close"],setup(p,{emit:_e}){const L=p,T=_e,C=De(),i=S(null),r=S(null),K=async()=>{var h,x,f;try{if(!C.societeId){console.log("âš ï¸ Pas de societeId dans userStore");return}console.log("ðŸ”„ Chargement infos sociÃ©tÃ©/site pour facture..."),console.log("ðŸ¢ SocieteId:",C.societeId),console.log("ðŸ“ SiteId:",C.siteId),i.value=await U.getSocieteById(C.societeId||3),console.log("âœ… SociÃ©tÃ© trouvÃ©e:",((h=i.value)==null?void 0:h.nomSociete)||"Non trouvÃ©e");const b=await U.getSitesBySociete(C.societeId||3),g=Array.isArray(b)?b:(b==null?void 0:b.data)||[];C.siteId?(r.value=g.find(A=>String(A.idSite)===String(C.siteId)),console.log("âœ… Site utilisateur:",((x=r.value)==null?void 0:x.nomSite)||"Non trouvÃ©")):(r.value=g[0]||null,console.log("âœ… Premier site de la sociÃ©tÃ©:",((f=r.value)==null?void 0:f.nomSite)||"Aucun site trouvÃ©"))}catch(b){console.error("âŒ Erreur chargement infos sociÃ©tÃ©:",b)}};Re(()=>L.show,h=>{h&&K()});const W=h=>h?new Date(h).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric"}):new Date().toLocaleDateString("fr-FR"),N=h=>new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF",minimumFractionDigits:0}).format(h||0),H=h=>{const x=h.prixUnitaire*h.quantite,f=x*(h.remise||0)/100,b=x-f,g=b*(h.tva||0)/100;return b+g},D=be(()=>{var g;if(!((g=L.vente)!=null&&g.lignesCommandes))return{sousTotal:0,totalTVA:0,totalRemises:0,total:0};let h=0,x=0,f=0;L.vente.lignesCommandes.forEach(A=>{const P=A.prixUnitaire*A.quantite,E=P*(A.remise||0)/100,l=(P-E)*(A.tva||0)/100;h+=P,f+=E,x+=l});const b=h-f+x;return{sousTotal:h,totalTVA:x,totalRemises:f,total:b}}),j=()=>{var b;const h=document.getElementById("facture-content"),x=document.body.innerHTML,f=h.innerHTML;document.body.innerHTML=`
    <html>
      <head>
        <title>Facture ${((b=L.vente)==null?void 0:b.idVente)||"N/A"}</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          .table { width: 100%; border-collapse: collapse; margin: 20px 0; }
          .table th, .table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          .table th { background-color: #f8f9fa; }
          .text-end { text-align: right; }
          .text-center { text-align: center; }
          .text-primary { color: #1565c0; }
          .text-muted { color: #6c757d; }
          .font-weight-bold { font-weight: bold; }
          hr { border: 1px solid #ddd; margin: 15px 0; }
        </style>
      </head>
      <body>${f}</body>
    </html>
  `,window.print(),document.body.innerHTML=x,window.location.reload()},q=()=>{j()};return(h,x)=>{var f,b,g,A,P,E,z,l,$,M,I,X,Z,ee,te,se,oe,le,ae,ne,ie,k,ce,de,re,ue,me,o,t,s,a,v,_,F,ve,he,fe,ge,ye,$e,Se,we,Ve,Ce,Ae,ke,Te,Ne;return p.show?(u(),m("div",ze,[e("div",Oe,[e("div",Ge,[e("div",Qe,[Je,e("button",{type:"button",class:"btn-close btn-close-white",onClick:x[0]||(x[0]=R=>T("close"))})]),e("div",Ye,[e("div",Ke,[e("div",We,[Xe,e("p",Ze,[e("strong",null,n(((f=i.value)==null?void 0:f.nomSociete)||O(C).societeName),1)]),e("p",et,[tt,e("strong",null,n(((b=r.value)==null?void 0:b.nomSite)||O(C).siteName),1)]),(g=r.value)!=null&&g.telephone||(A=i.value)!=null&&A.telephone?(u(),m("p",st,[ot,y(n(((P=r.value)==null?void 0:P.telephone)||((E=i.value)==null?void 0:E.telephone)),1)])):V("",!0),(z=r.value)!=null&&z.email||(l=i.value)!=null&&l.email?(u(),m("p",lt,[at,y(n((($=r.value)==null?void 0:$.email)||((M=i.value)==null?void 0:M.email)),1)])):V("",!0),(I=r.value)!=null&&I.ville||(X=r.value)!=null&&X.commune?(u(),m("p",nt,[it,y(" "+n([(Z=r.value)==null?void 0:Z.avenue,(ee=r.value)==null?void 0:ee.quartier,(te=r.value)==null?void 0:te.commune,(se=r.value)==null?void 0:se.ville,(oe=r.value)==null?void 0:oe.province].filter(Boolean).join(", ")),1)])):V("",!0)]),e("div",ct,[(le=i.value)!=null&&le.logo?(u(),m("img",{key:0,src:i.value.logo,alt:"Logo sociÃ©tÃ©",style:{"max-height":"60px","max-width":"100%","object-fit":"contain","margin-bottom":"0.5rem"}},null,8,dt)):(u(),m("div",rt,mt)),e("p",vt,[ht,y(" "+n(W((ae=p.vente)==null?void 0:ae.dateCreation)),1)]),e("p",_t,[pt,y(" "+n(((ne=p.vente)==null?void 0:ne.idVente)||"N/A"),1)])])]),xt,e("div",bt,[e("div",ft,[gt,e("div",yt,[(ie=i.value)!=null&&ie.numeroImpot?(u(),m("p",$t,[St,wt,e("span",Vt,n(i.value.numeroImpot),1)])):V("",!0),(k=i.value)!=null&&k.rccm?(u(),m("p",Ct,[At,kt,e("span",Tt,n(i.value.rccm),1)])):V("",!0),(ce=i.value)!=null&&ce.idNational?(u(),m("p",Nt,[Et,It,e("span",Pt,n(i.value.idNational),1)])):V("",!0),!((de=i.value)!=null&&de.numeroImpot)&&!((re=i.value)!=null&&re.rccm)&&!((ue=i.value)!=null&&ue.idNational)?(u(),m("p",Ft,Dt)):V("",!0)])]),e("div",qt,[Rt,e("div",Mt,[e("p",Lt,[jt,Bt,e("span",Ht,[r.value?(u(),m(Y,{key:0},[y(n([r.value.numero?`NÂ° ${r.value.numero}`:"",r.value.avenue?`Avenue ${r.value.avenue}`:"",r.value.quartier,r.value.commune,r.value.ville,r.value.province].filter(Boolean).join(", ")||[(me=i.value)==null?void 0:me.avenue,(o=i.value)==null?void 0:o.quartier,(t=i.value)==null?void 0:t.commune,(s=i.value)==null?void 0:s.ville,(a=i.value)==null?void 0:a.province].filter(Boolean).join(", ")||"Non renseignÃ©e"),1)],64)):i.value?(u(),m(Y,{key:1},[y(n([i.value.avenue,i.value.quartier,i.value.commune,i.value.ville,i.value.province].filter(Boolean).join(", ")||"Non renseignÃ©e"),1)],64)):(u(),m(Y,{key:2},[y(" Non renseignÃ©e ")],64))])])])])]),zt,e("div",Ot,[e("div",Gt,[Qt,e("p",Jt,[e("strong",null,n((v=p.client)==null?void 0:v.nom)+" "+n((_=p.client)==null?void 0:_.prenom),1)]),(F=p.client)!=null&&F.telephone||(ve=p.client)!=null&&ve.email?(u(),m("p",Yt,[(he=p.client)!=null&&he.telephone?(u(),m("span",Kt,"ðŸ“ž "+n(p.client.telephone),1)):V("",!0),(fe=p.client)!=null&&fe.email?(u(),m("span",Wt,"ðŸ“§ "+n(p.client.email),1)):V("",!0)])):V("",!0)])]),e("div",Xt,[e("table",Zt,[es,e("tbody",null,[(u(!0),m(Y,null,Ie((ge=p.vente)==null?void 0:ge.lignesCommandes,(R,qe)=>(u(),m("tr",{key:qe},[e("td",ts,n(R.articleNom),1),e("td",ss,n(R.quantite),1),e("td",os,n(N(R.prixUnitaire)),1),e("td",ls,n(R.tva||0)+"%",1),e("td",as,n(R.remise||0)+"%",1),e("td",ns,n(N(H(R))),1)]))),128))])])]),e("div",is,[e("div",cs,[e("div",ds,[e("div",rs,[e("div",us,[ms,e("span",vs,n(N(D.value.sousTotal)),1)]),e("div",hs,[_s,e("span",ps,"- "+n(N(D.value.totalRemises)),1)]),e("div",xs,[bs,e("span",fs,n(N(D.value.totalTVA)),1)]),gs,e("div",ys,[$s,e("span",Ss,n(N(D.value.total)),1)])])])])]),e("div",ws,[e("div",Vs,[e("div",Cs,[e("div",As,[e("div",ks,[e("div",Ts,[Ns,e("p",Es,[e("span",Is,n(((ye=p.vente)==null?void 0:ye.modePaiement)||"N/A"),1)])]),e("div",Ps,[Fs,e("p",Us,n(O(C).userName||O(C).nomUtilisateur||"N/A"),1)])])])])])]),e("div",Ds,[e("div",qs,[Rs,e("p",Ms,[e("strong",null,n((($e=i.value)==null?void 0:$e.nomSociete)||O(C).societeName),1)]),(Se=i.value)!=null&&Se.telephone||(we=r.value)!=null&&we.telephone?(u(),m("p",Ls,[y(" ðŸ“ž "+n(((Ve=i.value)==null?void 0:Ve.telephone)||((Ce=r.value)==null?void 0:Ce.telephone))+" ",1),(Ae=i.value)!=null&&Ae.email||(ke=r.value)!=null&&ke.email?(u(),m("span",js," ðŸ“§ "+n(((Te=i.value)==null?void 0:Te.email)||((Ne=r.value)==null?void 0:Ne.email)),1)):V("",!0)])):V("",!0),Bs])])]),e("div",Hs,[e("button",{type:"button",class:"btn btn-secondary",onClick:x[1]||(x[1]=R=>T("close"))},[zs,y(" Fermer ")]),e("button",{type:"button",class:"btn btn-info",onClick:j},[Os,y(" Imprimer ")]),e("button",{type:"button",class:"btn btn-primary",onClick:q},[Gs,y(" TÃ©lÃ©charger PDF ")])])])])])):V("",!0)}}},Js=Ue(Qs,[["__scopeId","data-v-b0e9f1ab"]]),d=p=>(Pe("data-v-a258122f"),p=p(),Fe(),p),Ys={class:"container-fluid px-4 py-3"},Ks=Le('<div class="row" data-v-a258122f><div class="col-12 mb-3" data-v-a258122f><h4 class="mb-0" data-v-a258122f><i class="fas fa-cash-register me-2 text-success" data-v-a258122f></i> Point de Vente</h4><p class="text-sm text-white mb-0" data-v-a258122f>Enregistrer une nouvelle vente</p></div></div>',1),Ws={class:"row mb-4"},Xs={class:"col-xl-3 col-sm-6 mb-xl-0 mb-4"},Zs={class:"card bg-gradient-success shadow-sm"},eo={class:"card-body p-3 text-white"},to={class:"d-flex align-items-center"},so=d(()=>e("div",{class:"icon icon-shape bg-white text-success shadow text-center border-radius-md me-3"},[e("i",{class:"ni ni-cart text-lg"})],-1)),oo=d(()=>e("p",{class:"text-sm mb-1 text-uppercase"},"VENTES DU JOUR",-1)),lo={class:"font-weight-bolder mb-0"},ao={key:0},no=d(()=>e("i",{class:"fas fa-spinner fa-spin me-2"},null,-1)),io={key:1},co={class:"text-xs mb-0"},ro=d(()=>e("span",{class:"font-weight-bold"},"Ventes",-1)),uo={key:0,class:"ms-2"},mo={class:"row"},vo={class:"col-lg-8"},ho={class:"card mb-4"},_o={class:"card-header pb-0"},po={class:"d-flex align-items-center"},xo=d(()=>e("h6",{class:"mb-0"},"ðŸ‘¤ Client",-1)),bo=d(()=>e("i",{class:"fas fa-user-plus me-1"},null,-1)),fo=d(()=>e("i",{class:"fas fa-times me-1"},null,-1)),go={class:"card-body"},yo={key:0,class:"row"},$o={class:"col-12 mb-3"},So=d(()=>e("label",{class:"form-label"},"SÃ©lectionner un client existant",-1)),wo={key:1,class:"row"},Vo={class:"col-md-6 mb-3"},Co=d(()=>e("label",{class:"form-label"},"Nom *",-1)),Ao={class:"col-md-6 mb-3"},ko=d(()=>e("label",{class:"form-label"},"PrÃ©nom *",-1)),To={class:"col-md-6 mb-3"},No=d(()=>e("label",{class:"form-label"},"TÃ©lÃ©phone *",-1)),Eo={class:"col-md-6 mb-3"},Io=d(()=>e("label",{class:"form-label"},"Email",-1)),Po={class:"col-md-6 mb-3"},Fo=d(()=>e("label",{class:"form-label"},"Genre",-1)),Uo={class:"col-md-6 mb-3"},Do=d(()=>e("label",{class:"form-label"},"Site *",-1)),qo={class:"card"},Ro=d(()=>e("div",{class:"card-header pb-0"},[e("h6",{class:"mb-0"},"ðŸ›’ Panier")],-1)),Mo={class:"card-body"},Lo={class:"row mb-4"},jo={class:"col-md-8"},Bo=d(()=>e("label",{class:"form-label"},"Article",-1)),Ho={class:"col-md-2"},zo=d(()=>e("label",{class:"form-label"},"QtÃ©",-1)),Oo={class:"col-md-2 d-flex align-items-end"},Go=d(()=>e("i",{class:"fas fa-plus"},null,-1)),Qo={class:"table-responsive"},Jo={class:"table align-items-center mb-0"},Yo=d(()=>e("thead",null,[e("tr",null,[e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder"},"Article"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder text-center"},"QtÃ©"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder text-end"},"P.U."),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder text-end"},"TVA"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder text-end"},"Remise"),e("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder text-end"},"Total"),e("th")])],-1)),Ko={key:0},Wo=d(()=>e("td",{colspan:"7",class:"text-center text-secondary py-4"},[e("i",{class:"fas fa-shopping-cart fa-2x mb-2"}),e("p",{class:"mb-0"},"Panier vide")],-1)),Xo=[Wo],Zo={class:"text-sm font-weight-bold mb-0"},el={class:"text-xs text-secondary mb-0"},tl={class:"align-middle text-center"},sl=["onUpdate:modelValue","max"],ol={class:"align-middle text-end"},ll={class:"text-secondary text-sm"},al={class:"align-middle text-end"},nl=["onUpdate:modelValue"],il=d(()=>e("span",{class:"text-secondary text-sm ms-1"},"%",-1)),cl={class:"align-middle text-end"},dl=["onUpdate:modelValue"],rl=d(()=>e("span",{class:"text-secondary text-sm ms-1"},"%",-1)),ul={class:"align-middle text-end"},ml={class:"text-sm font-weight-bold"},vl={class:"align-middle text-center"},hl=["onClick"],_l=d(()=>e("i",{class:"fas fa-trash text-sm"},null,-1)),pl=[_l],xl={class:"col-lg-4"},bl={class:"card mb-4"},fl=d(()=>e("div",{class:"card-header pb-0"},[e("h6",{class:"mb-0"},"ðŸ’³ Paiement")],-1)),gl={class:"card-body"},yl={class:"mb-3"},$l=d(()=>e("label",{class:"form-label"},"Mode de Paiement *",-1)),Sl={class:"mb-3"},wl=d(()=>e("label",{class:"form-label"},"RÃ©fÃ©rence Paiement",-1)),Vl={class:"card bg-gradient-dark"},Cl={class:"card-body p-3"},Al={class:"d-flex justify-content-between mb-2"},kl=d(()=>e("span",{class:"text-white text-sm"},"Sous-total:",-1)),Tl={class:"text-white font-weight-bold"},Nl={class:"d-flex justify-content-between mb-2"},El=d(()=>e("span",{class:"text-white text-sm"},"TVA:",-1)),Il={class:"text-white font-weight-bold"},Pl={class:"d-flex justify-content-between mb-2"},Fl=d(()=>e("span",{class:"text-white text-sm"},"Remises:",-1)),Ul={class:"text-white font-weight-bold"},Dl=d(()=>e("hr",{class:"horizontal light my-3"},null,-1)),ql={class:"d-flex justify-content-between"},Rl=d(()=>e("span",{class:"text-white font-weight-bold"},"TOTAL:",-1)),Ml={class:"text-white font-weight-bold h5 mb-0"},Ll={class:"mt-4 d-grid gap-2"},jl=d(()=>e("i",{class:"fas fa-check-circle me-2"},null,-1)),Bl=d(()=>e("i",{class:"fas fa-times me-2"},null,-1)),Hl={__name:"Vente",setup(p){const _e=je(),{requireAuth:L}=Be(),T=De(),{showSuccess:C,showError:i,showLoading:r,close:K,showConfirm:W}=He();L();const N=S(!1),H=S(!1),D=S(!1),j=S(!1),q=S(!1),h=S(!1),x=S([]),f=S([]),b=S([]),g=S([]),A=S(!1),P=S(null),E=S(null),z=[{value:"EspÃ¨ces",label:"ðŸ’µ EspÃ¨ces"},{value:"Carte bancaire",label:"ðŸ’³ Carte bancaire"},{value:"Virement",label:"ðŸ¦ Virement"},{value:"Mobile Money",label:"ðŸ“± Mobile Money"}],l=S({clientExistant:null,nom:"",prenom:"",genre:"",email:"",telephone:"",dateNaissance:null,idSite:0,pieceIdentite:"",province:"",ville:"",commune:"",quartier:"",avenue:"",numero:"",idUtilisateur:T.userId,dateCommande:new Date().toISOString(),statutCommande:"ValidÃ©e",datePaiement:new Date().toISOString(),modePaiement:"",montant:0,referencePaiement:"",statutPaiement:"PayÃ©",libellePaiement:"",catalogueId:0,lignesCommandes:[]}),$=S({idStock:null,quantite:"1"}),M=S({ventes:0,ca:0}),I=be(()=>{let o=0,t=0,s=0;l.value.lignesCommandes.forEach(v=>{const _=v.prixUnitaire*v.quantite,F=_*v.remise/100,he=(_-F)*v.tva/100;o+=_,s+=F,t+=he});const a=o-s+t;return{sousTotal:o,totalTVA:t,totalRemises:s,total:a}}),X=be(()=>{const o=q.value?l.value.nom&&l.value.prenom&&l.value.telephone:l.value.clientExistant,t=l.value.lignesCommandes.length>0,s=l.value.modePaiement;return o&&t&&s}),Z=(o={})=>{const t=o.nomComplet||`${o.prenomClient||o.prenom||""} ${o.nomClient||o.nom||""}`.trim(),s=o.telephone||o.numeroTelephone||o.contact||"",a=o.nomSite||o.siteName||o.site||"";let v=t||`Client #${o.idClient}`;return a&&(v+=` â€“ ${a}`),s&&(v+=` (${s})`),v},ee=async()=>{H.value=!0;try{const o=T.societeId;if(!o){x.value=[];return}console.log(`ðŸ“‹ Chargement clients pour point de vente (sociÃ©tÃ© #${o})...`);const t=await U.getClientsParSiteBySociete(o),s=Array.isArray(t)?t:[];console.log(`âœ… ${s.length} client(s) disponible(s) pour la vente`),x.value=s.map(a=>({value:parseInt(a.idClient,10),label:Z(a),raw:a}))}catch(o){console.error("âŒ Erreur chargement clients:",o),x.value=[]}finally{H.value=!1}},te=o=>{const t=o.articleNom||o.nomArticle||o.libelle||o.descriptionArticle||`Article #${o.idArticle}`,s=o.siteNom||o.nomSite||o.site||"",a=o.prixVentHT||o.prixVente||o.prix||o.prixUnitaire||0,v=parseFloat(o.quantiteStock)||0;let _=`${t} (Stock: ${v.toFixed(0)})`;return s&&(_+=` â€“ ${s}`),_+=` â€“ ${k(a)}`,_},se=async()=>{D.value=!0;try{const o=T.societeId;if(!o){b.value=[],f.value=[];return}console.log(`ðŸ“¦ Chargement stocks pour point de vente (sociÃ©tÃ© #${o})...`);const t=await U.getStocksVueBySociete(o);let s=Array.isArray(t)?t:[];s=s.filter(a=>parseFloat(a.quantiteStock)>0&&a.statut!==!1).map(a=>({...a,articleNom:a.articleNom||a.nomArticle||a.libelleArticle||a.libelle||a.descriptionArticle||`Article #${a.idArticle}`,siteNom:a.siteNom||a.nomSite||a.site||"",prixVentHT:a.prixVentHT||a.prixVente||a.prix||a.prixUnitaire||0})),console.log(`âœ… ${s.length} stock(s) disponible(s) pour la vente`),b.value=s,f.value=s.map(a=>({value:a.idStock,label:te(a),articleNom:a.articleNom,prixVentHT:parseFloat(a.prixVentHT),quantiteStock:parseFloat(a.quantiteStock)})),console.log("âœ… Stocks formatÃ©s pour le dropdown:",f.value.length)}catch(o){console.error("âŒ Erreur chargement stocks:",o),b.value=[],f.value=[]}finally{D.value=!1}},oe=async o=>{if(!o)return;const t=x.value.find(a=>a.value===o),s=t==null?void 0:t.raw;s&&(l.value.nom=s.nom||s.nomClient||"",l.value.prenom=s.prenom||s.prenomClient||"",l.value.genre=s.genre||s.sex||"",l.value.email=s.email||"",l.value.telephone=s.telephone||s.numeroTelephone||s.contact||"",s.idSite&&(l.value.idSite=parseInt(s.idSite,10)))},le=o=>{const t=f.value.find(s=>s.value===o);t&&($.value.prixUnitaire=t.prixVentHT,$.value.articleNom=t.articleNom,$.value.stockDisponible=t.quantiteStock)},ae=()=>{if(!$.value.idStock)return;const o=f.value.find(s=>s.value===$.value.idStock);if(!o)return;if(l.value.lignesCommandes.find(s=>s.idStock===$.value.idStock)){i("Erreur","Cet article est dÃ©jÃ  dans le panier");return}if($.value.quantite>parseFloat(o.quantiteStock)){i("Erreur",`QuantitÃ© insuffisante (disponible: ${parseFloat(o.quantiteStock).toFixed(0)})`);return}l.value.lignesCommandes.push({idStock:$.value.idStock,articleNom:o.articleNom,quantite:parseFloat($.value.quantite),prixUnitaire:parseFloat(o.prixVentHT),tva:16,remise:0,stockDisponible:parseFloat(o.quantiteStock).toFixed(0)}),$.value={idStock:null,quantite:"1"}},ne=o=>{l.value.lignesCommandes.splice(o,1)},ie=o=>{const t=o.prixUnitaire*o.quantite,s=t*o.remise/100,a=t-s,v=a*o.tva/100;return a+v},k=o=>new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF"}).format(o),ce=()=>{l.value.clientExistant=null,l.value.nom="",l.value.prenom="",l.value.genre="",l.value.email="",l.value.telephone="",g.value.length>0&&(l.value.idSite=g.value[0].value)},de=async()=>{var t,s;if(console.log("ðŸš€ðŸš€ðŸš€ NOUVEAU CODE VENTE.VUE CHARGÃ‰ - VERSION 2.0 ðŸš€ðŸš€ðŸš€"),!!(await W("Confirmer la vente ?",`Montant total: ${k(I.value.total)}`,{confirmButtonText:"Oui, valider",confirmButtonColor:"#2dce89"})).isConfirmed){r("Enregistrement de la vente...","Veuillez patienter"),N.value=!0;try{l.value.referencePaiement||(l.value.referencePaiement=`PAY-${Date.now()}-${Math.floor(Math.random()*1e3)}`),l.value.montant=I.value.total,l.value.libellePaiement=`Vente ${l.value.modePaiement} - ${l.value.referencePaiement}`;let a=null,v="";console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ðŸ’¾ ENREGISTREMENT VENTE - SystÃ¨me SP avec Fallback [v2.0]"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");try{console.log("ðŸ”„ Tentative 1/3: Stored Procedure (SP)..."),a=await U.enregistrerVenteSP(l.value),v="Stored Procedure (SP)",console.log("âœ… SuccÃ¨s avec Stored Procedure !")}catch(_){console.warn("âš ï¸ SP Ã©chouÃ©e:",_.message);try{console.log("ðŸ”„ Tentative 2/3: MÃ©thode Standard (EF)..."),a=await U.enregistrerVente(l.value),v="MÃ©thode Standard (Entity Framework)",console.log("âœ… SuccÃ¨s avec mÃ©thode standard !")}catch(F){console.warn("âš ï¸ Standard Ã©chouÃ©e:",F.message);try{console.log("ðŸ”„ Tentative 3/3: MÃ©thode Alternative..."),a=await U.enregistrerVenteAlternative(l.value),v="MÃ©thode Alternative",console.log("âœ… SuccÃ¨s avec mÃ©thode alternative !")}catch{throw console.error("âŒ Toutes les mÃ©thodes ont Ã©chouÃ© !"),new Error("Impossible d'enregistrer la vente avec aucune mÃ©thode disponible")}}}if(console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`âœ… VENTE ENREGISTRÃ‰E via: ${v}`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),K(),await C("Vente enregistrÃ©e !",`Montant total : ${k(I.value.total)}`),P.value={...l.value,idVente:(a==null?void 0:a.idVente)||(a==null?void 0:a.id)||Date.now(),dateCreation:new Date().toISOString(),methodeEnregistrement:v},console.log("ðŸ“‹ PrÃ©paration donnÃ©es client pour facture..."),console.log("ðŸ“‹ showClientForm:",q.value),console.log("ðŸ“‹ clientExistant:",l.value.clientExistant),console.log("ðŸ“‹ nom/prenom:",l.value.nom,l.value.prenom),l.value.clientExistant){const _=x.value.find(F=>F.value===l.value.clientExistant);console.log("ðŸ‘¤ Client existant sÃ©lectionnÃ©:",_),E.value={nom:(_==null?void 0:_.nom)||"",prenom:(_==null?void 0:_.prenom)||"",telephone:(_==null?void 0:_.telephone)||"",email:(_==null?void 0:_.email)||""}}else console.log("ðŸ‘¤ Nouveau client crÃ©Ã© avec donnÃ©es formulaire"),E.value={nom:l.value.nom,prenom:l.value.prenom,telephone:l.value.telephone,email:l.value.email};console.log("âœ… DonnÃ©es client pour facture:",E.value),A.value=!0}catch(a){K(),console.error("âŒ Erreur fatale:",a),await i("Erreur",((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)||a.message||"Impossible d'enregistrer la vente")}finally{N.value=!1}}},re=async()=>{(await W("Annuler ?","Toutes les donnÃ©es seront perdues",{confirmButtonText:"Oui, annuler",confirmButtonColor:"#f5365c"})).isConfirmed&&_e.push("/dashboard")},ue=async()=>{j.value=!0;try{const o=T.societeId;if(!o){g.value=[];return}console.log("ðŸ¢ Chargement sites pour nouveau client...");const t=await U.getSitesBySociete(o),s=Array.isArray(t)?t:[];console.log(`âœ… ${s.length} site(s) associÃ©(s) trouvÃ©(s) pour la sociÃ©tÃ© #${o}`),g.value=s.map(a=>({value:parseInt(a.idSite,10),label:a.nomSite||a.nom||`Site #${a.idSite}`})),g.value.length>0&&!l.value.idSite&&(l.value.idSite=g.value[0].value,console.log("âœ… Site prÃ©-sÃ©lectionnÃ©:",g.value[0].label)),console.log("âœ… Sites chargÃ©s pour dropdown:",g.value.length)}catch(o){console.error("âŒ Erreur chargement sites:",o),g.value=[]}finally{j.value=!1}},me=async()=>{h.value=!0;try{const o=new Date().toISOString().split("T")[0],t=await U.getJournalVenteStatsDate(o,{idSociete:T.isSuperAdmin?void 0:T.societeId,idSite:T.siteId||void 0,idUtilisateur:T.userId||void 0}),s=parseInt((t==null?void 0:t.ventes)??(t==null?void 0:t.nombreVentes)??(t==null?void 0:t.totalVentes)??(t==null?void 0:t.commandes)??(t==null?void 0:t.nombreCommandes)??(t==null?void 0:t.nbVentes)??(t==null?void 0:t.count)??0,10)||0,a=parseFloat((t==null?void 0:t.ca)??(t==null?void 0:t.montant)??(t==null?void 0:t.montantTotal)??(t==null?void 0:t.total)??0)||0;M.value={ventes:s,ca:a}}catch(o){console.error("âŒ Erreur chargement stats ventes du jour:",o),M.value={ventes:0,ca:0}}finally{h.value=!1}};return Me(()=>{ee(),se(),ue(),me()}),(o,t)=>(u(),m("div",Ys,[Ks,e("div",Ws,[e("div",Xs,[e("div",Zs,[e("div",eo,[e("div",to,[so,e("div",null,[oo,e("h4",lo,[h.value?(u(),m("span",ao,[no,y("Chargement... ")])):(u(),m("span",io,n(M.value.ventes),1))]),e("p",co,[ro,y(" aujourd'hui "),h.value?V("",!0):(u(),m("span",uo,"â€¢ "+n(k(M.value.ca)),1))])])])])])])]),e("div",mo,[e("div",vo,[e("div",ho,[e("div",_o,[e("div",po,[xo,q.value?(u(),Ee(Q,{key:1,color:"secondary",size:"sm",class:"ms-auto",onClick:t[1]||(t[1]=s=>{q.value=!1,ce()})},{default:G(()=>[fo,y(" Annuler ")]),_:1})):(u(),Ee(Q,{key:0,color:"info",size:"sm",class:"ms-auto",onClick:t[0]||(t[0]=s=>q.value=!0)},{default:G(()=>[bo,y(" Nouveau Client ")]),_:1}))])]),e("div",go,[q.value?(u(),m("div",wo,[e("div",Vo,[Co,w(B,{modelValue:l.value.nom,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.nom=s),placeholder:"Nom","is-required":!0},null,8,["modelValue"])]),e("div",Ao,[ko,w(B,{modelValue:l.value.prenom,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.prenom=s),placeholder:"PrÃ©nom","is-required":!0},null,8,["modelValue"])]),e("div",To,[No,w(B,{modelValue:l.value.telephone,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.telephone=s),placeholder:"+243 123 456 789","is-required":!0},null,8,["modelValue"])]),e("div",Eo,[Io,w(B,{modelValue:l.value.email,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.email=s),type:"email",placeholder:"email@example.com"},null,8,["modelValue"])]),e("div",Po,[Fo,w(J,{modelValue:l.value.genre,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.genre=s),options:[{value:"M",label:"Masculin"},{value:"F",label:"FÃ©minin"}],placeholder:"SÃ©lectionner"},null,8,["modelValue"])]),e("div",Uo,[Do,w(J,{modelValue:l.value.idSite,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.idSite=s),options:g.value,placeholder:"SÃ©lectionner un site",disabled:j.value},null,8,["modelValue","options","disabled"])])])):(u(),m("div",yo,[e("div",$o,[So,w(J,{modelValue:l.value.clientExistant,"onUpdate:modelValue":[t[2]||(t[2]=s=>l.value.clientExistant=s),oe],options:x.value,placeholder:"Choisir un client...",disabled:H.value},null,8,["modelValue","options","disabled"])])]))])]),e("div",qo,[Ro,e("div",Mo,[e("div",Lo,[e("div",jo,[Bo,w(J,{modelValue:$.value.idStock,"onUpdate:modelValue":[t[9]||(t[9]=s=>$.value.idStock=s),le],options:f.value,placeholder:"SÃ©lectionner un article...",disabled:D.value},null,8,["modelValue","options","disabled"])]),e("div",Ho,[zo,w(B,{modelValue:$.value.quantite,"onUpdate:modelValue":t[10]||(t[10]=s=>$.value.quantite=s),type:"number",step:"1",min:"1",placeholder:"1"},null,8,["modelValue"])]),e("div",Oo,[w(Q,{color:"success",size:"md",class:"w-100",onClick:ae,disabled:!$.value.idStock},{default:G(()=>[Go]),_:1},8,["disabled"])])]),e("div",Qo,[e("table",Jo,[Yo,e("tbody",null,[l.value.lignesCommandes.length===0?(u(),m("tr",Ko,Xo)):V("",!0),(u(!0),m(Y,null,Ie(l.value.lignesCommandes,(s,a)=>(u(),m("tr",{key:a},[e("td",null,[e("p",Zo,n(s.articleNom),1),e("p",el,"Stock disponible: "+n(s.stockDisponible),1)]),e("td",tl,[pe(e("input",{"onUpdate:modelValue":v=>s.quantite=v,type:"number",min:"1",max:s.stockDisponible,step:"1",class:"form-control form-control-sm text-center d-inline-block",style:{width:"70px","font-size":"0.875rem"}},null,8,sl),[[xe,s.quantite,void 0,{number:!0}]])]),e("td",ol,[e("span",ll,n(k(s.prixUnitaire)),1)]),e("td",al,[pe(e("input",{"onUpdate:modelValue":v=>s.tva=v,type:"number",min:"0",max:"100",step:"0.1",class:"form-control form-control-sm text-end d-inline-block",style:{width:"60px","font-size":"0.875rem"}},null,8,nl),[[xe,s.tva,void 0,{number:!0}]]),il]),e("td",cl,[pe(e("input",{"onUpdate:modelValue":v=>s.remise=v,type:"number",min:"0",max:"100",step:"0.1",class:"form-control form-control-sm text-end d-inline-block",style:{width:"60px","font-size":"0.875rem"}},null,8,dl),[[xe,s.remise,void 0,{number:!0}]]),rl]),e("td",ul,[e("span",ml,n(k(ie(s))),1)]),e("td",vl,[e("button",{onClick:v=>ne(a),class:"btn btn-link text-danger p-0 mb-0",title:"Retirer"},pl,8,hl)])]))),128))])])])])])]),e("div",xl,[e("div",bl,[fl,e("div",gl,[e("div",yl,[$l,w(J,{modelValue:l.value.modePaiement,"onUpdate:modelValue":t[11]||(t[11]=s=>l.value.modePaiement=s),options:z,placeholder:"SÃ©lectionner"},null,8,["modelValue"])]),e("div",Sl,[wl,w(B,{modelValue:l.value.referencePaiement,"onUpdate:modelValue":t[12]||(t[12]=s=>l.value.referencePaiement=s),placeholder:"GÃ©nÃ©rÃ© automatiquement"},null,8,["modelValue"])])])]),e("div",Vl,[e("div",Cl,[e("div",Al,[kl,e("span",Tl,n(k(I.value.sousTotal)),1)]),e("div",Nl,[El,e("span",Il,n(k(I.value.totalTVA)),1)]),e("div",Pl,[Fl,e("span",Ul,"-"+n(k(I.value.totalRemises)),1)]),Dl,e("div",ql,[Rl,e("span",Ml,n(k(I.value.total)),1)])])]),e("div",Ll,[w(Q,{color:"success",size:"lg",onClick:de,disabled:!X.value||N.value},{default:G(()=>[jl,y(" "+n(N.value?"Traitement...":"Valider la Vente"),1)]),_:1},8,["disabled"]),w(Q,{color:"secondary",size:"md",onClick:re},{default:G(()=>[Bl,y(" Annuler ")]),_:1})])])]),w(Js,{show:A.value,vente:P.value,client:E.value,onClose:t[13]||(t[13]=s=>A.value=!1)},null,8,["show","vente","client"])]))}},Yl=Ue(Hl,[["__scopeId","data-v-a258122f"]]);export{Yl as default};
