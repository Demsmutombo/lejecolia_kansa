import{M as A}from"./bootstrap-DXdCWnwj.js";import{_ as U,u as q,a as k,d as y,c as F,e as N,f as X}from"./index-C7KYosbF.js";import{G,D as j}from"./GenericModal-D2OVyllk.js";import{a as d,c as z,w as Y,q as O,f as H,o as E,g as D,h as s,I as J,l as L,m as B,p as r,v as K,O as Q,C as W}from"./vendor-5ChSB122.js";import{A as S}from"./ArgonSelect-BIJzuYL2.js";import"./charts-D32nV7-X.js";const Z={class:"modal-body-scrollable"},ee={class:"row"},ae={class:"col-12 mb-3"},te={key:0,class:"row"},ne={class:"col-12 mb-3"},se={key:1,class:"row"},oe={class:"col-12 mb-3"},le={class:"row"},ie={class:"col-md-6 mb-3"},re={class:"col-md-6 mb-3"},de={class:"row"},me={class:"col-md-6 mb-3"},ue={class:"col-md-6 mb-3"},ce={class:"row"},ve={class:"col-12 mb-3"},pe={class:"row"},be={class:"col-12 mb-3"},ge={__name:"PaiementModal",props:{paiement:{type:Object,default:null},modalId:{type:String,default:"paiementModal"}},emits:["save","close"],setup(T,{expose:_,emit:M}){const P=q(),f=T,C=M,v=d(null),p=d(!1),u=d([]),i=d([]),b=d(!1),h=d(!1),w=z(()=>f.paiement!==null),I=[{value:"commande",label:"Paiement de Commande"},{value:"reservation",label:"Paiement de RÃ©servation"}],R=[{value:"PayÃ©",label:"PayÃ©"},{value:"En attente",label:"En attente"},{value:"RemboursÃ©",label:"RemboursÃ©"},{value:"AnnulÃ©",label:"AnnulÃ©"}],$=[{value:"EspÃ¨ces",label:"EspÃ¨ces"},{value:"Carte bancaire",label:"Carte bancaire"},{value:"Virement",label:"Virement"},{value:"Mobile Money",label:"Mobile Money"},{value:"ChÃ¨que",label:"ChÃ¨que"}],a=d({idPaiement:0,typeTransaction:"commande",idCommande:null,idReservation:null,datePaiement:"",modePaiement:"",montant:0,referencePaiemenet:"",statut:"PayÃ©",libelle:""}),V=()=>{const e=new Date().getTime(),o=Math.floor(Math.random()*1e4);return`PAY-${e}-${o}`},x=async()=>{b.value=!0;try{const t=P.societeId||3,e=await y.getCommandesBySociete(t);u.value=(Array.isArray(e)?e:[]).map(o=>({value:parseInt(o.idCommande,10),label:`Commande #${o.idCommande} - ${o.dateCommande?new Date(o.dateCommande).toLocaleDateString("fr-FR"):""}`})),console.log("âœ… Commandes chargÃ©es:",u.value.length)}catch(t){console.error("âŒ Erreur chargement commandes:",t),u.value=[]}finally{b.value=!1}},n=async()=>{h.value=!0;try{const t=P.societeId||3,e=await y.getReservationsBySociete(t);i.value=(Array.isArray(e)?e:[]).map(o=>({value:parseInt(o.idReservation,10),label:`RÃ©servation #${o.idReservation} - ${o.nomClient}`})),console.log("âœ… RÃ©servations chargÃ©es:",i.value.length)}catch(t){console.error("âŒ Erreur chargement rÃ©servations:",t),i.value=[]}finally{h.value=!1}},l=t=>{t==="commande"?a.value.idReservation=null:t==="reservation"&&(a.value.idCommande=null)};Y(()=>f.paiement,t=>{t?a.value={idPaiement:t.idPaiement||0,typeTransaction:t.idCommande?"commande":"reservation",idCommande:t.idCommande?parseInt(t.idCommande,10):null,idReservation:t.idReservation?parseInt(t.idReservation,10):null,datePaiement:t.datePaiement?new Date(t.datePaiement).toISOString().slice(0,16):"",modePaiement:t.modePaiement||"",montant:t.montant||0,referencePaiemenet:t.referencePaiemenet||"",statut:t.statut||"PayÃ©",libelle:t.libelle||""}:c()},{immediate:!1});const c=()=>{const t=new Date().toISOString().slice(0,16);a.value={idPaiement:0,typeTransaction:"commande",idCommande:null,idReservation:null,datePaiement:t,modePaiement:"",montant:0,referencePaiemenet:"",statut:"PayÃ©",libelle:""}},m=()=>a.value.typeTransaction?a.value.typeTransaction==="commande"&&!a.value.idCommande?{valid:!1,message:"La commande est obligatoire"}:a.value.typeTransaction==="reservation"&&!a.value.idReservation?{valid:!1,message:"La rÃ©servation est obligatoire"}:a.value.datePaiement?!a.value.montant||a.value.montant<=0?{valid:!1,message:"Le montant doit Ãªtre supÃ©rieur Ã  0"}:a.value.modePaiement?{valid:!0}:{valid:!1,message:"Le mode de paiement est obligatoire"}:{valid:!1,message:"La date de paiement est obligatoire"}:{valid:!1,message:"Le type de transaction est obligatoire"},g=async()=>{const t=m();if(!t.valid){alert(t.message);return}a.value.referencePaiemenet||(a.value.referencePaiemenet=V()),a.value.libelle||(a.value.libelle=`Paiement ${a.value.modePaiement} - ${a.value.referencePaiemenet}`),p.value=!0;try{const e={...a.value,idCommande:a.value.typeTransaction==="commande"?a.value.idCommande:null,idReservation:a.value.typeTransaction==="reservation"?a.value.idReservation:null,idSociete:P.societeId||3};delete e.typeTransaction,C("save",e)}catch(e){console.error("Erreur lors de la sauvegarde:",e)}finally{p.value=!1}};return O(()=>{x(),n()}),_({resetForm:c,show:()=>{var t;return(t=v.value)==null?void 0:t.show()},hide:()=>{var t;return(t=v.value)==null?void 0:t.hide()},close:()=>{var t;return(t=v.value)==null?void 0:t.hide()}}),(t,e)=>(E(),H(G,{"modal-id":T.modalId,title:`${w.value?"Modifier":"Nouveau"} Paiement`,size:"md","confirm-text":"Enregistrer","confirm-icon":"fas fa-save","confirm-color":"success","is-loading":p.value,"loading-text":"Enregistrement...",onConfirm:g,ref_key:"modalRef",ref:v},{body:D(()=>[s("div",Z,[s("form",{onSubmit:J(g,["prevent"])},[s("div",ee,[s("div",ae,[e[9]||(e[9]=s("label",{class:"form-label"},"Type de Transaction *",-1)),r(S,{modelValue:a.value.typeTransaction,"onUpdate:modelValue":[e[0]||(e[0]=o=>a.value.typeTransaction=o),l],options:I,placeholder:"SÃ©lectionner",disabled:w.value,id:"typeTransaction",name:"typeTransaction"},null,8,["modelValue","disabled"])])]),a.value.typeTransaction==="commande"?(E(),L("div",te,[s("div",ne,[e[10]||(e[10]=s("label",{class:"form-label"},"Commande *",-1)),r(S,{modelValue:a.value.idCommande,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.idCommande=o),options:u.value,placeholder:"SÃ©lectionner une commande",disabled:b.value,id:"idCommande",name:"idCommande"},null,8,["modelValue","options","disabled"])])])):B("",!0),a.value.typeTransaction==="reservation"?(E(),L("div",se,[s("div",oe,[e[11]||(e[11]=s("label",{class:"form-label"},"RÃ©servation *",-1)),r(S,{modelValue:a.value.idReservation,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.idReservation=o),options:i.value,placeholder:"SÃ©lectionner une rÃ©servation",disabled:h.value,id:"idReservation",name:"idReservation"},null,8,["modelValue","options","disabled"])])])):B("",!0),e[19]||(e[19]=s("h6",{class:"text-sm mt-3 mb-2"},"DÃ©tails du Paiement",-1)),s("div",le,[s("div",ie,[e[12]||(e[12]=s("label",{class:"form-label"},"Date Paiement *",-1)),K(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.datePaiement=o),type:"datetime-local",class:"form-control",required:"",id:"datePaiement",name:"datePaiement"},null,512),[[Q,a.value.datePaiement]])]),s("div",re,[e[13]||(e[13]=s("label",{class:"form-label"},"Montant *",-1)),r(k,{modelValue:a.value.montant,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.montant=o),type:"number",step:"0.01",placeholder:"0.00","is-required":!0,id:"montant",name:"montant"},null,8,["modelValue"])])]),s("div",de,[s("div",me,[e[14]||(e[14]=s("label",{class:"form-label"},"Mode de Paiement *",-1)),r(S,{modelValue:a.value.modePaiement,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.modePaiement=o),options:$,placeholder:"SÃ©lectionner",id:"modePaiement",name:"modePaiement"},null,8,["modelValue"])]),s("div",ue,[e[15]||(e[15]=s("label",{class:"form-label"},"Statut *",-1)),r(S,{modelValue:a.value.statut,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.statut=o),options:R,placeholder:"SÃ©lectionner",id:"statut",name:"statut"},null,8,["modelValue"])])]),s("div",ce,[s("div",ve,[e[16]||(e[16]=s("label",{class:"form-label"},"RÃ©fÃ©rence Paiement",-1)),r(k,{modelValue:a.value.referencePaiemenet,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.referencePaiemenet=o),placeholder:"REF-XXXXX",id:"referencePaiemenet",name:"referencePaiemenet"},null,8,["modelValue"]),e[17]||(e[17]=s("small",{class:"text-muted"},"GÃ©nÃ©rÃ©e automatiquement si vide",-1))])]),s("div",pe,[s("div",be,[e[18]||(e[18]=s("label",{class:"form-label"},"LibellÃ©",-1)),r(k,{modelValue:a.value.libelle,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.libelle=o),placeholder:"Description du paiement",id:"libelle",name:"libelle"},null,8,["modelValue"])])])],32)])]),_:1},8,["modal-id","title","is-loading"]))}},fe=U(ge,[["__scopeId","data-v-d3f0f5c1"]]),ye={class:"container-fluid py-4"},Pe={class:"row"},Ce={class:"col-12"},he={__name:"Paiements",setup(T){const{requireAuth:_}=F(),M=q(),{showConfirm:P,showSuccess:f,showError:C,showLoading:v,close:p}=N();_();const u=d(!1),i=d([]),b=d(null),h=d(null),w=[{key:"idPaiement",label:"NÂ°",type:"index",align:"center"},{key:"referencePaiemenet",label:"RÃ©fÃ©rence",render:n=>`<span class="badge badge-sm bg-gradient-secondary">${n||"-"}</span>`},{key:"datePaiement",label:"Date",render:n=>n?new Date(n).toLocaleDateString("fr-FR",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}):"-"},{key:"type",label:"Type",render:(n,l)=>l.idCommande?`<span class="badge badge-sm bg-gradient-info">Commande #${l.idCommande}</span>`:l.idReservation?`<span class="badge badge-sm bg-gradient-warning">RÃ©servation #${l.idReservation}</span>`:"-"},{key:"montant",label:"Montant",align:"end",render:n=>`<strong class="text-success">${(parseFloat(n)||0).toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}</strong>`},{key:"modePaiement",label:"Mode",render:n=>({EspÃ¨ces:'<span class="badge badge-sm bg-gradient-success">ğŸ’µ EspÃ¨ces</span>',"Carte bancaire":'<span class="badge badge-sm bg-gradient-primary">ğŸ’³ Carte</span>',Virement:'<span class="badge badge-sm bg-gradient-info">ğŸ¦ Virement</span>',"Mobile Money":'<span class="badge badge-sm bg-gradient-warning">ğŸ“± Mobile</span>',ChÃ¨que:'<span class="badge badge-sm bg-gradient-secondary">ğŸ“„ ChÃ¨que</span>'})[n]||`<span class="badge badge-sm bg-gradient-secondary">${n}</span>`},{key:"statut",label:"Statut",align:"center",render:n=>({PayÃ©:'<span class="badge badge-sm bg-gradient-success">PayÃ©</span>',"En attente":'<span class="badge badge-sm bg-gradient-warning">En attente</span>',RemboursÃ©:'<span class="badge badge-sm bg-gradient-info">RemboursÃ©</span>',AnnulÃ©:'<span class="badge badge-sm bg-gradient-danger">AnnulÃ©</span>'})[n]||`<span class="badge badge-sm bg-gradient-secondary">${n}</span>`}],I=[{name:"edit",label:"Modifier",icon:"fas fa-edit",class:"text-secondary",onClick:n=>a(n)},{name:"delete",label:"Supprimer",icon:"fas fa-trash",class:"text-danger",iconOnly:!0,onClick:n=>x(n)}],R=async()=>{u.value=!0,console.log("ğŸ“¡ Chargement paiements...");try{const n=M.societeId||3,l=await y.getPaiementsBySociete(n);Array.isArray(l)?i.value=l:l!=null&&l.data?i.value=l.data:i.value=[],console.log("âœ… Paiements chargÃ©s:",i.value.length);const c=i.value.reduce((m,g)=>m+(parseFloat(g.montant)||0),0);console.log(`ğŸ’° Total encaissÃ©: ${c.toLocaleString("fr-CD",{style:"currency",currency:"CDF"})}`)}catch(n){console.error("âŒ Erreur chargement paiements:",n),await C("Erreur","Impossible de charger les paiements"),i.value=[]}finally{u.value=!1}},$=()=>{b.value=null,new A(document.getElementById("paiementModal")).show()},a=n=>{b.value={...n},new A(document.getElementById("paiementModal")).show()},V=async n=>{var l,c;v("Enregistrement...");try{const m={...n,idSociete:M.societeId||3};n.idPaiement&&n.idPaiement>0?(await y.updatePaiement(n.idPaiement,m),await f("ModifiÃ© !","Paiement modifiÃ©")):(await y.createPaiement(m),await f("CrÃ©Ã© !","Paiement crÃ©Ã©"));const g=A.getInstance(document.getElementById("paiementModal"));g&&g.hide(),await R()}catch(m){p(),console.error("âŒ Erreur:",m),await C("Erreur",((c=(l=m.response)==null?void 0:l.data)==null?void 0:c.message)||"Erreur de sauvegarde")}},x=async n=>{if((await P("Supprimer ?",`Supprimer le paiement ${n.referencePaiemenet} ?`,{confirmButtonText:"Oui, supprimer",confirmButtonColor:"#d33"})).isConfirmed){v("Suppression...");try{await y.deletePaiement(n.idPaiement),p(),await f("SupprimÃ© !"),await R()}catch{p(),await C("Erreur","Impossible de supprimer")}}};return O(()=>{R()}),(n,l)=>(E(),L("div",ye,[s("div",Pe,[s("div",Ce,[r(j,{title:"Gestion des Paiements",subtitle:"Paiements Lejecolia",data:i.value,columns:w,actions:I,"show-search":!0,"search-fields":["referencePaiemenet","modePaiement","statut","libelle"],loading:u.value,"items-per-page":10,"loading-text":"Chargement des paiements...","empty-text":"Aucun paiement trouvÃ©"},{actions:D(()=>[r(X,{color:"success",size:"sm",onClick:$},{default:D(()=>[...l[0]||(l[0]=[s("i",{class:"fas fa-plus me-2"},null,-1),W(" Nouveau Paiement ",-1)])]),_:1})]),_:1},8,["data","loading"])])]),r(fe,{paiement:b.value,"modal-id":"paiementModal",onSave:V,ref_key:"paiementModalRef",ref:h},null,8,["paiement"])]))}},_e=U(he,[["__scopeId","data-v-70494b1d"]]);export{_e as default};
