import{a as _,k as R,c as N,q as B,l as r,o as d,m as q,h as t,p as x,C as h,t as l,g as f,b as P,n as U,F as z,G as O,D as W,E as j}from"./vendor-Bjq3GXyS.js";import{_ as G,c as H,u as Q,d as m,e as J,f as F}from"./index-CwjmzDsC.js";import"./bootstrap-DXdCWnwj.js";import"./charts-D32nV7-X.js";const o=p=>(W("data-v-11e03538"),p=p(),j(),p),K={class:"container-fluid py-4"},X={key:0,class:"row"},Y=o(()=>t("div",{class:"col-12 text-center py-5"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Chargement...")]),t("p",{class:"mt-3"},"Chargement...")],-1)),Z=[Y],tt={key:1,class:"row"},et={class:"col-12"},st={class:"alert alert-danger"},at=o(()=>t("strong",null,"Erreur :",-1)),ot=o(()=>t("i",{class:"fas fa-arrow-left me-2"},null,-1)),ct={key:2,class:"row"},nt={class:"col-12 mb-4"},lt={class:"card"},it={class:"card-body"},rt={class:"d-flex justify-content-between align-items-start"},dt={class:"mb-1"},ut={class:"text-sm text-secondary mb-2"},_t={class:"text-sm mb-0"},mt=o(()=>t("i",{class:"fas fa-calendar me-2"},null,-1)),ht=o(()=>t("i",{class:"fas fa-arrow-left me-2"},null,-1)),pt={class:"col-lg-4 mb-4"},vt={class:"card h-100"},xt=o(()=>t("div",{class:"card-header pb-0"},[t("h6",null,[t("i",{class:"fas fa-info-circle me-2 text-primary"}),h("Informations")])],-1)),ft={class:"card-body"},gt={class:"info-group"},yt=o(()=>t("label",{class:"info-label"},"Client",-1)),bt={class:"info-value"},Ct={class:"info-group"},wt=o(()=>t("label",{class:"info-label"},"Vendeur",-1)),At={class:"info-value"},kt={class:"info-group"},Nt=o(()=>t("label",{class:"info-label"},"Date",-1)),Ut={class:"info-value"},Ft={class:"info-group"},Lt=o(()=>t("label",{class:"info-label"},"Statut",-1)),$t={class:"info-value"},Et={class:"col-lg-8 mb-4"},Dt={class:"card h-100"},It=o(()=>t("div",{class:"card-header pb-0"},[t("h6",null,[t("i",{class:"fas fa-shopping-cart me-2 text-success"}),h("Articles Commandés")])],-1)),Vt={class:"card-body"},St={key:0,class:"text-center py-3"},Tt=o(()=>t("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1)),Mt=o(()=>t("p",{class:"text-sm mt-2"},"Chargement des articles...",-1)),Rt=[Tt,Mt],Bt={key:1,class:"text-center py-3"},qt=o(()=>t("p",{class:"text-secondary"},"Aucun article dans cette commande",-1)),Pt=[qt],zt={key:2,class:"table-responsive"},Ot={class:"table align-items-center mb-0"},Wt=o(()=>t("thead",null,[t("tr",null,[t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7"},"Article"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-center"},"Qté"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end"},"P.U."),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-center"},"TVA"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-center"},"Remise"),t("th",{class:"text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 text-end"},"Total")])],-1)),jt={class:"text-sm font-weight-bold mb-0"},Gt={class:"text-center"},Ht={class:"badge bg-gradient-info"},Qt={class:"text-end"},Jt={class:"text-sm mb-0"},Kt={class:"text-center"},Xt={class:"text-xs text-secondary mb-0"},Yt={class:"text-center"},Zt={class:"text-xs text-secondary mb-0"},te={class:"text-end"},ee={class:"text-sm font-weight-bold mb-0"},se={class:"bg-light"},ae=o(()=>t("td",{colspan:"5",class:"text-end"},[t("strong",null,"TOTAL COMMANDE:")],-1)),oe={class:"text-end"},ce={class:"text-success"},ne={__name:"CommandeDetail",setup(p){const L=R(),{requireAuth:$}=H();Q();const{showError:E}=J();$();const C=_(L.params.id),a=_(null),u=_([]),g=_(!1),y=_(!1),v=_(null),w=N(()=>{var i;const e=(i=a.value)==null?void 0:i.statut;return{"En cours":"badge bg-gradient-warning",Validée:"badge bg-gradient-info",Livrée:"badge bg-gradient-success",Annulée:"badge bg-gradient-danger"}[e]||"badge bg-gradient-secondary"}),A=e=>{const c=parseFloat(e.quantite)*parseFloat(e.prixUnitaire),i=c*(parseFloat(e.remise)/100),n=(c-i)*(parseFloat(e.tva)/100);return c-i+n},D=N(()=>u.value.reduce((e,c)=>e+A(c),0)),k=e=>{if(!e)return"-";try{return new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}},b=e=>new Intl.NumberFormat("fr-CD",{style:"currency",currency:"CDF"}).format(parseFloat(e)||0),I=async()=>{g.value=!0,v.value=null;try{const e=await m.getCommandeById(C.value);a.value=e,await V(),await S()}catch{v.value="Commande introuvable",await E("Erreur","Commande introuvable")}finally{g.value=!1}},V=async()=>{try{const[e,c]=await Promise.all([m.getClients(),m.getUsers()]),i={},n={};(Array.isArray(e)?e:[]).forEach(s=>{i[s.idClient]=`${s.prenom} ${s.nom}`}),(Array.isArray(c)?c:[]).forEach(s=>{const M=`${s.nomUtilisateur||""} ${s.postNomUtilisateur||""} ${s.prenomUtilisateur||""}`.trim();n[s.idUtilisateur]=M||`Utilisateur #${s.idUtilisateur}`}),a.value&&(a.value.clientNom=i[a.value.idClient]||`Client #${a.value.idClient}`,a.value.utilisateurNom=n[a.value.idUtilisateur]||`Vendeur #${a.value.idUtilisateur}`)}catch(e){console.warn("Impossible charger noms:",e)}},S=async()=>{y.value=!0;try{const e=await m.searchLignesCommande(C.value,null);u.value=Array.isArray(e)?e:[],console.log("✅ Lignes chargées:",u.value.length),await T()}catch(e){console.error("❌ Erreur chargement lignes:",e),u.value=[]}finally{y.value=!1}},T=async()=>{try{const[e,c]=await Promise.all([m.getStocks(),m.getArticles()]),i={},n={};(Array.isArray(c)?c:[]).forEach(s=>{n[s.idArticle]=s.libelle||`Article #${s.idArticle}`}),(Array.isArray(e)?e:[]).forEach(s=>{i[s.idStock]=n[s.idArticle]||`Article #${s.idArticle}`}),u.value=u.value.map(s=>({...s,articleNom:i[s.idStock]||"Article inconnu"})),console.log("✅ Lignes enrichies avec noms articles")}catch(e){console.warn("⚠️ Impossible charger articles:",e)}};return B(()=>{I()}),(e,c)=>{const i=P("router-link");return d(),r("div",K,[g.value?(d(),r("div",X,Z)):v.value?(d(),r("div",tt,[t("div",et,[t("div",st,[at,h(" "+l(v.value),1)]),x(i,{to:"/commandes"},{default:f(()=>[x(F,{color:"secondary"},{default:f(()=>[ot,h(" Retour ")]),_:1})]),_:1})])])):a.value?(d(),r("div",ct,[t("div",nt,[t("div",lt,[t("div",it,[t("div",rt,[t("div",null,[t("h3",dt,"Commande #"+l(a.value.idCommande),1),t("p",ut,[t("span",{class:U(w.value)},l(a.value.statut),3)]),t("p",_t,[mt,h(" "+l(k(a.value.dateCommande)),1)])]),t("div",null,[x(i,{to:"/commandes"},{default:f(()=>[x(F,{color:"secondary",size:"sm"},{default:f(()=>[ht,h(" Retour ")]),_:1})]),_:1})])])])])]),t("div",pt,[t("div",vt,[xt,t("div",ft,[t("div",gt,[yt,t("p",bt,l(a.value.clientNom||`Client #${a.value.idClient}`),1)]),t("div",Ct,[wt,t("p",At,l(a.value.utilisateurNom||`Vendeur #${a.value.idUtilisateur}`),1)]),t("div",kt,[Nt,t("p",Ut,l(k(a.value.dateCommande)),1)]),t("div",Ft,[Lt,t("p",$t,[t("span",{class:U(w.value)},l(a.value.statut),3)])])])])]),t("div",Et,[t("div",Dt,[It,t("div",Vt,[y.value?(d(),r("div",St,Rt)):u.value.length===0?(d(),r("div",Bt,Pt)):(d(),r("div",zt,[t("table",Ot,[Wt,t("tbody",null,[(d(!0),r(z,null,O(u.value,n=>(d(),r("tr",{key:n.idLigneCommande},[t("td",null,[t("p",jt,l(n.articleNom||"Article"),1)]),t("td",Gt,[t("span",Ht,l(parseFloat(n.quantite)),1)]),t("td",Qt,[t("p",Jt,l(b(n.prixUnitaire)),1)]),t("td",Kt,[t("p",Xt,l(parseFloat(n.tva))+"%",1)]),t("td",Yt,[t("p",Zt,l(parseFloat(n.remise))+"%",1)]),t("td",te,[t("p",ee,l(b(A(n))),1)])]))),128))]),t("tfoot",null,[t("tr",se,[ae,t("td",oe,[t("strong",ce,l(b(D.value)),1)])])])])]))])])])])):q("",!0)])}}},ue=G(ne,[["__scopeId","data-v-11e03538"]]);export{ue as default};
